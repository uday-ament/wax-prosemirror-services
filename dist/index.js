"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("wax-prosemirror-core"),n=require("react"),r=e(n),i=require("lodash"),a=require("prosemirror-history"),o=require("inversify"),c=require("react-i18next"),s=require("uuid"),u=require("prosemirror-state"),l=require("prosemirror-view"),d=e(require("@babel/runtime/regenerator")),f=require("styled-components"),p=e(f),m=require("prosemirror-commands"),g=require("prosemirror-schema-list"),h=require("prosemirror-model"),v=e(require("use-deep-compare-effect")),y=require("prosemirror-transform"),k=require("prosemirror-keymap"),x=require("@pubsweet/ui-toolkit"),b=e(require("highlight.js/lib/core")),w=require("prosemirror-highlightjs"),E=require("prosemirror-inputrules"),C=require("mathjax-full/js/mathjax"),S=require("mathjax-full/js/input/tex.js"),A=require("mathjax-full/js/output/svg"),T=require("mathjax-full/js/adaptors/liteAdaptor.js"),O=require("mathjax-full/js/handlers/html"),M=require("mathjax-full/js/input/tex/AllPackages.js"),D=e(require("react-dropdown")),j=require("y-prosemirror"),B=require("y-websocket"),P=require("yjs");function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function z(e){return(z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){return!t||"object"!==z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function L(e){return function(){var t,n=H(e);if(R()){var r=H(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return V(this,t)}}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function J(e,t,n){return t&&G(e.prototype,t),n&&G(e,n),e}var F,q,Q=function(e){var a=e.view,o=void 0===a?{}:a,s=e.item,u=c.useTranslation(),l=u.t,d=u.i18n,f=s.active,p=s.icon,m=s.label,g=s.run,h=s.select,v=s.title,y=n.useContext(t.WaxContext),k=y.pmViews.main,x=y.activeViewId,b=y.activeView,w=k.props.editable((function(e){return e})),E=o.state,C=!(!f(b.state,x)||!h(E,x,b)),S=!h(E,x,b);return w||(S=!0),n.useMemo((function(){return r.createElement(t.MenuButton,{active:C||!1,disabled:S,iconName:p,label:m,onMouseDown:function(e){return function(e,t,n){e.preventDefault(),g(t,n)}(e,k.state,k.dispatch)},title:!i.isEmpty(d)&&d.exists("Wax.Base.".concat(v))?l("Wax.Base.".concat(v)):v})}),[C,S,l("Wax.Base.".concat(v))])},Y=o.injectable()(F=function(e){I(o,t.Tools);var n=L(o);function o(){var e;W(this,o);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Undo",e.icon="undo",e.name="Undo",e}return J(o,[{key:"select",value:function(e){return a.undo(e)}},{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Q,{item:this.toJSON(),key:"Undo",view:e}):null}},{key:"run",get:function(){return function(e,t){a.undo(e,(function(e){return t(e.setMeta("inputType","Undo"))}))}}},{key:"enable",get:function(){return a.undo}}]),o}())||F,K=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Undo").to(Y)}}]),r}(),U=o.injectable()(q=function(e){I(o,t.Tools);var n=L(o);function o(){var e;W(this,o);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Redo",e.icon="redo",e.name="Redo",e}return J(o,[{key:"select",value:function(e){return a.redo(e)}},{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Q,{item:this.toJSON(),key:"Redo",view:e}):null}},{key:"run",get:function(){return function(e,t){a.redo(e,(function(e){return t(e.setMeta("inputType","Redo"))}))}}},{key:"enable",get:function(){return a.redo}}]),o}())||q,Z=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Redo").to(U)}}]),r}();function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _(e,t){if(e){if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}function $(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,c=e[Symbol.iterator]();!(r=(o=c.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==c.return||c.return()}finally{if(i)throw a}}return n}}(e,t)||_(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ee,te,ne=function(e){var a=e.view,o=void 0===a?{}:a,s=e.item,u=c.useTranslation(),l=u.t,d=u.i18n,f=s.icon,p=s.label,m=s.select,g=s.title,h=n.useContext(t.WaxContext),v=h.pmViews.main,y=h.activeViewId,k=h.activeView,x=o.state,b=$(n.useState(!1),2),w=b[0],E=b[1],C=function(){E(!0),setTimeout((function(){E(!1)}),300)},S=function(e){return 83!==e.key&&83!==e.keyCode||!e.metaKey&&!e.ctrlKey||(e.preventDefault(),C(),!1)};n.useEffect((function(){return document.addEventListener("keydown",S),function(){return document.removeEventListener("keydown",S)}}),[]);var A=!m(x,y,k);v.props.editable((function(e){return e}))||(A=!0);var T=w?"done":f;return n.useMemo((function(){return r.createElement(t.MenuButton,{active:!1,disabled:A,iconName:T,label:p,onMouseDown:C,title:!i.isEmpty(d)&&d.exists("Wax.Base.".concat(g))?l("Wax.Base.".concat(g)):g})}),[w,A,l("Wax.Base.".concat(g))])},re=o.injectable()(ee=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).title="Save changes",e.icon="save",e.name="Save",e.content=t.icons.save,e.name="Save",e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(ne,{item:this.toJSON(),key:"Save",view:e}):null}}]),a}())||ee,ie=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Save").to(re)}}]),r}(),ae=o.injectable()(te=function(e){I(r,t.ToolGroup);var n=L(r);function r(e,t,i){var a;return W(this,r),(a=n.call(this)).tools=[],a.tools=[e,t,i],a}return r=o.inject("Save")(r,void 0,2)||r,r=o.inject("Redo")(r,void 0,1)||r,r=o.inject("Undo")(r,void 0,0)||r}())||te,oe=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Base").to(ae)}}]),r}(),ce=[new K,new Z,new ie,new oe],se=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=ce,e}return r}();function ue(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){ue(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fe={attrs:{id:{default:""},src:{},alt:{default:""},title:{default:null},extraData:{default:{}},fileid:{default:null}},group:"figure",draggable:!1,parseDOM:[{tag:"img[src]",getAttrs:function(e,t){Object.assign(e,{src:e.dom.getAttribute("src"),title:e.dom.getAttribute("title"),id:e.dom.dataset.id,alt:e.dom.getAttribute("alt"),fileid:e.dom.dataset.fileid}),t()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&e.node.attrs.id;var n=e.node.attrs,r=n.src,i=n.alt,a=n.title,o=n.id,c=(n.track,n.fileid),u=e.node.attrs.extraData;e.value=["img",de({src:""!==r?r:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMMAAADwCAYAAAC9kdCpAAAMP2lDQ1BJQ0MgUHJvZmlsZQAASImVVwdYU8kWnluSkEBCCSAgJfQmiNQAUkJoAaR3GyEJEEqMgaBiRxYVXAsqFrChqyKKnWZH7CyKvS8WVJR1sWBX3qSArvvK9+b75s5//znznzPnztx7BwD141yxOBfVACBPVCCJDQlgJKekMkhPAQZoQBXoAEMuL1/Mio6OALAMtn8v764DRNZecZBp/bP/vxZNviCfBwASDXE6P5+XB/EBAPBqnlhSAABRxptPKRDLMKxAWwIDhHiBDGcqcLUMpyvwHrlNfCwb4jYAVNS4XEkmALRLkGcU8jKhBq0PYicRXygCQJ0BsW9e3iQ+xGkQ20AbMcQyfWb6DzqZf9NMH9LkcjOHsGIu8qISKMwX53Kn/Z/p+N8lL1c66MMKVrUsSWisbM4wbzdzJoXLsBrEvaL0yCiItSD+IOTL7SFGKVnS0ASFPWrIy2fDnAFdiJ343MBwiA0hDhblRkYo+fQMYTAHYrhC0KnCAk48xHoQLxDkB8UpbTZKJsUqfaENGRI2S8mf5UrkfmW+7ktzElhK/ddZAo5SH6MVZcUnQUyB2KJQmBgJMQ1ix/ycuHClzeiiLHbkoI1EGiuL3wLiWIEoJEChjxVmSIJjlfZlefmD88U2Zgk5kUq8ryArPlSRH6yNx5XHD+eCXRKIWAmDOoL85IjBufAFgUGKuWPPBKKEOKXOB3FBQKxiLE4R50Yr7XEzQW6IjDeD2DW/ME45Fk8sgAtSoY9niAui4xVx4kXZ3LBoRTz4UhAB2CAQMIAU1nQwCWQDYUdvYy+8U/QEAy6QgEwgAA5KZnBEkrxHBK9xoAj8CZEA5A+NC5D3CkAh5L8OsYqrA8iQ9xbKR+SAJxDngXCQC++l8lGiIW+J4DFkhP/wzoWVB+PNhVXW/+/5QfY7w4JMhJKRDnpkqA9aEoOIgcRQYjDRFjfAfXFvPAJe/WF1xpm45+A8vtsTnhA6CQ8J1whdhFsThcWSn6IcA7qgfrAyF+k/5gK3gppueADuA9WhMq6LGwAH3BX6YeF+0LMbZNnKuGVZYfyk/bcZ/PA0lHZkJzJKHkb2J9v8PJJmR3MbUpHl+sf8KGJNH8o3e6jnZ//sH7LPh234z5bYAmw/dgY7gZ3DDmONgIEdw5qwduyIDA+trsfy1TXoLVYeTw7UEf7D3+CTlWUy36nOqcfpi6KvQDBV9o4G7EniaRJhZlYBgwW/CAIGR8RzHMFwdnJ2AUD2fVG8vt7EyL8biG77d27eHwD4HBsYGDj0nQs7BsBeD7j9m79zNkz46VAF4GwzTyopVHC47EKAbwl1uNP0gTEwBzZwPs7AHXgDfxAEwkAUiAcpYAKMPguucwmYAmaAuaAUlIOlYCVYCzaAzWA72AX2gUZwGJwAp8EFcAlcA3fg6ukGL0AfeAc+IwhCQqgIHdFHTBBLxB5xRpiILxKERCCxSAqShmQiIkSKzEDmIeVIBbIW2YTUInuRZuQEcg7pRG4hD5Ae5DXyCcVQNVQbNUKt0JEoE2Wh4Wg8Oh7NRCejRWgJuhhdjdagO9EG9AR6Ab2GdqEv0H4MYKqYLmaKOWBMjI1FYalYBibBZmFlWCVWg9VjLfA5X8G6sF7sI07E6TgDd4ArOBRPwHn4ZHwWvghfi2/HG/A2/Ar+AO/DvxGoBEOCPcGLwCEkEzIJUwilhErCVsJBwim4l7oJ74hEoi7RmugB92IKMZs4nbiIuI64m3ic2El8ROwnkUj6JHuSDymKxCUVkEpJa0g7ScdIl0ndpA8qqiomKs4qwSqpKiKVYpVKlR0qR1UuqzxV+UzWIFuSvchRZD55GnkJeQu5hXyR3E3+TNGkWFN8KPGUbMpcympKPeUU5S7ljaqqqpmqp2qMqlB1jupq1T2qZ1UfqH5U01KzU2OrjVOTqi1W26Z2XO2W2hsqlWpF9aemUguoi6m11JPU+9QPNDrNkcah8WmzaVW0Btpl2kt1srqlOkt9gnqReqX6fvWL6r0aZA0rDbYGV2OWRpVGs8YNjX5NuuYozSjNPM1Fmjs0z2k+0yJpWWkFafG1SrQ2a53UekTH6OZ0Np1Hn0ffQj9F79Ymaltrc7Sztcu1d2l3aPfpaOm46iTqTNWp0jmi06WL6VrpcnRzdZfo7tO9rvtpmNEw1jDBsIXD6oddHvZeb7iev55Ar0xvt941vU/6DP0g/Rz9ZfqN+vcMcAM7gxiDKQbrDU4Z9A7XHu49nDe8bPi+4bcNUUM7w1jD6YabDdsN+42MjUKMxEZrjE4a9RrrGvsbZxuvMD5q3GNCN/E1EZqsMDlm8pyhw2AxchmrGW2MPlND01BTqekm0w7Tz2bWZglmxWa7ze6ZU8yZ5hnmK8xbzfssTCzGWMywqLO4bUm2ZFpmWa6yPGP53sraKslqvlWj1TNrPWuOdZF1nfVdG6qNn81kmxqbq7ZEW6Ztju0620t2qJ2bXZZdld1Fe9Te3V5ov86+cwRhhOcI0YiaETcc1BxYDoUOdQ4PHHUdIxyLHRsdX460GJk6ctnIMyO/Obk55TptcbozSmtU2KjiUS2jXjvbOfOcq5yvulBdgl1muzS5vHK1dxW4rne96UZ3G+M2363V7au7h7vEvd69x8PCI82j2uMGU5sZzVzEPOtJ8AzwnO152POjl7tXgdc+r7+8HbxzvHd4PxttPVowesvoRz5mPlyfTT5dvgzfNN+Nvl1+pn5cvxq/h/7m/nz/rf5PWbasbNZO1ssApwBJwMGA92wv9kz28UAsMCSwLLAjSCsoIWht0P1gs+DM4LrgvhC3kOkhx0MJoeGhy0JvcIw4PE4tpy/MI2xmWFu4Wnhc+NrwhxF2EZKIljHomLAxy8fcjbSMFEU2RoEoTtTyqHvR1tGTow/FEGOiY6pinsSOip0ReyaOHjcxbkfcu/iA+CXxdxJsEqQJrYnqieMSaxPfJwUmVSR1JY9Mnpl8IcUgRZjSlEpKTUzdmto/NmjsyrHd49zGlY67Pt56/NTx5yYYTMidcGSi+kTuxP1phLSktB1pX7hR3BpufzonvTq9j8fmreK94PvzV/B7BD6CCsHTDJ+MioxnmT6ZyzN7svyyKrN6hWzhWuGr7NDsDdnvc6JytuUM5Cbl7s5TyUvLaxZpiXJEbZOMJ02d1Cm2F5eKuyZ7TV45uU8SLtmaj+SPz28q0IY/8u1SG+kv0geFvoVVhR+mJE7ZP1Vzqmhq+zS7aQunPS0KLvptOj6dN711humMuTMezGTN3DQLmZU+q3W2+eyS2d1zQuZsn0uZmzP392Kn4orit/OS5rWUGJXMKXn0S8gvdaW0Uknpjfne8zcswBcIF3QsdFm4ZuG3Mn7Z+XKn8sryL4t4i87/OurX1b8OLM5Y3LHEfcn6pcSloqXXl/kt216hWVFU8Wj5mOUNKxgryla8XTlx5blK18oNqyirpKu6VkesblpjsWbpmi9rs9Zeqwqo2l1tWL2w+v06/rrL6/3X128w2lC+4dNG4cabm0I2NdRY1VRuJm4u3PxkS+KWM78xf6vdarC1fOvXbaJtXdtjt7fVetTW7jDcsaQOrZPW9ewct/PSrsBdTfUO9Zt26+4u3wP2SPc835u29/q+8H2t+5n76w9YHqg+SD9Y1oA0TGvoa8xq7GpKaepsDmtubfFuOXjI8dC2w6aHq47oHFlylHK05OjAsaJj/cfFx3tPZJ541Dqx9c7J5JNX22LaOk6Fnzp7Ovj0yTOsM8fO+pw9fM7rXPN55vnGC+4XGtrd2g/+7vb7wQ73joaLHhebLnleaukc3Xn0st/lE1cCr5y+yrl64Vrktc7rCddv3hh3o+sm/+azW7m3Xt0uvP35zpy7hLtl9zTuVd43vF/zh+0fu7vcu448CHzQ/jDu4Z1HvEcvHuc//tJd8oT6pPKpydPaZ87PDvcE91x6PvZ59wvxi8+9pX9q/ln90ublgb/8/2rvS+7rfiV5NfB60Rv9N9veur5t7Y/uv/8u793n92Uf9D9s/8j8eOZT0qenn6d8IX1Z/dX2a8u38G93B/IGBsRcCVf+K4DBimZkAPB6GwDUFADo8HxGGas4/8kLojizyhH4T1hxRpQXdwDq4f97TC/8u7kBwJ4t8PgF9dXHARBNBSDeE6AuLkN18KwmP1fKChGeAzZGf03PSwf/pijOnD/E/XMLZKqu4Of2Xyb0fFfhRoKeAAAAOGVYSWZNTQAqAAAACAABh2kABAAAAAEAAAAaAAAAAAACoAIABAAAAAEAAADDoAMABAAAAAEAAADwAAAAAJxI+PIAACOQSURBVHgB7Z1L0B1Vtcf7QyA8BE1ClIghCRiSmFdJkEfKIDGTCJYDy5mUVTqwSod3xORObzFnYJUDJ1cpsOqOLEFLC1+8QigIEkISIAlgEpAE0JAQIpF7fhv+J6v7dJ/T55w+Xz/2WlV9us/u/Vx7/fdaa+/d3XNJj06cOLFsbm7uf3qXd/aORYQ5OQci4MCxXhv/ryf7/71w4cJ35z4Bws5e4NIIGu9NdA7kcWDPuXPntlzwiUZwIOSxyMNi4cD6Cy+88L/m3n777RO9FrtpFEu3eztzOdBTCrsucCDk8sYDI+PARx99tBgwODkHnAM9DjgYXAycA59wwMHgouAccDC4DDgH0hxwzZDmh/+LmAMOhog735ue5oCDIc0P/xcxBxwMEXe+Nz3NAQdDmh/+L2IOOBgi7nxvepoDDoY0P/xfxBxwMETc+d70NAccDGl++L+IOeBgiLjzvelpDjgY0vzwfxFzwMEQced709MccDCk+eH/IuaAgyHizvempzngYEjzw/9FzAEHQ8Sd701Pc8DBkOaH/4uYAw6GiDvfm57mgIMhzQ//FzEHHAwRd743Pc0BB0OaH/4vYg44GCLufG96mgMOhjQ//F/EHHAwRNz53vQ0BxwMaX74v4g54GCIuPO96WkOOBjS/PB/EXPAwRBx53vT0xy4MP3X/03Kgd5nkBIOqPd9sOTDDz9Meh/AmDQ7T1cDBxwMUzK99/mj5LLLLksuvvjiVE4AAUBw/Pvf/w4ASUXwP43jgINhyi659NJLB4BAloDkoosuCgdx0BaAggOAODWPAw6GKfrkggsuSBYsWNDP4b333guCfuWVVybcs/SpT30q4bjkkkuC+SRgcHZzynKqvmsHwxS8Z+QXnT17Ntm9e3cQbIT+s5/9bLJo0aJwZE0otAZhCpcpBTDQIE71cMDBMAXfLRh6nxBO/vOf/wTzCIHufWw+HGSPTwEwel+hTz7zmc+EOLZYOd+YU2gJ1xqWO/N37WCYkNeM7po9IgvAAFmThzjQ6dOnw/H3v/89+BAAYvHixQEgNg/iutaAC/WQg2FCviPEEnYA8M477/SBYMNt9oQz6h8/fjwc/L/88sv7wPj0pz9to4drqzXQPFZrDET2gKk44GCYkH3WRHr33XdTM0SAA0cZs+gf//hHMJ8oJqs1+I/TzfHqq68GZ5w0OvA9LMlhx2knrfU1AIrTdByY66l3XxmagIeYOpoxeuWVV5LXX3+9nwsj/ubNmxON9B988EEwo44cORLMpX7ETy6kSWw4eTMrhTnFYWetbDxda+pWAFG4n0tz4KBrhtK8Oh+REVtAIBSzh5FaQs015o8IQV66dGk4ENqTJ08mb7zxRtAaxCG+SHkw0qNxOAAbmkZ+Rp4TTp2kScjPmlM2f5Xj50EOuGYY5MnIEASTmR/o/fffT5588slUGmaONm3alAor+nPmzJkAJrQGGsSSgGHDuEborROuKdpsPP2X1mD6l2unXA64Zshly4hA6y8whaqRV8J7zTXXjMjh/G2A9cUvfjEcCOo///nPoDHwNZSvYit/4jF7pRkszDHWNdAcmFZZktagLDnhMqeyZWTTxvTfNcOYvY1AIniiZ599Nswk6T/n22+/PTXtau+VvUZI0TqYYEzJIryWBAwbxjVAxQEHGJxlOmXj8Z8yyFfAiFxruGbIE5JhYVYrIDzY9HZ0ZfTNrh0My6/oHsLOYt21114bDgSWsnDU8TlsmRYY+ApoFQ7Cr7jiir6vQX6WuE97ODD7pDXkb9i4MVy7Az1mL1swYKYACCuMy5YtGzPHctEB2FVXXRUOgAAgMNHwNey0qq0L8f71r3+F49ChQ8EJlznF2U4CUAv+4+zHOnXrYCgni/1YFgyYMJAdpRHYWRMCj2/AsXLlyuB4A0y0Bg65JQsO7jGLxYHgCxg4/FknnHTSGuQH6KUxsiabLa/N1w6GMXrPrjqTTFOqXEvoNMtE2HyRnbpFS6A1jh07FkwlC1TVkXoRL+uEa2MhplWWrBMOMPBnAEeXyB3oMXoTQccngBC47JQqawnr168fI8fZRgUICC1bRdAaTK2KLDAUpjMaQcBAexT5QKycdwgQ7kBLAMqcrYn01ltvpcwj0n/hC18ok828xUHgcZo5mO7NOuGqSBYYCPibb74ZDu6xpsHMFACxTjjXTAV3hdxMKtmT2Nh2mlJgsIKE0FRJjOw2/2nzzjrhp06dSmiHdcKz5VEHrYTjhNPGjRs3hqqIJ5hNXSAHQ8letFoBc0Mjomxytl9YsJTMNjcaeXIgbLMihJ7FOg454bQJcwqQiLLg0LRuNlzx23x2MJTsPQsGHOfsdOaKFStK5jQ8GiAgb2x9zBCEbj4EDyf8c5/7XDgY6ZmSZbEPf0NEPdAMtj6WD4rX1vPshp62cqSg3taJZEHLEgJc1ZQqawf79+8PWoFRug4TBA2Hj5CdDKCd+A0ifBDCukIOhhI9iVbQaEjna0qVaw7MGc0ylcguRLFCpHwwU3iuAa2AQPKEHMCwccvmX0U8Ng6qbjoDElGHZpJCkxwM6tkhZ2si4UziM1gBLbvqrDQsfuG0IviEIfycX3vttX4t0ESUQxxseKXtR5iHC4FeRWG22XUUB4M4E9HZgsGaSAgoR5kpVcwdZm5efPHF5IUXXgjTlqz6MvqzXoHJwT4kNBBAQDMAGmxyNgOK5hMUABZSO62JRL3qMOHEh1mcXTOM4ComkJ3VYf5dwqGkeSu23FM8RvznnnsuzNQg/CJMKxxVwp566qkwswMgcGYhxcV8OnDgQAgjTzmtXEOz2B6BoFO+2kA57IQVdU0r0C6fTVLvFpytVsCcQXit/8BoacGibBAihJSn1OxUpe5zxuxAW0CYX88880xy44039reI231GL7/8ctiDhB3/1a9+NaTBjAGc1AHtRJmqW4gwxQ/1sYSmsusoXQSDawbb4znXFgwykTRacl6RM6VKOADAJCoCAusSaACEWcT1X/7yl/CCAIBnzRDyRMPouWquOQCHnpCrCgjUh71Ntp0ATvkTPgttJD7UdXbNMITzOLB2SlUmkoSCpJg6jJLEUzjxjh49GoSpKHtMDvb2aPFO8QDPY489lipX91gcW7t2bXC+pVG4JzAAIACWp6mUR5kzwi6Qqk3WRAIIxOkaORhMj9LBCCeCwDZntkh//vOfDzGw0zFLIAmCTAdGaBanGD1JAzA4Y1IpbkhofnCe7YKWuRXSyAxhoxwbALXdmoUwCarSCAzUY/Xq1SGYciXIilf2LF+F+MqHtolUN/3vyjl6MDD6I+SYQABAgkUHr1u3rt/PxLGmAYLGQhujMEIvsAgwjNAyLbhPOZYQsmEjOCPxqlWrQhmM+AjowYMHcwFEvTCpKGPXrl3BtiftpATYBGLayQSBfd7BwTApZxuYDlMEwafTWfHV7Ey2qvbBfuJbQljYvkBeecIBqAQsNAW2PuUg2KTlmjl7NAhhygMA3XDDDQEEmFE4zllTytZD15SFQ866BOAjj0mJlW8RdbWr64CuiF9K09ZzFJqBzkPoEWgcQ4RvFDEyI1wiNIdGS4VhQmVnXXTPnhm5EWwRTjmj+NVXXx1eHkA4Qkb+AIe4L730UhBqpRl1FhiIJ01i6z8qve4DyqwWs2AQaBW/S+fOggGzAicTIeawJk6ZDuT1LSJ2akqYZYczojOyMxKPSwgUC1o42UuWLAkHjjjlEF40AzWsHPK0wk+bWbMYZorl5cegASjVTsw9u47iYMjjWsPC6EDr/JYZsYc1wYLBmkjSDmgFBGMSwaVcBIxtHACKuvKsgHVch9Ut7x75WHMK3yVv2jcvrQ3DQYfUTjuLRNi4g4rNu+nXrdcMmECYFAiTbPRpmc4obU0DwCDhIG9GTUwcbPNJiVEcc4Z6lzHbhpXDrBY+CXwQoRXhByN7WaKNaAYR7bR86LJWoM2tX3R7+umnk3379lUGBJiC4ywzAQGwAsJ97Hp2b9qRmPBxCOe9CiBQplaG7doDPgh8GYfywG01g4NhHG7Oc1zsdRziqsnuQsX2RvswaurQ2kOe8FRdlzL5AQbWLLLCismjJ9PK5KOFQrWTmS2AL8rmr/CunFutGVhkqppwOO0uVLstQWVhIuFQM/o2gfA/sgtx1AuhZkuItNyousJP0oisiYSvYO8pTpfOrQYDo17VxNqBFpjo/CLneRoTqco6498wVVukpdBsmiEaVq62ixOHdnMw0yXqulagned1oFrdojMqvOpOsrNImB525ygjLKYDYGkKGKgfM1qslrNYxqwSzjlOtQiwjNIO+Bsa+YlLHvYbE1XzWXVr0rnVYMCJnXYmJtsZFgwykSRICAsmErM0FiTZPCb9j4nG7I8tD3/FHhJYBBytwJ4lAEBaNvGNItJTfwYS6w/gzIuIY7UC5TfFJFQdZ3FuNRgQTJy+qoiREOESyTmXABLOprmqtQJCff3114/9HDX1oW4CD/9ZPabeDBLY+QISgo/2wKnGdIIY/ZcvXx6AlDU5MRdFMWgF2tpqMNBhCIIVVnXgJGc7i8TIr4+BSNgYgZm5sfP5k5STTYPDPs56gNJn281CG6YSAMgSIzsgAMz4EPxnkQ+QHD58OAUqTCzMQZGDQZxo8BkBYiQv2go9btWzJpLSS+jQRAiatmbo/rTnYcJG2YzajPhcW3NF/0lPnGH5UEc0BusGTA2jUdEM+D+aiVI7mUWy2zi6vOps+67VmoGG0LFVgIHREGEXac5d/9EOjODM2uSNvIo3yZkR3ZolNg/KYuu2BYG9P841eSD4aAfKRMvhP9itK7TT1gWACSTjlNXGuK2eWoXhWgCblvkIiBxKBNBOqZK3hKRoCnOa8rHv7WyOzYsRmifcZKrZe5NcYyox0tNeNhsCDivsXGfBMEk5bUzTejBgJuGATkvWREIwNSIiHBIQwFK186x6F00EAAKEdkXOs9ZKO84ZoLMzFnOJCQNrItFOyrL8HGV6jVN20+O23kyCwYxk065GWzAgLAgGpBGZkVS7StkUx9RmHpFOZlSRra28Mc048H1wzouIOjCNTDqc3WmJiQHqzx4saSS102pazCq1Zdoy25C+E2DA1p8GDAia3jpBp2lKlWsJLjNNCNCGDRsIrpRUhgQyL3PuMZpj49v65cUtE4bzzKySRn7VIVYTCZ613kyiESwQMcJOSlYrMFOEKYRwSECYXWHklk8xaTlF6RD0YUCw6dBQ07SVvCgLc0hb09VWZpYYGEQCiv53/dwJMCCkdl583E6zYLAmEvkgKNq4J3CMm39V8VX+tGDAV4BnWQ2DVhAoKavIzKuqPU3LpxNmEkzF1sX+HZcYDe3WA8AASfC45tWQrNxijvEopV2llvAQb1yyZWTTZvNllEZjMSWafUY5m3bUf6ZU2c+UXS+x/kJsWgGedQYMCOqePXtGycHAfZxILTAxEtqpRgkkQosQcvDSYBxeBAeTBXDgSxBH8bOF6B4OKUKmA+eUMIFC15x1UCf8BP5XRYDBakDqzRGzvwBvOwMGVD9OcHa0GyVA1kTCbLBCJyElDwk6YWzV4MEiDl4YjJ0NqAAGgibhV9nkyStfJn1eWvlUcUYT4v/YdRTqi3POPVFsJhLt7gwYaAyj9ThgQMARYpEdLQkTALjOAwbhjO7MynA8//zzYY4ejQHI8DWw78kH04prtk3YvMhjPgmwAk5NqVI29bOr7wAhpilV8b9zYOCt12WJWSK7wIRfYEd1K7RlgEF8VpPZPsGWaIR/ZW/1GOceoCJwmEiasWIbhNVEZes9TTzAgClIuWoT9bZgiNFfgKedAgOqnlmSsiremkgsRGlRLQ8ENgzGWUHiP6QwrolPPdjhqnDMODQR5WJSsX2aMtniATBUPulnQfhGPCKKyQapTaw5MNUqcjCIEy0+09nMDGWnDIuaZLdsSysQV8LLtQSmTLiNa+MrHBOJb7RxAFq0hcCBaYWjTBzAwVG11gAI8Aj+UCe1k7JFhFddrvJu+rlTmgFmo+7LgAEn0q5NZN8vqo6TwPBfQs31pOHKg9EXAOKn8LJgnHDqjta47rrrgs2OOQU40BpVPFmHicT0rJ4OVF3cRKJHO2Ym0SBG2zJktQIjMtOmEg7SS9htWFG44nLfxi8bThoccEy1vXv3hqlbnG+0BqM2Z8CAtkCYJ3XC0Qz4MraOaKjYp1TpN6hzmkEP/Ng9+h83Nf1r/QVrIimWFZhRQm3jkl7xbbjCuD8qHMFHaDlIh6MvcwrBxYwBEACDo4yNz0QBhxYVqQeU3cpSJq+PU3bvt3NgoIvQDqPAgICJsgKicJ1HCS/xRgm7zcPGHxXOfaZBOXbv3h3WUmROod1wxHG8BY6iqWVMJFau0T62TGsi4fDbe2p/LOdOgoEOxkkdRnZKFUEqS1ZYRgGAPKuIb/Ogrgg8M0LWCUdz0G5GdplT1gkHDDwzofUD1V37rqhrzFqB9ncSDHQ85hK+QBExQko7bN26NbyXFHMJASpLVkhJIwGz4QrjftXhCC9aTZqNCQH5Git76xuUB3BoE9O6drsK95hOZeVe5GAQJzp0RgAxlYY944DmEBgQiptvvjkcCA6g4GDLgkbSMuzJE3YbRh4CR5lwxSWdjV8UDsA5EHo0H8DgwAknffa5bqsVaGesU6rwF5rrMe/8yzU/DuvELx3PlOUwuummm8K7hKxw2fiMlEzTMu0KODQlaeOUuS7Kv4rwMnkQB02JY27jb9++vT+ThBad9aJfGV7VGOdgJ80kGMqsCwtMw0Z2XmfP9o01a9aE+X1rMpAHu1FxUDkgpj+lNbJTsSFCwU+ZUd0K6TjxbVyKVz7ZcK1TKJxNedKMpIvdRAq866pmoHF8TxmhLUvMwzNDw7QrzihgKiJGUmkNNMekzxhIeG05eWHcrzIcgH/ta18LxQIQpmgFFFuXiK4PdtZMohOZceH5g0kIswJbG7sagAx7YB8hwlYHFBxokEloHGEfJy51yca/7bbbwko399AKRVOy3I+Eug0GpiEfeeSRqfsSQWKmBlBwsCFwGCFY+CwczPRMYoJkhVfljRNeFBeN953vfKe/YxdfYdjMm8ru+LnbYKDzfv/731fuGDJTw7w+wOCMb1FEzNCwZRpfg4eBJnnAp0ioJw3HV9ixY0e/yphIw3yrfsRuX3QfDDxww/MFsyKeWWAaF5MKO5w1jmGEtgIYmFPjTt2S76QAsHXatGlTsnHjxhAEWMdZW7H5dOy6+2DgdYpPPPHEvPUbTjjAkNYo44RjTgGOSaZuxwGH4t511139HbvMMk1S7rwxdP4K6u7UqniIScDoPV8LSoz8HAcOHAjbJQQMZqh4iMYSTvqK3msjOeSEAww0h177aOPnXdsZIAk78fLCCctuXZ/En8mrRxfCOj2bpA7auXNn6gF4hc/3meeg5YSzW9QKb7YujNg432iMSZzworxXrVqVbNmyJRQHOEZtaMzWq8P/u28m0XmHe+8n5d1HTSKccNYyBA77ZopsPXFuWS8BGGwxweEdhywwtm3b1l9EZG1kEod+nLJbFLf7ZhKdUfaBn/nsOHwJRmY0AMINOJiV4sCss0RcVtQ5Nm/eHMwwLfihNUbNBMlkIh/MNpGbSOLEx+fObsewzcROZjNenbMmjM7MNKENAKd9Kx915VkCDpxZhFbAYJu2HdmJi5POccMNN4Q0Aga+xrD9RZRtp4EdDHDzPEUBBpqLIMw3GLT/h7Kzgni+CwavGOlZBOMACABC4AAolrgnU4twfADMKYDBTJq0AvdYExHF/iCP+GDP0YCB0ZgZnlkTIzaCj4PMSnVWeMctH2FmBNcojgklYACELKFxOHh1PloGUGBK4R/wRVGR8tN/P/fWcLq8Uc92MEL129/+duINdTYve41w6iVh7GMatofJpqviGq0BMKQ5ygIPXqAlR/kaVdSxRXnE4UDTIQgODigj5bTEegEjvzRA1uGdNv+y6RFqRnztmBUoAMiwOqExHAiDXB7Us4NxOhPCwtckYGDExeTB1OKwX/lpEnOKnHCAwWDAwiOzV24i5fdaVGBAkNEOOJajiNVhRn7SoAXy7PNRedR53zrhddajTWVH4zOoUxg9n3322bC9WmGcGTlxPDX6Mw1KmFM0HIhjBTqvO1no4l1EmAzMADH6ow2couVAvGCItsu94UUcOJhewSmK5uHOgQg44GCIoJO9ieU44GAoxyePFQEHHAwRdLI3sRwHHAzl+OSxIuCAgyGCTvYmluOAg6EcnzxWBBxwMETQyd7EchxwMJTjk8eKgAMOhgg62ZtYjgMOhnJ88lgRcMDBEEEnexPLccDBUI5PHisCDjgYIuhkb2I5DjgYyvHJY0XAAQdDBJ3sTSzHAQdDOT55rAg44GCIoJO9ieU44GAoxyePFQEHHAwRdLI3sRwHHAzl+OSxIuCAgyGCTvYmluOAg6EcnzxWBBxwMETQyd7EchxwMJTjk8eKgAMOhgg62ZtYjgMOhnJ88lgRcMDBEEEnexPLccDBUI5PHisCDjgYIuhkb2I5DrTuyz333ntvv2V8XORHP/rRwBc1bZx77rmnH99evPbaa8lzzz0XvoT53nvvhVt8norPw27cuDFZvny5jV7qeli59h6f07r77rsL8/zFL36R+txWURv4pttPf/rT1Cd9+d71j3/845EfWuHrRXy0hc/knjx5MnxPmo8zXn755eHD6StWrEjWrFkzUEfbjoGbJqCoziZK4y5bBwbLQb55/MILL4TPvNrwYdd8ueehhx5K9u7dOxCN/JTnl7/85eTOO++cyeer+K4cB6DIku5lw/P+v/rqqykgEIeveBKOMOcRn7f64x//mOzatWvgNoMCx5tvvpns3r07aaNADzRqjIBWg4F2PvHEE8n69etHjoTiiQUCX+vZtm1b+Kg49xklERS+6COwfPvb31bSSs9PPvlk8t3vfncgT8LL0t/+9rd+VL7wqQ8XEl4Ehj/84Q/JM888E9KhRbZu3Rq+D33JJZeEj7C/8847CVrzxRdf7OdddNE1sLTaZ1i4cGHS+451sn///qL+SoUzYkrIEYTvfe97yXXXXdf/yDjXhHEPIi5pqia+vvnKK68kx48fT2XNf8KHfbZWCT744INUu7/5zW/qVvj4O/ezdPTo0T4QMIe+//3vB63Kp3z5oilmEt+yvvXWW5Mf/OAH2eSd/99qMNx2222hgx5//PEE+3kU2ZGUtIyGWSJM+XLPpsnGnfT/unXrQn137tyZygKtQDu4P4oAKp+yhZYuXZpg1vF1UghTMG9kx0cQIfBN/YSv6jjf51aDAfMIJxpn8OWXXx7JO/sN6CIzgkzsvSNHjozMd9wIN998czDrEGhsfIgz//nCKPdHkQXphg0bQnQcf5G9rzDMQNGXvvQlXfr5Ew602mdAtW/ZsiU4xI899liyatWqoR2rWSMi8YXPIpKZxH2bpij+uOFXXXVVsnLlyuTgwYPBkd2+fXvy1FNPJTi3mGrcH0aYU8eOHQtR+D41WgHi/MgjjwTNgEl04sSJ8DH3cLP3Y9uS1/68maJhfkFefMoalkZ1aeK51ZoBhko7vPHGG8mhQ4cq4XEZk2vagjT6M2uD38MZuuWWW0ZmbUd9BgCZe5ztiG/jZTP1b1xnOZIkrdYMNCerHRhxiwgbme8/Q8yt44DnEfdEs7KrMcX4ADvTmA888EAYzbH5R61voD2YThbJRNJ/TKV9+/aFv3v27Em+/vWv99dh0AbMFkGcsxpII3rRiB8Smh/FN0Gtvmw9GOA+2gEnGp+AacEiYl5fYDh8+HAhGLgnYhFuVoR2+PWvf933G6QthpWHaXXq1Kl+lF/96lf96+wF8dCW119/fbi1bNmyPhiYgcuCIZs+tv+tN5PoMGkHrgFFEVkHk5mbM2fODEQljLULkU2jsKrOa9eu7U/j4qfkrfhmy3r++eezQUP/W1Ppxhtv7Mel/aynOJ3nQCc0A82RdrCj+vlmfnyFCYIAMu2IhvjlL3+ZfOMb3+ivBGvRTTM8OKSjzJZsGeP8B8Q/+clPSic5ffp0ataMrSiLFi0aSI8P8rOf/SyEM8v2/vvvhzUEzDC0D846C3Rs+2AaefXq1QGUmGCYbbFSZ8CAYNGxDz/88NC+vOuuu/rTmoyMDz74YG58gMB2jCYRvoLWFjDf8oBAfQnnPtPCxCfdTTfdFJrCijszUGg/Fub+9Kc/hWOSdg7zLdroT3QGDHQm2oFOZn9RESEIbLHYtGlTWFDDz9CUI84yfgWm0Sw1QlHdRoVbE2mU+cZ9rZGQTmBgFun2228PvGIRjhV2tOTZs2cDSHCyFy9eHMA0aqp6VH3bdn+up1JHL922rVVeX+fA+Bw42AkHevx2ewrnwCAHHAyDPPGQSDngYIi0473ZgxxwMAzyxEMi5YCDIdKO92YPcsDBMMgTD4mUAw6GSDvemz3IAQfDIE88JFIOOBgi7Xhv9iAHWrMdo+w7gn7+85+Hx0BpKg/Js+2iiHhvkvYy8WyBfQi+bHk2b7tXJ7s3Z9g9m0f2etp6KD9eMqB3IrE1g+3cWRq3jjZ+Ni/7P8sLe69J163RDOyh0W5SMZD/2bdX2Idd7PZlpbFne9+mI07Z8mx+s7iuqh5s2INfPMdw//33p3a/zqLebcyzNZrBCu6wdwTxZgl2YtL5bFRjO3Pe7k7CtZGNUTP7Roqy5c2606eth0Zldqj++c9/Dq+KQds8+uijqUdEp22Hypk2nzrTt0IzjPOOIN4BVOY5YCtkxOedQaJxylOaWZyrrMeCBQvCC8NUz+w7mxQe87kVYBj3HUHW5OE5YB5ascR/wkXZ7dDjlqd8qj7Psh7+QoDB3moFGOwoLkG3Amzv00Ret4KzCPGsQvbpN54L1jMMxMu+RMDmV6a8UNAMfqqsB1qG1+mIePGYU5oDjfcZJnlHEE+94QPweCOEUAEQkRUyHggivmiS8pS2ynNV9cib8eEBpzvuuKPK6iZ55VBAm3yJ81JQKWuqy8wK7jjvCLKa46WXXgrPAVMrnge2b9+z8bg/aXmkrZJmWQ9eP/nXv/41PPZZZZ3bnlejNcM07wjiNSiYArx5jpkl7O/NmzeH54H5D/GSXR5xFE1TnvKo4lxlPTQyAwDelcQb9zATOXjj+I4dO6qocqs0QFGDGw2Gad4RRIMZ9fUaRkZawDDsOeJpyyti8rjhs6gHphGv4P/Wt76V3HfffaFKBw4cqAwM47axifEbbSZZwS3DPGtaEJ/Xwuj17rwChfz0KhTCuW9p2vJsXtNcz7IeaB0RTrXTeQ40VjNM+44gmsi7R3knECYS9Lvf/S6c+SGcuXdRFeUpr2nOs6oHpiELjZhJIr3CXv9jPzcWDFW8I4jOxVQSGLCbRVnHuarylP+wc9HMC2l4I7d8mknfjWTLLipr1IxSUTrylh9Sppyi+DZtU64bayZZUyEruFnm2fs2HfF4/5F9xTxh/M++F8mms/kRP0v2vk2XjTfJf5ufLScvL3vfpsuLyyIb21iYMPjKV76S/PCHP8zdrJeXNpYwf29SLD3t7RzFAX9v0igO+f14ONBYMymeLvCWNoUDDoam9ITXo3YOOBhq7wKvQFM44GBoSk94PWrngIOh9i7wCjSFAw6GpvSE16N2DjgYau8Cr0BTOOBgaEpPeD1q54CDofYu8Ao0hQMOhqb0hNejdg44GGrvAq9AUzjgYGhKT3g9aueAg6H2LvAKNIUDDoam9ITXo3YOOBhq7wKvQFM44GBoSk94PWrngIOh9i7wCjSFAw6GpvSE16N2DjgYau8Cr0BTOOBgaEpPeD1q54CDofYu8Ao0hQMOhqb0hNejdg44GGrvAq9AUzjgYGhKT3g9aueAg6H2LvAKNIUDDoam9ITXo3YOOBhq7wKvQFM44GBoSk94PWrngIOh9i7wCjSFAw6GpvSE16N2DjgYau8Cr0BTOOBgaEpPeD1q54CDofYu8Ao0hQMOhqb0hNejdg44GGrvAq9AUzjgYGhKT3g9aueAg6H2LvAKNIUDDoam9ITXo3YOOBhq7wKvQFM4ABjebkplvB7Ogbo4MDc3dwIw/KauCni5zoEGceA3cydOnFjWQ8XOXqWWNqhiXhXnwHxyYM+5c+e2XLB48eLXP/roo1t6Jf9v73CTaT67wMuqmwPHehW4r6cMti5ZsuTk/wPlEukvolay7QAAAABJRU5ErkJggg==",alt:i,title:a,"data-id":""===o?s.v4():o,"data-fileid":c},Object.keys(u).reduce((function(e,t){return e["data-".concat(t)]=u[t],e}),{}))],t()}},pe={attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},content:"image* figcaption{0,1}",group:"block",marks:"",parseDOM:[{tag:"figure",getAttrs:function(e){return{id:e.dataset.id,track:t.SchemaHelpers.parseTracks(e.dataset.track),group:e.dataset.group,viewid:e.dataset.viewid}}}],toDOM:function(e){var t,n={};return(null===(t=e.attrs.track)||void 0===t?void 0:t.length)&&(n["data-id"]=e.attrs.id,n["data-track"]=JSON.stringify(e.attrs.track),n["data-group"]=e.attrs.group,n["data-viewid"]=e.attrs.viewid),["figure",n,0]}},me={content:"inline*",group:"figure",draggable:!1,attrs:{id:{default:""},class:{default:""}},parseDOM:[{tag:"figcaption",getAttrs:function(e){return{id:e.getAttribute("id"),class:e.getAttribute("class")}}}],toDOM:function(e){return["figcaption",e.attrs,0]}},ge="",he=0;function ve(e,t,n,r,i,a,o){try{var c=e[a](o),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(r,i)}function ye(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){ve(a,r,i,o,c,"next",e)}function c(e){ve(a,r,i,o,c,"throw",e)}o(void 0)}))}}function ke(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var xe=function(e,t,n){var r=n.getState(e).find(null,null,(function(e){return e.id===t}));return r.length?r[0].from:null},be=function(e,t,n){for(var r=0;r<e.length;r+=1){var i=t.state,a={},o=i.tr;o.selection.empty||o.deleteSelection(),o.setMeta(n,{add:{id:a,pos:o.selection.from}}),t.dispatch(o);var c=xe(t.state,a,n);if(null==c)return;t.dispatch(i.tr.replaceWith(c,c,t.state.schema.nodes.image.create({id:s.v4(),src:e[r].source,fileid:e[r].id})).setMeta(n,{remove:{id:a}}))}};function we(){var e=ke(["\n  input {\n    display: none;\n  }\n"]);return we=function(){return e},e}var Ee,Ce=p.div(we()),Se=function(e){var a=e.item,o=e.fileUpload,s=e.view,l=c.useTranslation(),f=l.t,p=l.i18n,m=a.title,g=n.useContext(t.WaxContext),h=g.app,v=g.activeView,y=g.activeViewId,k=g.pmViews.main,x=k.props.editable((function(e){return e})),b=n.useRef(null),w=h.PmPlugins.get("imagePlaceHolder"),E=h.config.get("config.ImageService"),C=function(){if("main"!==y){var e=t.DocumentHelpers.findBlockNodes(s.state.doc),n="";e.forEach((function(e){e.node.attrs.id===y&&(n=e)})),k.dispatch(k.state.tr.setMeta("outsideView",y).setSelection(new u.TextSelection(k.state.tr.doc.resolve(n.pos+1+g.pmViews[y].state.selection.to))))}E&&E.handleAssetManager?function(){S.apply(this,arguments)}():b.current.click()};function S(){return(S=ye(d.mark((function e(){var t,n;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=E.handleAssetManager,e.next=3,t();case 3:n=e.sent,be(n,s,w);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var A=g.options.uploading||!a.select(v)||!x;return n.useMemo((function(){return r.createElement(Ce,null,r.createElement("label",{htmlFor:"file-upload"},r.createElement(t.MenuButton,{active:!1,disabled:A,iconName:a.icon,onMouseDown:function(e){e.preventDefault(),C()},title:!i.isEmpty(p)&&p.exists("Wax.Images.".concat(m))?f("Wax.Images.".concat(m)):m}),r.createElement("input",{accept:"image/*",id:"file-upload",onChange:function(e){o(e.target.files[0]),g.setOption({uploading:!0}),b.current&&(b.current.value="")},ref:b,type:"file"})))}),[A,y,f("Wax.Images.".concat(m))])},Ae=function(e){var a=e.view,o=e.displayed,c=e.config,u=e.pmplugins,l=e.item,d=n.useContext(t.WaxContext);if(i.isEmpty(a))return null;var f=function(e,n,r,i){return function(a){var o=i.app.config.get("config.EnableTrackChangeService");(null==o?void 0:o.enabled)&&2!==i.pmViews.main.state.doc.resolve(i.pmViews.main.state.tr.selection.from).parent.nodeSize&&t.Commands.simulateKey(i.pmViews.main,13,"Enter");var c={},u=i.pmViews.main.state.tr;u.selection.empty||u.deleteSelection(),u.setMeta(r,{add:{id:c,pos:u.selection.from}}),e.dispatch(u),n(a).then((function(t){var n=t,a={};"object"==typeof t&&(n=t.url,a=t.extraData);var o=function(e,t,n){var r=n.getState(e).find(null,null,(function(e){return e.id===t}));return r.length?r[0].from:null}(e.state,c,r);null!=o&&(2===i.pmViews.main.state.doc.resolve(o).parent.nodeSize&&(o-=1),i.setOption({uploading:!1}),i.pmViews.main.dispatch(i.pmViews.main.state.tr.replaceWith(o,o,i.pmViews.main.state.schema.nodes.image.create({src:n,id:s.v4(),extraData:a})).setMeta(r,{remove:{id:c}})))}),(function(){e.dispatch(u.setMeta(r,{remove:{id:c}})),i.setOption({uploading:!1})}))}}(a,c.get("fileUpload"),u.get("imagePlaceHolder"),d);return o?r.createElement(Se,{fileUpload:f,item:l.toJSON(),key:s.v4(),view:a}):null},Te=o.injectable()(Ee=function(e){I(i,t.Tools);var n=L(i);function i(){var e;W(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=n.call.apply(n,[this].concat(r))).title="Upload Image",e.icon="image",e.name="Image",e.select=function(e){return null!==e.state.selection.from&&!e.props.disallowedTools.includes("Images")},e}return J(i,[{key:"renderTool",value:function(e){return r.createElement(Ae,{config:this.config,displayed:this.isDisplayed(),item:this,key:s.v4(),pmplugins:this.pmplugins,view:e})}},{key:"run",get:function(){return!0}},{key:"enable",get:function(){return function(e){return t.Commands.canInsert(e.config.schema.nodes.image)(e)}}}]),i}())||Ee;function Oe(){var e=ke(["\n  background: #e2ebff;\n  border: none;\n  box-sizing: border-box;\n  width: 240px;\n  min-height: 20px;\n  padding: 4px;\n\n  &:focus {\n    outline: none;\n  }\n\n  &::placeholder {\n    color: black;\n    font-weight: bold;\n  }\n"]);return Oe=function(){return e},e}var Me,De,je,Be,Pe,We,Ne,Ie,He,Re,ze,Ve,Le,Ge,Je,Fe,qe,Qe,Ye,Ke,Ue,Ze,Xe,_e,$e,et,tt,nt,rt,it,at,ot,ct,st,ut=p.input(Oe()),lt=function(e){var i=e.setPosition,a=e.position,o=n.useRef(null),c=$(n.useState(""),2),s=c[0],u=c[1],l=n.useContext(t.WaxContext),d=l.app,f=l.activeView,p=l.pmViews.main,m=!p.props.editable((function(e){return e}));n.useLayoutEffect((function(){var e=p.dom.getBoundingClientRect(),t=f.state.selection;if(t&&t.node&&"image"===t.node.type.name){var n=t.node.attrs.id,r=document.querySelector("[data-id='".concat(n,"']"));r||(r=document.querySelector("[data-fileid='".concat(t.node.attrs.fileid,"']")));var o=document.getElementsByTagName("figcaption")[0];if(r&&o){var c=r.getBoundingClientRect(),s=o.getBoundingClientRect().height-5,u=c.left-e.left,l=c.bottom-e.top-s;i(de(de({},a),{},{left:u,top:l}))}}}),[a.left,a.top]);var g=d.config.get("config.ImageService"),h=g&&g.showAlt;return!m&&h?r.createElement(ut,{key:"alt",onChange:function(){var e=f.state.selection;u(o.current.value),f.dispatch(f.state.tr.setNodeMarkup(e.from,void 0,de(de({},e.node.attrs),{},{alt:o.current.value})).setMeta("imageAlt",!0))},placeholder:"Alt Text",ref:o,type:"text",value:f.state.selection&&f.state.selection.node&&""!==f.state.selection.node.attrs.alt?f.state.selection.node.attrs.alt:s}):null},dt=o.injectable()(Me=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("Image")(r,void 0,0)||r}())||Me,ft=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Images").to(dt)}}]),r}(),pt=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="ImageService",e.dependencies=[new ft],e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("imagePlaceHolder",function(e){return new u.Plugin({key:new u.PluginKey(e),state:{init:function(){return l.DecorationSet.empty},apply:function(e,t){t=t.map(e.mapping,e.doc);var n=e.getMeta(this);if(n&&n.add){var r=document.createElement("placeholder"),i=l.Decoration.widget(n.add.pos,r,{id:n.add.id});t=t.add(e.doc,[i])}else if(n&&n.remove){var a;(null===(a=t=t.remove(t.find(null,null,(function(e){return e.id===n.remove.id}))))||void 0===a?void 0:a.find().length)>=1&&((t=t.remove(t.find()[0])).children=[])}return t}},props:{decorations:function(e){return this.getState(e)}}})}("imagePlaceHolder")),this.app.PmPlugins.add("caption",function(e){return new u.Plugin({key:new u.PluginKey(e),state:{init:function(){return l.DecorationSet.empty},apply:function(e,t){var n=t;return n=(n=n.map(e.mapping,e.doc)).remove(t.find(null,null,(function(e){return null!=e.id})))}},props:{decorations:function(e){return this.getState(e)},handleDOMEvents:{mousedown:function(e,t){var n=e.state.plugins.find((function(e){return e.key.startsWith("caption$")}));if("IMG"===t.target.nodeName&&"FIGCAPTION"!==t.target.parentNode.lastElementChild.nodeName){ge=t.target.getAttribute("data-id");var r=e.posAtDOM(t.target),i=e.state.tr;r+=1,e.dispatch(i.replaceWith(r,r,e.state.schema.nodes.figcaption.create({class:"decoration",id:ge})).setMeta(n,{add:{id:{},pos:r}}))}if("IMG"===t.target.nodeName){var a=e.posAtDOM(t.target),o=e.state.selection.$from,c=o.sharedDepth(a);if(0===c)return!1;a=o.before(c),e.dispatch(e.state.tr.setSelection(u.NodeSelection.create(e.state.doc,a)))}return!1},keyup:function(e,n){if("Enter"===n.key&&(e.state.selection.$head.path[6]&&"figcaption"===e.state.selection.$head.path[6].type.name&&(he+=1,setTimeout((function(){he=0}),1500)),e.state.selection.$head.path[6]&&"figcaption"===e.state.selection.$head.path[6].type.name&&2===he)){var r="";e.state.doc.nodesBetween(e.state.selection.from,e.state.selection.from,(function(e){"figcaption"===e.type.name&&(r=e.attrs.id)}));var i=document.getElementById(r);e.dispatch(e.state.tr.setSelection(u.NodeSelection.create(e.state.doc,e.posAtDOM(i.parentElement)))),t.Commands.simulateKey(e,13,"Enter"),t.Commands.simulateKey(e,13,"Enter"),he=0}if("Delete"===n.key||"Backspace"===n.code){var a=e.state.selection.$head.path;if(a[6]&&"figcaption"===a[6].type.name){var o=document.getElementById(a[6].attrs.id);o&&"FIGCAPTION"===o.parentElement.firstChild.tagName&&o.parentElement.remove()}}}}}})}("caption"))}},{key:"register",value:function(){this.container.bind("Image").to(Te);var e=this.container.get("CreateNode"),t=this.container.get("CreateOverlay");e({figure:pe}),e({image:fe},{toWaxSchema:!0}),e({figcaption:me}),t(lt,{},{nodeType:"image",findInParent:!1,markType:"",followCursor:!1,selection:!1})}}]),r}(),mt={parseDOM:{tag:"code"},toDOM:function(e,t){e.value=["code",0],t()}},gt=o.injectable()(De=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle code",e.icon="code",e.name="Code",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.code)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.code)(e)}}}]),r}())||De,ht=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Code").to(gt);var e=this.container.get("CreateShortCut");this.container.get("CreateMark")({code:mt},{toWaxSchema:!0}),e({"Mod-`":m.toggleMark(this.schema.marks.code)})}}]),r}(),vt={parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(e){return"normal"!==e.style.fontWeight&&null}},{style:"font-weight",getAttrs:function(e){return/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}}],toDOM:function(){return["strong",0]}},yt=o.injectable()(je=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle strong",e.icon="bold",e.name="Strong",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.strong)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.strong)(e)}}}]),r}())||je,kt=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Strong").to(yt);var e=this.container.get("CreateMark"),t=this.container.get("CreateShortCut");e({strong:vt}),t({"Mod-b":m.toggleMark(this.schema.marks.strong)})}}]),r}(),xt={parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(e,t){e.value=["em",0],t()}},bt=o.injectable()(Be=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle emphasis",e.icon="italic",e.name="Emphasis",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.em)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.em)(e)}}}]),r}())||Be,wt=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Emphasis").to(bt);var e=this.container.get("CreateMark"),t=this.container.get("CreateShortCut");e({em:xt},{toWaxSchema:!0}),t({"Mod-i":m.toggleMark(this.schema.marks.em)})}}]),r}(),Et={excludes:"superscript",parseDOM:[{tag:"sub"},{style:"vertical-align=sub"}],toDOM:function(e,t){e.value=["sub"],t()}},Ct=o.injectable()(Pe=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle subscript",e.icon="subscript",e.name="Subscript",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.subscript)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.subscript)(e)}}}]),r}())||Pe,St=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="SubscriptService",e}return J(r,[{key:"register",value:function(){this.container.bind("Subscript").to(Ct),this.container.get("CreateMark")({subscript:Et},{toWaxSchema:!0})}}]),r}(),At={excludes:"subscript",parseDOM:[{tag:"sup"},{style:"vertical-align=super"}],toDOM:function(e,t){e.value=["sup"],t()}},Tt=o.injectable()(We=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle superscript",e.icon="superscript",e.name="Superscript",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.superscript)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.superscript)(e)}}}]),r}())||We,Ot=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="SuperscriptService",e}return J(r,[{key:"register",value:function(){this.container.bind("Superscript").to(Tt),this.container.get("CreateMark")({superscript:At},{toWaxSchema:!0})}}]),r}(),Mt={attrs:{class:{default:"strikethrough"},style:{default:"text-decoration:line-through"}},inclusive:!1,parseDOM:[{tag:"span.strikethrough",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class"),style:e.dom.getAttribute("style")}),t()}}],toDOM:function(e,t){e.value=["span",e.node.attrs,0],t()}},Dt=o.injectable()(Ne=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle strikethrough",e.icon="strikethrough",e.name="StrikeThrough",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.strikethrough)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.strikethrough)(e)}}}]),r}())||Ne,jt=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("StrikeThrough").to(Dt),this.container.get("CreateMark")({strikethrough:Mt},{toWaxSchema:!0})}}]),r}(),Bt={parseDOM:[{tag:"u"}],toDOM:function(e,t){e.value=["u"],t()}},Pt=o.injectable()(Ie=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle underline",e.icon="underline",e.name="Underline",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.underline)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.underline)(e)}}}]),r}())||Ie,Wt=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Underline").to(Pt);var e=this.container.get("CreateShortCut");this.container.get("CreateMark")({underline:Bt},{toWaxSchema:!0}),e({"Mod-u":m.toggleMark(this.schema.marks.underline)})}}]),r}(),Nt={attrs:{class:{default:"small-caps"}},parseDOM:[{tag:"span.small-caps",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){e.value=["span",e.node.attrs,0],t()}},It=o.injectable()(He=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Toggle Small Caps",e.icon="smallCaps",e.name="SmallCaps",e.select=function(e){return null!==e.selection.from},e}return J(r,[{key:"run",get:function(){return function(e,t){m.toggleMark(e.config.schema.marks.smallcaps)(e,t)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.smallcaps)(e)}}}]),r}())||He,Ht=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("SmallCaps").to(It),this.container.get("CreateMark")({smallcaps:Nt},{toWaxSchema:!0})}}]),r}(),Rt=o.injectable()(Re=function(e){I(c,t.ToolGroup);var a=L(c);function c(e,t,n,r,i,o,s,u,l){var d;return W(this,c),(d=a.call(this)).tools=[],d.tools=[i,t,e,n,r,u,o,s,l],d}return c=o.inject("SmallCaps")(c,void 0,8)||c,c=o.inject("Underline")(c,void 0,7)||c,c=o.inject("Superscript")(c,void 0,6)||c,c=o.inject("Subscript")(c,void 0,5)||c,c=o.inject("Strong")(c,void 0,4)||c,c=o.inject("StrikeThrough")(c,void 0,3)||c,c=o.inject("Link")(c,void 0,2)||c,c=o.inject("Emphasis")(c,void 0,1)||c,J(c=o.inject("Code")(c,void 0,0)||c,[{key:"renderTools",value:function(e){var a=this;if(i.isEmpty(e))return null;var o=this.constructor.name;return n.useMemo((function(){return r.createElement(t.ToolGroupComponent,{key:s.v4(),view:e,tools:a._tools,title:a.title,name:o})}),[e])}}]),c}())||Re,zt=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="AnnotationToolGroupService",e}return J(r,[{key:"register",value:function(){this.container.bind("Annotations").to(Rt)}}]),r}(),Vt=[new ht,new kt,new wt,new St,new Ot,new jt,new Wt,new Ht,new zt],Lt=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=Vt,e}return r}(),Gt={group:"block",content:"list_item+",attrs:{track:{default:[]}},parseDOM:[{tag:"ul",getAttrs:function(e,n){Object.assign(e,{track:t.SchemaHelpers.parseTracks(e.dom.dataset.track)}),n()}}],toDOM:function(e,t){var n={};e.node.attrs.track&&e.node.attrs.track.length&&(n["data-track"]=JSON.stringify(e.node.attrs.track)),e.value=["ul",n,0],t()}},Jt=o.injectable()(ze=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).title="Wrap in bullet list",e.content=t.icons.bullet_list,e.icon="bulletList",e.name="BulletList",e.select=function(t,n,r){var i=t.selection,a=i.from,o=i.to,c=!0;return g.wrapInList(t.config.schema.nodes.bulletlist)(r.state)||(c=!1),"subList"in e.config&&!e.config.subList&&t.doc.nodesBetween(a,o,(function(e){"list_item"===e.type.name&&(c=!1)})),null!==a&&(r.props.disallowedTools.includes("Lists")&&(c=!1),"main"!==n&&1===r.state.selection.$from.start(1)&&(c=!1),c)},e}return J(r,[{key:"run",get:function(){return function(e,t){return g.wrapInList(e.config.schema.nodes.bulletlist)(e,t)}}},{key:"enable",get:function(){return function(e){return g.wrapInList(e.config.schema.nodes.bulletlist)(e)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.bulletlist)(e)}}}]),r}())||ze,Ft=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="BulletListService",e}return J(r,[{key:"register",value:function(){var e=this,t=this.container.get("CreateShortCut"),n=this.container.get("CreateNode");this.container.bind("BulletList").toDynamicValue((function(){return new Jt(e.config)})),n({bulletlist:Gt},{toWaxSchema:!0}),t({"Shift-Ctrl-8":function(t,n){e.container.get("BulletList").run(t,n)}})}}]),r}(),qt={group:"block",content:"list_item+",attrs:{order:{default:1},track:{default:[]}},parseDOM:[{tag:"ol",getAttrs:function(e,n){Object.assign(e,{order:e.dom.hasAttribute("start")?+e.dom.getAttribute("start"):1,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track)}),n()}}],toDOM:function(e,t){var n={};1!==e.node.attrs.order&&(n.start=e.node.attrs.order),e.node.attrs.track&&e.node.attrs.track.length&&(n["data-track"]=JSON.stringify(e.node.attrs.track)),e.value=["ol",n,0],t()}},Qt=o.injectable()(Ve=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Wrap in ordered list",e.icon="numberedList",e.name="OrderedList",e.select=function(t,n,r){var i=t.selection,a=i.from,o=i.to,c=!0;return g.wrapInList(t.config.schema.nodes.bulletlist)(r.state)||(c=!1),"subList"in e.config&&!e.config.subList&&t.doc.nodesBetween(a,o,(function(e){"list_item"===e.type.name&&(c=!1)})),null!==a&&(r.props.disallowedTools.includes("Lists")&&(c=!1),"main"!==n&&1===r.state.selection.$from.start(1)&&(c=!1),c)},e}return J(r,[{key:"run",get:function(){return function(e,t){g.wrapInList(e.config.schema.nodes.orderedlist)(e,t)}}},{key:"enable",get:function(){return function(e){return g.wrapInList(e.config.schema.nodes.orderedlist)(e)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.orderedlist)(e)}}}]),r}())||Ve,Yt=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="OrderedListService",e}return J(r,[{key:"register",value:function(){var e=this,t=this.container.get("CreateShortCut");this.container.bind("OrderedList").toDynamicValue((function(){return new Qt(e.config)})),this.container.get("CreateNode")({orderedlist:qt},{toWaxSchema:!0}),t({"Shift-Ctrl-9":function(t,n){e.container.get("OrderedList").run(t,n)}})}}]),r}(),Kt=o.injectable()(Le=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Join with above block",e.icon="arrowUp",e.name="JoinUp",e.select=function(t,n,r){var i=t.selection,a=i.from,o=i.to,c=m.joinUp(t);return"subList"in e.config&&!e.config.subList&&t.doc.nodesBetween(a,o,(function(e){"list_item"===e.type.name&&(c=!1)})),null!==a&&(r.props.disallowedTools.includes("Lists")&&(c=!1),c)},e}return J(r,[{key:"run",get:function(){return m.joinUp}},{key:"enable",get:function(){return m.joinUp}},{key:"active",get:function(){return function(e){return!1}}}]),r}())||Le,Ut=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="JoinUpService",e}return J(r,[{key:"register",value:function(){var e=this;this.container.bind("JoinUp").toDynamicValue((function(){return new Kt(e.config)}))}}]),r}(),Zt=o.injectable()(Ge=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Lift out of enclosing block",e.icon="indentDecrease",e.name="Lift",e.select=function(e,t,n){return!n.props.disallowedTools.includes("lift")&&m.lift(e)},e}return J(r,[{key:"run",get:function(){return m.lift}},{key:"enable",get:function(){return m.lift}}]),r}())||Ge,Xt=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Lift").to(Zt);var e=this.container.get("CreateShortCut");e({"Mod-[":function(e,t){return g.liftListItem(e.schema.nodes.list_item)(e,t)}}),e({"Mod-]":function(e,t){return g.sinkListItem(e.schema.nodes.list_item)(e,t)}})}}]),r}(),_t={content:"paragraph block*",attrs:{track:{default:[]}},parseDOM:[{tag:"li",getAttrs:function(e,n){Object.assign(e,{track:t.SchemaHelpers.parseTracks(e.dom.dataset.track)}),n()}}],toDOM:function(e,t){var n={};e.node.attrs.track&&e.node.attrs.track.length&&(n["data-track"]=JSON.stringify(e.node.attrs.track)),e.value=["li",n,0],t()},defining:!0},$t=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.get("CreateNode")({list_item:_t},{toWaxSchema:!0})}}]),r}(),en=o.injectable()(Je=function(e){I(r,t.ToolGroup);var n=L(r);function r(e,t,i,a){var o;return W(this,r),(o=n.call(this)).tools=[],o.tools=[e,t,i,a],o}return r=o.inject("Lift")(r,void 0,3)||r,r=o.inject("JoinUp")(r,void 0,2)||r,r=o.inject("BulletList")(r,void 0,1)||r,r=o.inject("OrderedList")(r,void 0,0)||r}())||Je,tn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Lists").to(en)}}]),r}(),nn=[new $t,new Ft,new Yt,new Ut,new Xt,new tn],rn=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="ListsService",e.dependencies=nn,e}return r}(),an={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"extract-poetry"}},parseDOM:[{tag:"p.extract-poetry",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},on=o.injectable()(Fe=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Extract Poetry",e.label="Extract Poetry",e.name="ExtractPoetry",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.extractPoetry,{class:"extract-poetry"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.extractPoetry)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.extractPoetry)(e)}}}]),a}())||Fe,cn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("ExtractPoetry").to(on),this.container.get("CreateNode")({extractPoetry:an},{toWaxSchema:!0})}}]),r}(),sn={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"extract-prose"}},parseDOM:[{tag:"p.extract-prose",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},un=o.injectable()(qe=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Extract Prose",e.label="Extract Prose",e.name="ExtractProse",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.extractProse,{class:"extract-prose"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.extractProse)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.extractProse)(e)}}}]),a}())||qe,ln=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("ExtractProse").to(un),this.container.get("CreateNode")({extractProse:sn},{toWaxSchema:!0})}}]),r}(),dn={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"paragraph-cont"}},parseDOM:[{tag:"p.paragraph-cont",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},fn=o.injectable()(Qe=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Paragraph Continued",e.label="Paragraph Continued",e.name="ParagraphContinued",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.paragraphCont,{class:"paragraph-cont"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.paragraphCont)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.paragraphCont)(e)}}}]),a}())||Qe,pn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("ParagraphContinued").to(fn),this.container.get("CreateNode")({paragraphCont:dn},{toWaxSchema:!0})}}]),r}(),mn=o.injectable()(Ye=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).title="Change to Paragraph",e.label="Paragraph",e.name="Paragraph",e.select=function(e,n){return"main"===n&&t.Commands.setBlockType(e.config.schema.nodes.paragraph)(e)},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.paragraph,{class:"paragraph"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.paragraph)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.paragraph)(e)}}}]),a}())||Ye,gn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Paragraph").to(mn)}}]),r}(),hn={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"source-note"}},parseDOM:[{tag:"p.source-note",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},vn=o.injectable()(Ke=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Source Note",e.label="Source Note",e.name="SourceNote",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.sourceNote,{class:"source-note"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.sourceNote)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.sourceNote)(e)}}}]),a}())||Ke,yn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("SourceNote").to(vn),this.container.get("CreateNode")({sourceNote:hn},{toWaxSchema:!0})}}]),r}(),kn={content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return["blockquote",0]}},xn=o.injectable()(Ue=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Block Quote",e.label="Block Quote",e.name="BlockQuote",e.select=function(e,t){return"main"===t&&m.wrapIn(e.config.schema.nodes.blockquote)(e)},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,t){m.wrapIn(e.config.schema.nodes.blockquote)(e,t)}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.$from,r=t.to,i=n.sharedDepth(r);if(0===i)return!1;var a=n.before(i);return!!u.NodeSelection.create(e.doc,a).$from.parent.hasMarkup(e.config.schema.nodes.blockquote)}}},{key:"enable",get:function(){return function(e){return m.wrapIn(e.config.schema.nodes.blockquote)(e)}}}]),a}())||Ue,bn=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="BlockQuoteService",e}return J(r,[{key:"register",value:function(){this.container.bind("BlockQuote").to(xn),this.container.get("CreateNode")({blockquote:kn})}}]),r}(),wn=o.injectable()(Ze=function(e){I(i,t.ToolGroup);var n=L(i);function i(e,a,o,c,s,u){var l;return W(this,i),(l=n.call(this)).tools=[],l.title=r.createElement(t.LeftMenuTitle,{title:"Text"}),l.tools=[e,a,o,c,s,u],l}return i=o.inject("BlockQuote")(i,void 0,5)||i,i=o.inject("SourceNote")(i,void 0,4)||i,i=o.inject("ExtractPoetry")(i,void 0,3)||i,i=o.inject("ExtractProse")(i,void 0,2)||i,i=o.inject("ParagraphContinued")(i,void 0,1)||i,i=o.inject("Paragraph")(i,void 0,0)||i}())||Ze,En=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Text").to(wn)}}]),r}(),Cn=[new cn,new ln,new pn,new gn,new yn,new bn,new En],Sn=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=Cn,e}return r}(),An={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"author"}},parseDOM:[{tag:"p.author",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},Tn=o.injectable()(Xe=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Author",e.label="Author",e.name="Author",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.author,{class:"author"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.author)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.author)(e)}}}]),a}())||Xe,On=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Author").to(Tn),this.container.get("CreateNode")({author:An},{toWaxSchema:!0})}}]),r}(),Mn={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"epigraph-poetry"}},parseDOM:[{tag:"p.epigraph-poetry",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},Dn=o.injectable()(_e=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Epigraph Poetry",e.label="Epigraph Poetry",e.name="EpigraphPoetry",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.epigraphPoetry,{class:"epigraph-poetry"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.epigraphPoetry)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.epigraphPoetry)(e)}}}]),a}())||_e,jn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("EpigraphPoetry").to(Dn),this.container.get("CreateNode")({epigraphPoetry:Mn},{toWaxSchema:!0})}}]),r}(),Bn={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"epigraph-prose"}},parseDOM:[{tag:"p.epigraph-prose",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},Pn=o.injectable()($e=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Epigraph Prose",e.label="Epigraph Prose",e.name="EpigraphProse",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"epigraphProse",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.epigraphProse,{class:"epigraph-prose"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.epigraphProse)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.epigraphProse)(e)}}}]),a}())||$e,Wn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("EpigraphProse").to(Pn),this.container.get("CreateNode")({epigraphProse:Bn},{toWaxSchema:!0})}}]),r}(),Nn=function(e,t,n){var r=0,a=!1,o=!1,c=0,s=0,u=e.selection,l=u.from,d=u.to;e.doc.nodesBetween(l,d,(function(e,t){"oen_section"===e.type.name&&(a=!0,c+=1),"oen_container"===e.type.name&&(c+=1)}));var f=a?"nestedHeadingLevel":"headingLevel";return e.doc.nodesBetween(l,d,(function(e,t){"oen_section"===e.type.name&&1===c?(n.forEach((function(t){var n=i.result(i.find(t.items,(function(t){return t.className===e.attrs.class})),"headingLevel");n&&(s=n)})),e.content.content.forEach((function(e){e.type.name==="heading".concat(s)&&(o=!0)}))):"oen_container"===e.type.name&&(n.forEach((function(t){var n=i.result(i.find(t.items,(function(t){return t.className===e.attrs.class})),f);n&&(r=n)})),e.content.content.forEach((function(e){e.type.name==="heading".concat(r)&&(o=!0)})))})),s>0?o?s+1:s:o?r+1:r},In=o.injectable()(et=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).title="Change to heading level 2",e.label="Heading 2",e.name="Heading2",e.select=function(n,r){if("main"!==r)return!1;if(e.config&&Nn(n,0,e.config)>2)return!1;return t.Commands.setBlockType(n.config.schema.nodes.heading2)(n)},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"Heading2",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.heading2)(e,n)}}},{key:"active",get:function(){return function(e,t){var n=!1;if("main"!==t)return!1;var r=e.selection,i=r.from,a=r.to;return e.doc.nodesBetween(i,a,(function(e,t){"heading2"===e.type.name&&(n=!0)})),n}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.heading2)(e)}}}]),a}())||et,Hn=o.injectable()(tt=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).title="Change to heading level 3",e.label="Heading 3",e.name="Heading3",e.select=function(n,r){if("main"!==r)return!1;if(e.config&&Nn(n,0,e.config)>3)return!1;return t.Commands.setBlockType(n.config.schema.nodes.heading3)(n)},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"Heading3",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.heading3)(e,n)}}},{key:"active",get:function(){return function(e,t){var n=!1;if("main"!==t)return!1;var r=e.selection,i=r.from,a=r.to;return e.doc.nodesBetween(i,a,(function(e,t){"heading3"===e.type.name&&(n=!0)})),n}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.heading3)(e)}}}]),a}())||tt,Rn=o.injectable()(nt=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to heading level 4",e.label="Heading 4",e.name="Heading4",e.select=function(t,n){if("main"!==n)return!1;if(e.config&&Nn(t,0,e.config)>4)return!1;return!0},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"Heading4",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.heading4)(e,n)}}},{key:"active",get:function(){return function(e,t){var n=!1;if("main"!==t)return!1;var r=e.selection,i=r.from,a=r.to;return e.doc.nodesBetween(i,a,(function(e){"heading4"===e.type.name&&(n=!0)})),n}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.heading4)(e)}}}]),a}())||nt,zn=o.injectable()(rt=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to heading level 5",e.label="Heading 5",e.name="Heading5",e.select=function(t,n){if("main"!==n)return!1;if(e.config&&Nn(t,0,e.config)>5)return!1;return!0},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"Heading5",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.heading5)(e,n)}}},{key:"active",get:function(){return function(e,t){var n=!1;if("main"!==t)return!1;var r=e.selection,i=r.from,a=r.to;return e.doc.nodesBetween(i,a,(function(e){"heading5"===e.type.name&&(n=!0)})),n}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.heading5)(e)}}}]),a}())||rt,Vn=o.injectable()(it=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to heading level 6",e.label="Heading 6",e.name="Heading6",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"Heading5",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.heading6)(e,n)}}},{key:"active",get:function(){return function(e,t){var n=!1;if("main"!==t)return!1;var r=e.selection,i=r.from,a=r.to;return e.doc.nodesBetween(i,a,(function(e){"heading6"===e.type.name&&(n=!0)})),n}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.heading6)(e)}}}]),a}())||it,Ln=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){var e=this;this.container.bind("Heading2").toDynamicValue((function(){return new In(e.config.get("config.OENContainersService"))})),this.container.bind("Heading3").toDynamicValue((function(){return new Hn(e.config.get("config.OENContainersService"))})),this.container.bind("Heading4").toDynamicValue((function(){return new Rn(e.config.get("config.OENContainersService"))})),this.container.bind("Heading5").toDynamicValue((function(){return new zn(e.config.get("config.OENContainersService"))})),this.container.bind("Heading6").toDynamicValue((function(){return new Vn(e.config.get("config.OENContainersService"))}));var t=this.container.get("CreateNode");t({heading2:{content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h2"}],toDOM:function(e,t){e.value=["h2",{},0],t()}}},{toWaxSchema:!0}),t({heading3:{content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h3"}],toDOM:function(e,t){e.value=["h3",{},0],t()}}},{toWaxSchema:!0}),t({heading4:{content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h4"}],toDOM:function(e,t){e.value=["h4",{},0],t()}}},{toWaxSchema:!0}),t({heading5:{content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h5"}],toDOM:function(e,t){e.value=["h5",{},0],t()}}},{toWaxSchema:!0}),t({heading6:{content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h6"}],toDOM:function(e,t){e.value=["h6",{},0],t()}}},{toWaxSchema:!0})}}]),r}(),Gn={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:"cst"}},parseDOM:[{tag:"p.cst",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class")}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class};e.value=["p",n,0],t()}},Jn=o.injectable()(at=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Change to Subtitle",e.label="Subtitle",e.name="SubTitle",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(t.LeftSideButton,{item:this.toJSON(),key:"BlockQuote",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.subtitle,{class:"cst"})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.subtitle)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.subtitle)(e)}}}]),a}())||at,Fn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("SubTitle").to(Jn),this.container.get("CreateNode")({subtitle:Gn},{toWaxSchema:!0})}}]),r}(),qn={attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}}],toDOM:function(e,t){e.value=["h".concat(e.node.attrs.level),{},0],t()}},Qn=function(e){var a=e.view,o=void 0===a?{}:a,s=e.item,u=c.useTranslation(),l=u.t,d=u.i18n,f=s.active,p=s.icon,m=s.label,g=s.run,h=s.select,v=s.title,y=n.useContext(t.WaxContext),k=y.app,x=y.pmViews.main,b=y.activeViewId,w=y.activeView,E=o.dispatch,C=o.state,S=t.DocumentHelpers.findChildrenByType(C.doc,C.config.schema.nodes.title,!0),A=k.config.get("config.TitleService"),T="";S[0]&&(T=S[0].node.textContent),n.useEffect((function(){A&&(S[0]?A.updateTitle(S[0].node.textContent):A.updateTitle(""))}),[T]);var O=!!f(C,b),M=!h(C,b,w);return x.props.editable((function(e){return e}))||(M=!0),n.useMemo((function(){return r.createElement(t.MenuButton,{active:O||!1,disabled:M,iconName:p,label:!i.isEmpty(d)&&d.exists("Wax.BlockLevel.".concat(m))?l("Wax.BlockLevel.".concat(m)):m,onMouseDown:function(e){return function(e,t){e.preventDefault(),g(t,E)}(e,o.state,o.dispatch)},title:!i.isEmpty(d)&&d.exists("Wax.BlockLevel.".concat(v))?l("Wax.BlockLevel.".concat(v)):v})}),[O,M,l("Wax.BlockLevel.".concat(v))])},Yn=o.injectable()(ot=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=n.call.apply(n,[this].concat(i))).title="Change to Title",e.label="Title",e.name="Title",e.select=function(n,r){var i=n.selection,a=i.$from,o=i.$to;if(e.config&&Nn(n,0,e.config)>1)return!1;var c=t.DocumentHelpers.findChildrenByType(n.doc,n.config.schema.nodes.title,!0);return"main"===r&&a.parent===o.parent&&1!==c.length},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Qn,{item:this.toJSON(),key:"Title",view:e}):null}},{key:"run",get:function(){return function(e,n){t.Commands.setBlockType(e.config.schema.nodes.title,{level:1})(e,n)}}},{key:"active",get:function(){return function(e){return t.Commands.blockActive(e.config.schema.nodes.title)(e)}}},{key:"enable",get:function(){return function(e){return t.Commands.setBlockType(e.config.schema.nodes.title)(e)}}}]),a}())||ot,Kn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){var e=this;this.container.bind("Title").toDynamicValue((function(){return new Yn(e.config.get("config.OENContainersService"))})),this.container.get("CreateNode")({title:qn},{toWaxSchema:!0})}}]),r}(),Un=o.injectable()(ct=function(e){I(i,t.ToolGroup);var n=L(i);function i(e,a,o,c,s,u,l,d,f,p){var m;return W(this,i),(m=n.call(this)).tools=[],m.title=r.createElement(t.LeftMenuTitle,{title:"Display"}),m.tools=[a,e,o,c,s,u,l,d,f,p],m}return i=o.inject("Heading6")(i,void 0,9)||i,i=o.inject("Heading5")(i,void 0,8)||i,i=o.inject("Heading4")(i,void 0,7)||i,i=o.inject("Heading3")(i,void 0,6)||i,i=o.inject("Heading2")(i,void 0,5)||i,i=o.inject("EpigraphPoetry")(i,void 0,4)||i,i=o.inject("EpigraphProse")(i,void 0,3)||i,i=o.inject("SubTitle")(i,void 0,2)||i,i=o.inject("Title")(i,void 0,1)||i,i=o.inject("Author")(i,void 0,0)||i}())||ct,Zn=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Display").to(Un)}}]),r}(),Xn=[new On,new Wn,new jn,new Ln,new Fn,new Kn,new Zn],_n=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=Xn,e}return r}(),$n={group:"notes inline",content:"inline*",inline:!0,atom:!0,attrs:{id:{default:""}},toDOM:function(e){return["footnote",e.attrs]},parseDOM:[{tag:"footnote",getAttrs:function(e){return{id:e.getAttribute("id")}}}]},er=o.injectable()(st=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Insert Note",e.icon="note",e.name="Note",e.select=function(e,t){return"main"===t},e}return J(r,[{key:"run",get:function(){return function(e,t){var n=e.selection,r=n.empty,i=n.$from,a=n.$to,o=h.Fragment.empty;!r&&i.sameParent(a)&&i.parent.inlineContent&&(o=i.parent.content.cut(i.parentOffset,a.parentOffset));var c=e.config.schema.nodes.footnote.create({id:s.v4()},o);t(e.tr.replaceSelectionWith(c))}}},{key:"enable",get:function(){return function(e){return!1}}}]),r}())||st;function tr(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||_(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nr(){var e=ke(["\n  display: flex;\n  margin-right: 10px;\n  margin-top: 10px;\n  position: absolute;\n  left: -20px;\n\n  &:after {\n    content: counter(footnote-view) '.';\n    counter-increment: footnote-view;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: 500;\n  }\n"]);return nr=function(){return e},e}var rr=p.div(nr()),ir=function(){},ar=function(e){e.number;return r.createElement(rr,{onClick:ir})};function or(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n  height: 100%;\n  width: 100%;\n\n  &:focus {\n    outline: none;\n  }\n"]);return or=function(){return e},e}function cr(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n  margin-bottom: 5px;\n  position: relative;\n  width: 100%;\n\n  .ProseMirror {\n    box-shadow: 0 0 8px #ecedf1;\n    line-height: 1.6;\n    padding-left: ",";\n    padding-top: 5px;\n    padding-bottom: 5px;\n    margin-right: 0;\n  }\n  *::selection {\n    background-color: #c5d7fe;\n    color: #000;\n  }\n"]);return cr=function(){return e},e}var sr=p.div(cr(),x.grid(2)),ur=p.div(or()),lr=r.forwardRef((function(e,t){return r.createElement(sr,null,r.createElement(ar,null)," ",r.createElement(ur,Object.assign({ref:t},e)))}));function dr(){var e=ke(["\n  display: flex;\n  position: relative;\n"]);return dr=function(){return e},e}var fr,pr=p.div(dr()),mr=function(){return!0},gr=function(e){var o,c=e.node,s=e.view,d=n.useRef(),f=n.useContext(t.WaxContext),p=c.attrs.id,g=!1,h=!1,v=f.pmViews,x=f.pmViews.main.props.editable((function(e){return e}));n.useEffect((function(){mr=t.ComponentPlugin("waxOverlays"),o=new l.EditorView({mount:d.current},{editable:function(){return x},state:u.EditorState.create({doc:c,plugins:[k.keymap(w())].concat(tr(f.app.getPlugins()))}),dispatchTransaction:b,disallowedTools:["Tables","Images","Lists","CodeBlock"],handleDOMEvents:{blur:function(e,t){v[p]&&v[p].dispatch(v[p].state.tr.setSelection(new u.TextSelection(v[p].state.tr.doc.resolve(0))))},mousedown:function(){f.updateView({},p),g=!0}},handleTextInput:function(e,t,n,r){h=!0},attributes:{spellcheck:"false"}}),f.updateView(ue({},p,o),p),v[p]&&v[p].focus()}),[]);var b=function(e){var n=s.props.user,r=f.app.config.get("config.EnableTrackChangeService"),a=e;r&&r.enabled&&(a=t.trackedTransaction(e,o.state,n,"notes",p));var c=o.state.applyTransaction(a),u=c.state,l=c.transactions;o.updateState(u);var d=t.DocumentHelpers.findChildrenByType(s.state.doc,s.state.schema.nodes.footnote,!0),m=i.filter(d,{node:{attrs:{id:p}}});setTimeout((function(){g&&f.updateView({},p),g=!1,h&&(f.updateView({},p),h=!1),o.state.selection.from!==o.state.selection.to&&f.updateView({},p)}),20);var v=f.app.PmPlugins.get("findAndReplacePlugin");v&&(v.getState(o.state).allMatches.length>0&&!h&&f.activeViewId===p&&f.updateView({},p));if(!a.getMeta("fromOutside")){for(var k=s.state.tr,x=y.StepMap.offset(m[0].pos+1),b=0;b<l.length;b++)for(var w=l[b].steps,E=0;E<w.length;E++)k.step(w[E].map(x));k.docChanged&&s.dispatch(k.setMeta("outsideView",p))}},w=function(){var e=E();return Object.keys(m.baseKeymap).forEach((function(t){e[t]=m.baseKeymap[t]})),e},E=function(){return{"Mod-z":function(){return a.undo(s.state,s.dispatch)},"Mod-y":function(){return a.redo(s.state,s.dispatch)}}};if(v[p]){var C=v[p].state,S=c.content.findDiffStart(C.doc.content);if(null!=S){var A=c.content.findDiffEnd(C.doc.content),T=A.a,O=A.b,M=S-Math.min(T,O);M>0&&(T+=M,O+=M),v[p].dispatch(C.tr.replace(S,O,c.slice(S,T)).setMeta("fromOutside",!0))}}var D=n.useMemo((function(){return r.createElement(lr,{ref:d})}),[]);return r.createElement(pr,null,D,r.createElement(mr,{activeViewId:p,group:"notes"}))},hr=function(e){var t=e.notes,n=e.view;return r.createElement(r.Fragment,null,t.map((function(e){return r.createElement(gr,{key:e.node.attrs.id,node:e.node,view:n})})))},vr=function(e){var a=e.view,o=n.useContext(t.WaxContext);if(void 0===a)return null;var c=o.pmViews.main,s=c.state.tr,u=$(n.useState([]),2),l=u[0],d=u[1];v((function(){d(yr(o.pmViews.main)),function(){if(c){var e=t.DocumentHelpers.findChildrenByType(c.state.doc,c.state.schema.nodes.footnote,!0);if(l.length>e.length)i.differenceBy(l,e,"node.attrs.id").forEach((function(e,t){o.removeView(e.node.attrs.id)})),s.setMeta("notesChanged",!0),c.dispatch(s)}}()}),[yr(c)]);var f=n.useMemo((function(){return r.createElement(hr,{notes:l,view:c})}),[l]);return r.createElement(r.Fragment,null,f)},yr=function(e){return e?t.DocumentHelpers.findChildrenByType(e.state.doc,e.state.schema.nodes.footnote,!0):[]},kr=o.injectable()(fr=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("Note")(r,void 0,0)||r}())||fr,xr=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("Notes").to(kr)}}]),r}(),br=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="NoteService",e.dependencies=[new xr],e}return J(r,[{key:"boot",value:function(){this.container.get("Layout").addComponent("notesArea",vr)}},{key:"register",value:function(){var e=this.container.get("CreateNode");this.container.bind("Note").to(er),e({footnote:$n})}}]),r}();function wr(){var e=ke(["\n  height: 28px;\n  width: 28px;\n  fill: ",";\n"]);return wr=function(){return e},e}function Er(){var e=ke(["\n  border-radius: 50%;\n  width: 40px;\n  height: 40px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transition: background 0.1s ease-in;\n\n  &:hover {\n    background: gainsboro;\n    cursor: pointer;\n  }\n"]);return Er=function(){return e},e}var Cr=p.div(Er()),Sr=p((function(e){var t=e.className;return r.createElement("svg",{className:t,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},r.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}),r.createElement("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"}))}))(wr(),x.th("colorPrimary")),Ar=function(e){var t=e.onClick;return r.createElement(Cr,{onClick:t},r.createElement(Sr,null))},Tr=function(e){var i=e.setPosition,a=e.position,o=e.group,c=n.useContext(t.WaxContext),s=c.activeView,u=c.activeViewId,l=s.state,d=s.dispatch;n.useLayoutEffect((function(){var e=s.dom.getBoundingClientRect(),t=s.state.selection,n=t.from,r=t.to,o=s.coordsAtPos(n),c=s.coordsAtPos(r),u=c.top-o.top,l=e.width-20,d=c.top-e.top-u/2-5;i(de(de({},a),{},{left:l,top:d}))}),[a.left]);return function(){var e=s.state.schema.marks.comment,n=t.DocumentHelpers.findMark(l,e,!0),r=!0;return l.doc.nodesBetween(l.selection.$from.pos,l.selection.$to.pos,(function(e){"math_display"!==e.type.name&&"math_inline"!==e.type.name&&"image"!==e.type.name||(r=!1)})),n.forEach((function(e){"main"===e.attrs.group&&(r=!1)})),"main"!==u&&n.length>=1&&(r=!1),r}()&&r.createElement(Ar,{onClick:function(e){!function(e){e.preventDefault(),t.Commands.createComment(l,d,o,u),s.focus()}(e)}})};function Or(){var e=ke(["\n  font-family: ",";\n  font-size: ",";\n\n  ","\n"]);return Or=function(){return e},e}function Mr(){var e=ke(["\n  color: gray;\n  font-size: ",";\n\n  ","\n"]);return Mr=function(){return e},e}function Dr(){var e=ke(["\n  font-size: ",";\n\n  ","\n"]);return Dr=function(){return e},e}function jr(){var e=ke(["\n  display: flex;\n  flex-direction: column;\n  font-size: 14px;\n  margin-bottom: ",";\n\n  ","\n"]);return jr=function(){return e},e}function Br(){var e=ke([""]);return Br=function(){return e},e}var Pr=p.div(Br()),Wr=p.div(jr(),x.grid(2),x.override("Wax.CommentInfoWrapper")),Nr=p.div(Dr(),x.th("fontSizeBase"),x.override("Wax.CommentName")),Ir=p.div(Mr(),x.th("fontSizeBaseSmall"),x.override("Wax.CommentTimestamp")),Hr=p.div(Or(),x.th("fontReading"),x.th("fontSizeBaseLarge"),x.override("Wax.CommentContent")),Rr=function(e){var n=e.className,i=e.content,a=e.displayName,o=e.timestamp,c=e.active;return r.createElement(Pr,{active:c,className:n},r.createElement(Wr,{active:c},r.createElement(Nr,null,a),r.createElement(Ir,null,r.createElement(t.DateParser,{timestamp:o},(function(e,t){return"".concat(t," ago")})))),r.createElement(Hr,{active:c},i))};function zr(){var e=ke(["\n  background: gray;\n  border-radius: 3px;\n  color: white;\n  /* cursor: default; */\n  display: inline-block;\n  padding: 4px 8px;\n\n  ","\n"]);return zr=function(){return e},e}function Vr(){var e=ke(["\n  font-weight: bold;\n  font-size: ",";\n\n  ","\n"]);return Vr=function(){return e},e}function Lr(){var e=ke(["\n  padding: 8px 16px;\n\n  > div:not(:last-of-type) {\n    margin-bottom: 16px;\n  }\n  ","\n"]);return Lr=function(){return e},e}Rr.defaultProps={active:!1};var Gr=p.div(Lr(),x.override("Wax.CommentItemWrapper")),Jr=p.span(Vr(),x.th("fontSizeBase"),x.override("Wax.CommentItemTitle")),Fr=p.span(zr(),x.override("Wax.CommentMore")),qr=function(e){var t=e.active,a=e.className,o=e.data,c=e.title,s=e.users;if(!o||0===o.length)return null;var u=$(n.useState(o),2),l=u[0],d=u[1];n.useEffect((function(){if(t)d(o);else{var e=i.clone(o[0]);e.content.length>100&&(e.content="".concat(e.content.substring(1,100),"...")),d([e])}}),[t,o]);return r.createElement(Gr,{active:t,className:a},c&&r.createElement(Jr,null,c),l.map((function(e){return r.createElement(Rr,{active:t,content:e.content,displayName:(n=e.userId,(s||[]).find((function(e){return e.userId===n}))||{}).displayName||e.displayName,key:i.uniqueId("comment-item-"),timestamp:e.timestamp});var n})),!t&&o.length>1&&r.createElement("div",null,r.createElement(Fr,null,o.length-1," more")))};function Qr(){var e=ke(["\n  > button:not(:last-of-type) {\n    margin-right: 8px;\n  }\n  ","\n"]);return Qr=function(){return e},e}function Yr(){var e=ke(["\n  border: 0;\n  border-radius: 5px;\n  color: gray;\n  cursor: pointer;\n  padding: "," ",";\n\n  ","\n  ","\n\n  ","\n"]);return Yr=function(){return e},e}function Kr(){var e=ke(["\n  background: ",";\n  color: white;\n"]);return Kr=function(){return e},e}function Ur(){var e=ke(["\n  display: flex;\n  justify-content: flex-start;\n  margin-top: 4px;\n"]);return Ur=function(){return e},e}function Zr(){var e=ke(["\n  background: ",";\n  border: 3px solid ",";\n  font-family: ",";\n  position: relative;\n  width: 100%;\n\n  &:focus {\n    outline: 1px solid ",";\n  }\n\n  ","\n"]);return Zr=function(){return e},e}function Xr(){var e=ke(["\n  background: ",";\n  border: 3px solid ",";\n  font-family: ",";\n  margin-bottom: 10px;\n  position: relative;\n  width: 100%;\n\n  &:focus {\n    outline: 1px solid ",";\n  }\n\n  ","\n"]);return Xr=function(){return e},e}function _r(){var e=ke([""]);return _r=function(){return e},e}function $r(){var e=ke(["\n  background: ",";\n  display: flex;\n  flex-direction: column;\n  padding: "," ",";\n"]);return $r=function(){return e},e}qr.defaultProps={active:!1,data:[],title:null,users:[]};var ei=p.div($r(),x.th("colorBackgroundHue"),x.grid(2),x.grid(4)),ti=p.div(_r()),ni=p.input(Xr(),x.th("colorBackgroundHue"),x.th("colorBackgroundTabs"),x.th("fontWriting"),x.th("colorPrimary"),x.override("Wax.CommentTitle")),ri=p.textarea(Zr(),x.th("colorBackgroundHue"),x.th("colorBackgroundTabs"),x.th("fontWriting"),x.th("colorPrimary"),x.override("Wax.CommentTextArea")),ii=p.div(Ur()),ai=f.css(Kr(),x.th("colorPrimary")),oi=p.button(Yr(),x.grid(2),x.grid(4),(function(e){return e.primary&&ai}),(function(e){return e.disabled&&"cursor: not-allowed; opacity: 0.3;"}),x.override("Wax.CommentButtons")),ci=p.div(Qr(),x.override("Wax.CommentButtonGroup")),si=function(e){var a=e.className,o=e.isNewComment,s=e.onClickPost,u=e.isReadOnly,l=e.onTextAreaBlur,d=e.showTitle,f=c.useTranslation(),p=f.t,m=f.i18n,g=n.useRef(null),h=n.useRef(null),v=$(n.useState(""),2),y=v[0],k=v[1],x=$(n.useState(""),2),b=x[0],w=x[1],E=n.useRef(null);t.useOnClickOutside(E,l),n.useEffect((function(){setTimeout((function(){h.current&&o&&h.current.focus(),!h.current&&o&&g.current.focus()}))}),[]);var C=function(e){e.preventDefault(),e.stopPropagation(),s({title:b,commentValue:y}),k(""),w("")};return r.createElement(ei,{className:a,ref:E},r.createElement("form",{onSubmit:C},r.createElement(ti,null,o&&d&&r.createElement(ni,{name:"title",onChange:function(e){w(e.target.value)},placeholder:"".concat(!i.isEmpty(m)&&m.exists("Wax.Comments.Write title")?p("Wax.Comments.Write title"):"Write title","..."),ref:h,type:"text",value:b}),r.createElement(ri,{cols:"5",onChange:function(){return k(g.current.value)},onKeyDown:function(e){13!==e.keyCode||e.shiftKey||(e.preventDefault(),y&&C(e))},placeholder:"".concat(o?!i.isEmpty(m)&&m.exists("Wax.Comments.Write comment")?p("Wax.Comments.Write comment"):"Write comment":!i.isEmpty(m)&&m.exists("Wax.Comments.Reply")?p("Wax.Comments.Reply"):"Reply","..."),ref:g,rows:"3",value:y})),r.createElement(ii,null,r.createElement(ci,null,r.createElement(oi,{disabled:0===y.length||u,primary:!0,type:"submit"},!i.isEmpty(m)&&m.exists("Wax.Comments.Post")?p("Wax.Comments.Post"):"Post"),r.createElement(oi,{disabled:0===y.length,onClick:function(e){e.preventDefault(),k(""),w("")}},!i.isEmpty(m)&&m.exists("Wax.Comments.Cancel")?p("Wax.Comments.Cancel"):"Cancel")))))};function ui(){var e=ke(["\n  border-top: ",";\n\n  ","\n"]);return ui=function(){return e},e}function li(){var e=ke(["\n  align-self: flex-end;\n  background: none;\n  border: none;\n  color: #0042c7;\n  cursor: pointer;\n  margin-bottom: 12px;\n\n  &:hover {\n    background: ",";\n    border: none;\n  }\n\n  ","\n\n  ","\n"]);return li=function(){return e},e}function di(){var e=ke(["\n  display: flex;\n  justify-content: flex-end;\n  padding: 8px 16px 0;\n\n  ","\n"]);return di=function(){return e},e}function fi(){var e=ke(["\n  background: white;\n  border: 1px solid ",";\n  border-radius: 3px;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  font-family: ",";\n\n  ","\n\n  ","\n"]);return fi=function(){return e},e}function pi(){var e=ke(["\n  cursor: not-allowed;\n  opacity: 0.3;\n"]);return pi=function(){return e},e}function mi(){var e=ke(["\n  background: ",";\n  cursor: pointer;\n  transition: box-shadow 0.2s;\n  /* transition: background-color 0.2s; */\n\n  &:hover {\n    /* background: white; */\n    box-shadow: 0 0 1px 2px ",";\n  }\n"]);return mi=function(){return e},e}si.defaultProps={};var gi=f.css(mi(),x.th("colorBackgroundHue"),x.th("colorBackgroundTabs")),hi=f.css(pi()),vi=p.div(fi(),x.th("colorBackgroundTabs"),x.th("fontInterface"),(function(e){return!e.active&&gi}),x.override("Wax.CommentWrapper")),yi=p.div(di(),x.override("Wax.CommentResolveWrapper")),ki=p.button(li(),x.th("colorBackgroundHue"),(function(e){return e.isReadOnly&&hi}),x.override("Wax.CommentResolve")),xi=p(si)(ui(),(function(e){return!e.isNewComment&&"3px solid #E1EBFF"}),x.override("Wax.CommentReplyWrapper")),bi=function(e){var t=e.active,n=e.className,a=e.commentId,o=e.commentData,s=e.isReadOnly,u=e.onClickBox,l=e.onClickPost,d=e.onClickResolve,f=e.onTextAreaBlur,p=e.title,m=e.showTitle,g=e.users;if(!(t||o&&0!==o.length))return null;var h=c.useTranslation(),v=h.t,y=h.i18n;return r.createElement(vi,{active:t,className:n,onClick:function(){t||u(a)}},t&&o.length>0&&r.createElement(yi,null,r.createElement(ki,{isReadOnly:s,onClick:function(){return!s&&d(a)}},!i.isEmpty(y)&&y.exists("Wax.Comments.Resolve")?v("Wax.Comments.Resolve"):"Resolve")),r.createElement(qr,{active:t,data:o,title:p,users:g}),t&&r.createElement(xi,{isNewComment:0===o.length,isReadOnly:s,onClickPost:l,onTextAreaBlur:f,showTitle:m}))};function wi(){var e=ke(["\n  margin-left: ",";\n  transition: ",";\n  position: absolute;\n  width: 205px;\n  @media (max-width: 600px) {\n    margin-left: 15px;\n  }\n\n  ","\n"]);return wi=function(){return e},e}bi.defaultProps={active:!1,commentData:[],title:null,users:[]};var Ei=p.div(wi(),(function(e){return e.active?"".concat(-20,"px"):"".concat(50,"px")}),(function(e){return e.active&&e.length?"none!important":"all 1.3s"}),x.override("Wax.CommentOuterBox")),Ci=function(e){var a=e.comment,o=e.top,c=e.commentId,s=e.recalculateTops,l=e.users,d=n.useContext(t.WaxContext),f=d.pmViews,p=d.pmViews.main.props.user,m=d.app,g=d.activeView,h=(d.activeViewId,$(n.useState(!1),2)),v=h[0],y=h[1],k=$(n.useState(!1),2),x=k[0],b=k[1],w=g.state,E=g.dispatch,C=a.attrs.viewid,S=[];f[C]&&(S=t.DocumentHelpers.findAllMarksWithSameId(f[C].state,a));var A=w.schema.marks.comment,T={top:"".concat(o,"px")},O=m.config.get("config.CommentsService"),M=!(!O||!O.readOnly)&&O.readOnly,D=!(!O||!O.showTitle)&&O.showTitle,j=m.PmPlugins.get("commentPlugin").getState(g.state).comment;n.useEffect((function(){y(!1),s(),j&&c===j.attrs.id&&(y(!0),s())}),[j]);var B=function(e){var n=e.commentValue,r=e.title;b(!0);var o=p||(l||[]).find((function(e){return!0===e.currentUser})),c={content:n,displayName:o?o.displayName||o.username:"Anonymous",userId:o?o.userId:"1",timestamp:Math.floor(Date.now())};a.attrs.title=r||a.attrs.title,a.attrs.conversation.push(c),S.forEach((function(e){g.dispatch(g.state.tr.removeMark(e.pos,e.pos+e.node.nodeSize,A))}));var u=i.minBy(S,"pos"),d=i.maxBy(S,"pos");t.Commands.createComment(g.state,g.dispatch,a.attrs.group,a.attrs.viewid,a.attrs.conversation,a.attrs.title,u.pos,d.pos+i.last(S).node.nodeSize),g.focus(),s()},P=function(){if(v)return f[C].focus(),!1;"main"!==C&&d.updateView({},C);var e=i.maxBy(S,"pos");return e.pos+=i.last(S).node.nodeSize,f[C].dispatch(f[C].state.tr.setSelection(new u.TextSelection(f[C].state.tr.doc.resolve(e.pos)))),f[C].focus(),!0},W=function(){var e=a.pos,n=a.pos;S.forEach((function(r){var i=t.DocumentHelpers.findMarkPosition(w,r.pos,"comment");i.from<n&&(n=i.from),i.to>e&&(e=i.to)})),s(),E(w.tr.removeMark(n,e,A)),g.focus()},N=function(){setTimeout((function(){0!==a.attrs.conversation.length||x||(W(),g.focus())}),400)},I=n.useMemo((function(){return r.createElement(Ei,{active:v,"data-box":c,length:0===a.attrs.conversation.length,style:T},r.createElement(bi,{active:v,commentData:a.attrs.conversation,commentId:c,isReadOnly:M,key:c,onClickBox:P,onClickPost:B,onClickResolve:W,onTextAreaBlur:N,recalculateTops:s,showTitle:D,title:a.attrs.title,users:l}))}),[v,o,a.attrs.conversation.length,l]);return r.createElement(r.Fragment,null,I)};function Si(){var e=ke(["\n  border-radius: 3px;\n  display: inline-block;\n  height: 20px;\n  padding: 4px;\n  transition: background 0.1s ease-in;\n  width: 20px;\n\n  &:hover {\n    background: #bfc4cd;\n  }\n"]);return Si=function(){return e},e}function Ai(){var e=ke([""]);return Ai=function(){return e},e}function Ti(){var e=ke(["\n  bottom: 2px;\n  cursor: pointer;\n  height: 16px;\n  position: relative;\n  right: 2px;\n  width: 16px;\n"]);return Ti=function(){return e},e}function Oi(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n  margin-bottom: 5px;\n"]);return Oi=function(){return e},e}function Mi(){var e=ke(["\n  display: flex;\n  font-weight: bold;\n  margin-right: 4px;\n  text-transform: capitalize;\n\n  &:after {\n    content: ':';\n  }\n"]);return Mi=function(){return e},e}function Di(){var e=ke([""]);return Di=function(){return e},e}function ji(){var e=ke([""]);return ji=function(){return e},e}function Bi(){var e=ke(["\n  color: gray;\n"]);return Bi=function(){return e},e}function Pi(){var e=ke([""]);return Pi=function(){return e},e}function Wi(){var e=ke(["\n  display: flex;\n  flex-direction: column;\n  flex-grow: 1;\n"]);return Wi=function(){return e},e}function Ni(){var e=ke(["\n  display: flex;\n  margin-bottom: 8px;\n"]);return Ni=function(){return e},e}function Ii(){var e=ke(["\n  background: #f5f5f5;\n  border: 2px solid transparent;\n  border-radius: 5px;\n  cursor: pointer;\n  ","\n  padding: 8px 16px;\n  transition: border 0.1s ease-in;\n\n  &:hover {\n    ","\n  }\n"]);return Ii=function(){return e},e}function Hi(){var e=ke(["\n  border-color: #bfc4cd;\n"]);return Hi=function(){return e},e}var Ri=f.css(Hi()),zi=p.div(Ii(),(function(e){return e.active&&Ri}),Ri),Vi=p.div(Ni()),Li=p.div(Wi()),Gi=p.div(Pi()),Ji=p.div(Bi()),Fi=p.div(ji()),qi=p.div(Di()),Qi=p.span(Mi()),Yi=p.div(Oi()),Ki=p(t.Icon)(Ti()),Ui=p.span(Ai()),Zi=p.div(Si()),Xi=function(e){var t=e.name,n=e.onClick;return r.createElement(Zi,{onClick:function(e){e.stopPropagation(),n()},type:"button"},r.createElement(Ki,{name:t.toString()}))},_i=function(e){var n=e.active,i=e.className,a=e.onClickBox,o=e.onClickAccept,c=e.onClickReject,s=e.trackData,u=s.attrs?s.attrs.username:s.node.attrs.track[0].username,l=s.attrs?s.attrs.date:s.node.attrs.track[0].date,d="",f="",p="",m="",g="";if(s.type&&"format_change"===s.type.name){for(var h=s.attrs,v=h.before,y=h.after,k=0;k<v.length;k+=1)k<v.length-1?d+="".concat(v[k],", "):d+="".concat(v[k]);for(var x=0;x<y.length;x+=1)x<y.length-1?f+="".concat(y[x],", "):f+="".concat(y[x])}if(s.node){var b=s.node.attrs.track[0];"insertion"===b.type&&(m=s.node.type.name),"block_change"===b.type&&(p="".concat(b.before.type," to ").concat(s.node.type.name)),"deletion"===b.type&&(g=s.node.type.name)}return r.createElement(zi,{active:n,className:i,onClick:function(){a(s)}},r.createElement(Vi,null,r.createElement(Li,null,r.createElement(Gi,null,u),r.createElement(Ji,null,r.createElement(t.DateParser,{timestamp:l},(function(e,t){return"".concat(t," ago")})))),n&&r.createElement(Fi,null,r.createElement(Xi,{name:"checkTrack",onClick:o}),r.createElement(Xi,{name:"reject",onClick:c}))),r.createElement(qi,null,""!==f&&r.createElement(Yi,null,r.createElement(Qi,null,"added "),r.createElement(Ui,null,f)),""!==d&&r.createElement(Yi,null,r.createElement(Qi,null,"removed "),r.createElement(Ui,null,d)),""!==m&&r.createElement(Yi,null,r.createElement(Qi,null,"added "),r.createElement(Ui,null,m)),""!==g&&r.createElement(Yi,null,r.createElement(Qi,null,"removed "),r.createElement(Ui,null,g)),""!==p&&r.createElement(Yi,null,r.createElement(Qi,null,"changed "),r.createElement(Ui,null,p))))},$i=function(e,t,n,r){var i,a=r.map(n),o=u.Selection.findFrom(e.doc.resolve(a),-1).$anchor.pos,c=a+1;i=t.isLeaf||["figure","table"].includes(t.type.name)?new y.ReplaceStep(a,r.map(n+t.nodeSize),h.Slice.empty):y.replaceStep(e.doc,o,c),e.step(i);var s=i.getMap();r.appendMap(s)},ea=function(e,t,n){return!(e.attrs.username===t.username&&!n.own.accept)&&!(e.attrs.username!==t.username&&!n.others.accept)},ta=function(e,t,n){return!(e.attrs.username===t.username&&!n.own.reject)&&!(e.attrs.username!==t.username&&!n.others.reject)};function na(){var e=ke(["\n  margin-left: ",";\n  position: absolute;\n  width: 205px;\n  @media (max-width: 600px) {\n    margin-left: 15px;\n  }\n"]);return na=function(){return e},e}var ra,ia,aa=p.div(na(),(function(e){return e.active?"".concat(-20,"px"):"".concat(50,"px")})),oa=function(e){var a=e.trackChangeId,o=e.top,c=e.recalculateTops,s=e.trackChange,l=n.useContext(t.WaxContext),d=l.app,f=l.activeView,p=l.pmViews,m=d.config.get("user"),g=$(n.useState(!1),2),v=g[0],k=g[1],x=(f.state,f.dispatch),b=s.attrs?s.attrs.viewid:s.node.attrs.viewid,w={top:"".concat(o,"px")},E=d.PmPlugins.get("trackChangePlugin").getState(f.state).trackChange,C=function(e){if(e.node)return S(e);"main"!==b&&l.updateView({},b);var n=t.DocumentHelpers.findAllMarksWithSameId(p[b].state,e),r=i.maxBy(n,"pos");return r.pos+=i.last(n).node.nodeSize,p[b].dispatch(p[b].state.tr.setSelection(new u.TextSelection(p[b].state.tr.doc.resolve(r.pos-1)))),p[b].focus(),!0},S=function(e){return p[b].dispatch(p[b].state.tr.setSelection(new u.TextSelection(p[b].state.tr.doc.resolve(e.pos+1)))),p[b].focus(),!0};n.useEffect((function(){k(!1),c(),E&&a===E.attrs.id&&(k(!0),c())}),[E]);var A=function(){var e=d.config.get("config.AcceptTrackChangeService");!function(e,t,n,r,i,a){var o,c,s=i.activeView.state,u=s.tr,l=s.selection.from,d=n.to;"figure"===(null==a||null===(o=a.node)||void 0===o||null===(c=o.type)||void 0===c?void 0:c.name)&&(d=n.from+3),u.setMeta("AcceptReject",!0);var f=new y.Mapping;s.doc.nodesBetween(n.from,d,(function(e,i){if(e.attrs.track&&e.attrs.track.find((function(e){return"deletion"===e.type}))&&$i(u,e,i,f),e.marks&&e.marks.find((function(e){return"deletion"===e.type.name}))){var a=e.marks.find((function(e){return"deletion"===e.type.name}));if(!ea(a,t,r))return;var o=new y.ReplaceStep(f.map(Math.max(i,l)),f.map(Math.min(i+e.nodeSize,d)),h.Slice.empty);u.step(o),f.appendMap(o.getMap())}else if(e.attrs.track&&e.attrs.track.find((function(e){return"insertion"===e.type}))){var c=e.attrs.track.filter((function(e){return"insertion"!==e.type}));u.setNodeMarkup(f.map(i),null,Object.assign(e.attrs.track,{track:c}),e.marks)}else if(e.marks&&e.marks.find((function(e){return"insertion"===e.type.name}))){var s=e.marks.find((function(e){return"insertion"===e.type.name}));if(!ea(s,t,r))return;u.step(new y.RemoveMarkStep(f.map(Math.max(i,l)),f.map(Math.min(i+e.nodeSize,d)),s))}else if(e.marks&&e.marks.find((function(e){return"format_change"===e.type.name}))){var p=e.marks.find((function(e){return"format_change"===e.type.name}));if(!ea(p,t,r))return;u.step(new y.RemoveMarkStep(n.from,n.to,p))}else if(e.attrs.track&&e.attrs.track.find((function(e){return"block_change"===e.type}))){var m=e.attrs.track.find((function(e){return"block_change"===e.type}));e.attrs.track.filter((function(e){return e!==m}));u.setNodeMarkup(f.map(i),null,{class:e.attrs.class,track:[]},e.marks)}})),u.steps.length&&e(u)}(x,m,E,e,l,s),p[b].focus()},T=function(){var e=d.config.get("config.RejectTrackChangeService");!function(e,t,n,r,i,a){var o,c,s=i.activeView.state,u=s.tr,l=s.selection.from,d=n.to;"figure"===(null==a||null===(o=a.node)||void 0===o||null===(c=o.type)||void 0===c?void 0:c.name)&&(d=n.from+3),console.log(n,a),u.setMeta("AcceptReject",!0);var f=new y.Mapping;s.doc.nodesBetween(n.from,d,(function(e,i){if(e.marks&&e.marks.find((function(e){return"deletion"===e.type.name}))){var a=e.marks.find((function(e){return"deletion"===e.type.name}));if(!ta(a,t,r))return;u.step(new y.RemoveMarkStep(f.map(Math.max(i,l)),f.map(Math.min(i+e.nodeSize,d)),a))}if(e.attrs.track&&e.attrs.track.find((function(e){return"insertion"===e.type}))?$i(u,e,i,f):e.attrs.track&&e.attrs.track.find((function(e){return"deletion"===e.type}))&&u.setNodeMarkup(f.map(i),void 0,de(de({},e.attrs),{},{track:[]})),e.marks&&e.marks.find((function(e){return"insertion"===e.type.name}))){var o=e.marks.find((function(e){return"insertion"===e.type.name}));if(!ta(o,t,r))return;var c=new y.ReplaceStep(f.map(Math.max(i,l)),f.map(Math.min(i+e.nodeSize,d)),h.Slice.empty);u.step(c),f.appendMap(c.getMap())}else if(e.marks&&e.marks.find((function(e){return"format_change"===e.type.name}))){var p=e.marks.find((function(e){return"format_change"===e.type.name}));p.attrs.before.forEach((function(e){u.step(new y.AddMarkStep(n.from,n.to,s.schema.marks[e].create()))})),p.attrs.after.forEach((function(t){u.step(new y.RemoveMarkStep(n.from,n.to,e.marks.find((function(e){return e.type.name===t}))))})),u.step(new y.RemoveMarkStep(n.from,n.to,p))}else if(!e.isInline&&e.attrs.track){var m=e.attrs.track.find((function(e){return"block_change"===e.type}));if(m){var g=e.attrs.track.filter((function(e){return e!==m}));u.setNodeMarkup(f.map(i),s.schema.nodes[m.before.type],Object.assign({},e.attrs,m.before.attrs,{track:g}),e.marks)}}})),u.steps.length&&e(u)}(x,m,E,e,l,s),p[b].focus()},O=n.useMemo((function(){return r.createElement(aa,{active:v,"data-box":a,style:w},r.createElement(_i,{active:v,key:a,onClickAccept:A,onClickBox:C,onClickReject:T,recalculateTops:c,trackChangeId:a,trackData:s}))}),[v,o]);return r.createElement(r.Fragment,null,O)},ca=function(e){var t=e.commentsTracks,n=e.view,i=e.position,a=e.recalculateTops,o=e.users;return i?r.createElement(r.Fragment,null,t.map((function(e,t){var c=e instanceof h.Mark?e.attrs.id:e.node.attrs.id,s=i[t]?i[t][c]:0;return e.type&&"comment"===e.type.name?r.createElement(Ci,{comment:e,commentId:c,key:c,recalculateTops:a,top:s,users:o}):r.createElement(oa,{key:c,recalculateTops:a,top:s,trackChange:e,trackChangeId:c,users:o,view:n})}))):null},sa=function(e){var a=e.area,o=e.users,c=n.useContext(t.WaxContext),s=c.pmViews,u=c.pmViews.main,l=c.app,d=c.activeView,f=l.PmPlugins.get("commentPlugin"),p=l.PmPlugins.get("trackChangePlugin"),m=$(n.useState([]),2),g=m[0],y=m[1],k=$(n.useState(),2),x=k[0],b=k[1],w=$(n.useState(!0),2),E=w[0],C=w[1],S=n.useCallback((function(){var e=[],t=null,n=0,r=0,o=0,c={},s="",l=[],m={},v={};return u&&(c=u.dom.getBoundingClientRect(),s=window.getComputedStyle(u.dom).marginTop),i.each(g[a],(function(i,u){var y=i instanceof h.Mark?i.attrs.id:i.node.attrs.id,k=null,x=f.getState(d.state).comment;p&&(k=p.getState(d.state).trackChange);var b=!1;if((x&&y===x.attrs.id||k&&y===k.attrs.id)&&(b=!0),"main"===a)(t=document.querySelector('[data-id="'.concat(y,'"]')))&&(n=t.getBoundingClientRect().top-c.top+parseInt(s.slice(0,-2),10));else if(m=document.getElementsByClassName("panelWrapper"),v=m[0].getBoundingClientRect().height,t=document.querySelector("#notes-container").querySelector('[data-id="'.concat(y,'"]'))){var w=document.querySelector("#wax-container").getBoundingClientRect().top;n=t.getBoundingClientRect().top-v-w-50}var E=null;if(t&&(E=document.querySelector('div[data-box="'.concat(y,'"]'))),E&&(r=parseInt(E.offsetHeight,10),o=n),u>0){var C=g[a][u-1].endHeight;n<C&&(o=C+2)}if(i.endHeight=o+r+4,e[u]=o,l.push(ue({},y,e[u])),b){i.endHeight=n+r+3,e[u]=n,l[u][y]=e[u];var S=!0,A=u;for(0===A&&(S=!1);S;){var T=g[a][A-1].endHeight,O=e[A],M=T>O;if(M){var D=T-O;e[A-1]-=D;var j=g[a][A-1]instanceof h.Mark?g[a][A-1].attrs.id:g[a][A-1].node.attrs.id;l[A-1][j]=e[A-1]}M||(S=!1),A<=1&&(S=!1),A-=1}}})),l})),A=function(){setTimeout((function(){b(S())}))};v((function(){y(ua(s)),E?setTimeout((function(){b(S()),C(!1)}),400):b(S())}),[ua(s),S()]);var T=n.useMemo((function(){return r.createElement(ca,{area:a,commentsTracks:g[a]||[],position:x,recalculateTops:A,users:o,view:u})}),[g[a]||[],x,o]);return r.createElement(r.Fragment,null,T)},ua=function(e){if(e.main){var n=[];Object.keys(e).forEach((function(r){n.push.apply(n,tr(t.DocumentHelpers.findInlineNodes(e[r].state.doc)))}));var r=t.DocumentHelpers.findBlockNodes(e.main.state.doc),a=[],o=[];n.map((function(e){e.node.marks.length>0&&e.node.marks.filter((function(t){"comment"!==t.type.name&&"insertion"!==t.type.name&&"deletion"!==t.type.name&&"format_change"!==t.type.name||(t.pos=e.pos,a.push(t))}))})),r.map((function(e){e.node.attrs.track&&e.node.attrs.track.length>0&&o.push(e)}));var c=[].concat(tr(i.uniqBy(a,"attrs.id")),o),s={};return c.forEach((function(e){var t=e.attrs?e.attrs:e.node.attrs;s[t.group]?s[t.group].push(e):s[t.group]=[e]})),{main:i.sortBy(s.main,["pos"]),notes:s.notes}}return[]},la=new u.PluginKey("commentPlugin"),da=function(e){var n=e.schema.marks.comment,r=t.DocumentHelpers.findFragmentedMark(e,n);if(e.selection.from===e.selection.to||!r||!r.attrs.conversation.length){if(r){var a=t.DocumentHelpers.findChildrenByMark(e.doc,n,!0),o=[];a.map((function(e){e.node.marks.filter((function(t){"comment"===t.type.name&&r.attrs.id===t.attrs.id&&o.push(e)}))}));var c=i.minBy(o,"pos"),s=i.maxBy(o,"pos");if(e.selection.from===s.pos+i.last(o).node.nodeSize?e.schema.marks.comment.spec.inclusive=!1:e.schema.marks.comment.spec.inclusive=!0,o.length>1)return{from:c.pos,to:s.pos+i.last(o).node.nodeSize,attrs:r.attrs,contained:r.contained}}return r}},fa=new u.PluginKey("copyPasteCommentPugin"),pa=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"boot",value:function(){var e;this.app.PmPlugins.add("commentPlugin",new u.Plugin({key:la,state:{init:function(e,t){return{comment:da(t)}},apply:function(e,t,n,r){var i,a=da(r);return a&&(i=l.DecorationSet.create(r.doc,[l.Decoration.inline(a.from,a.to,{class:"active-comment"})])),{comment:a,createDecoration:i}}},props:{decorations:function(e){return(e&&la.getState(e)).createDecoration}}})),this.app.PmPlugins.add("copyPasteCommentPlugin",(e=this.app.context,new u.Plugin({key:fa,props:{transformPasted:function(n){var r=e.app.context.activeView,a=n.content,o=t.DocumentHelpers.findChildrenByMark(a,r.state.schema.marks.comment,!0),c=[];o.map((function(e){e.node.marks.map((function(e){"comment"===e.type.name&&c.push(e)}))}));var u=c.reduce((function(e,t){return e[t.attrs.id]=[].concat(tr(e[t.attrs.id]||[]),[t]),e}),{});i.forEach(Object.keys(u),(function(e){var t=s.v4();i.forEach(u[e],(function(e){e.attrs.id=t}))}));var l=[];return i.each(r.state.schema.nodes,(function(e){e.groups.includes("notes")&&l.push(e)})),l.length>0&&l.forEach((function(e){t.DocumentHelpers.findChildrenByType(a,r.state.schema.nodes[e.name],!0).forEach((function(e){e.node.attrs.id=s.v4()}))})),n}}})));var n=this.container.get("CreateOverlay"),r=this.container.get("Layout");n(Tr,{},{nodeType:"",markType:"",followCursor:!1,selection:!0}),r.addComponent("rightArea",sa)}},{key:"register",value:function(){var e,t,n=this.config.get("config.CommentsService");this.container.get("CreateMark")({comment:(e=(null==n?void 0:n.showTitle)||!1,t={attrs:{class:{default:"comment"},id:{default:""},group:{default:""},viewid:{default:""},conversation:[]},inclusive:!1,excludes:"",parseDOM:[{tag:"span.comment",getAttrs:function(t,n){var r={class:t.dom.getAttribute("class"),id:t.dom.dataset.id,group:t.dom.dataset.group,viewid:t.dom.dataset.viewid,conversation:JSON.parse(t.dom.dataset.conversation)};e&&(r.title=t.dom.dataset.title),Object.assign(t,r),n()}}],toDOM:function(t,n){t.value=["span",{class:t.node.attrs.class,"data-id":t.node.attrs.id,"data-conversation":JSON.stringify(t.node.attrs.conversation),"data-viewid":t.node.attrs.viewid,"data-group":t.node.attrs.group}],e&&(t.value[1]["data-title"]=t.node.attrs.title),n()}},e&&(t.attrs.title={default:""}),t)},{toWaxSchema:!0})}}]),r}(),ma={content:"text*",group:"block",code:!0,defining:!0,marks:"comment insertion deletion",attrs:{params:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:function(e){return{params:e.dataset.params}}}],toDOM:function(e){return["pre",{"data-params":e.attrs.params},["code",0]]}},ga=new u.PluginKey("codeHighlight"),ha=o.injectable()(ra=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Insert Code Block",e.icon="codeBlock",e.name="CodeBlockTool",e.select=function(e,t,n){return!n.props.disallowedTools.includes("CodeBlock")},e}return J(r,[{key:"run",get:function(){return function(e,t){m.setBlockType(e.config.schema.nodes.code_block)(e,t)}}},{key:"enable",get:function(){return function(e){return m.setBlockType(e.config.schema.nodes.code_block)(e)}}}]),r}())||ra,va=o.injectable()(ia=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("CodeBlockTool")(r,void 0,0)||r}())||ia,ya=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("CodeBlock").to(va)}}]),r}(),ka=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=[new ya],e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("highlightPlugin",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["code_block"];return new u.Plugin({key:ga,state:{init:function(t,n){var r=w.getHighlightDecorations(n.doc,b,e,(function(){}));return l.DecorationSet.create(n.doc,r)},apply:function(t,n,r){if(!t.docChanged)return n.map(t.mapping,t.doc);var i=r.selection,a=i.$from,o=i.$to,c=r.doc,s=!1;if(c.nodesBetween(a.pos,o.pos,(function(e){"code_block"===e.type.name&&(s=!0)})),s){var u=w.getHighlightDecorations(t.doc,b,e,(function(){}));return l.DecorationSet.create(t.doc,u)}return n.map(t.mapping,t.doc)}},props:{decorations:function(e){return this.getState(e)}}})}())}},{key:"register",value:function(){this.container.bind("CodeBlockTool").to(ha),this.container.get("CreateNode")({code_block:ma})}}]),r}();function xa(){var e=ke(["\n  margin-right: 10px;\n  background: #fff\n  cursor: pointer;\n  color:",";\n\n    ","\n\n"]);return xa=function(){return e},e}function ba(){var e=ke(["\n  margin-right: 10px;\n  background: ",";\n  cursor: pointer;\n  color: #fff;\n\n  ","\n"]);return ba=function(){return e},e}function wa(){var e=ke(["\n  display: flex;\n"]);return wa=function(){return e},e}function Ea(){var e=ke(["\n  width: calc(100% - 8px);\n  border: none;\n  outline: none;\n  :focus {\n    outline: none;\n  }\n  ","\n"]);return Ea=function(){return e},e}function Ca(){var e=ke(["\n  display: inline-block;\n  width: 150px;\n  margin-right: 12px;\n\n  ","\n"]);return Ca=function(){return e},e}function Sa(){var e=ke(["\n  background: #fff;\n  display: flex;\n  border-radius: 1.03093% / 8%;\n  box-shadow: rgba(9, 30, 66, 0.25) 0px 4px 8px 0px,\n    rgba(9, 30, 66, 0.31) 0px 0px 1px 0px;\n  transform-origin: 50% 50% 0px;\n  padding: "," "," "," ",";\n  a {\n    color: #3a4863;\n    text-decoration: none;\n  }\n  ","\n"]);return Sa=function(){return e},e}var Aa,Ta,Oa,Ma,Da,ja,Ba,Pa=p.div(Sa(),x.grid(2),x.grid(1),x.grid(2),x.grid(2),x.override("Wax.LinkContainer")),Wa=p.div(Ca(),x.override("Wax.LinkWrapper")),Na=p.input(Ea(),x.override("Wax.LinkInput")),Ia=p.div(wa()),Ha=p.button(ba(),x.th("colorPrimary"),x.override("Wax.LinkCreate")),Ra=p.button(xa(),x.th("colorPrimary"),x.override("Wax.LinkCancel")),za=function(e){var i=e.mark,a=i?i.attrs.href:null,o=i||null,c=n.useContext(t.WaxContext).activeView,s=c.state,u=c.dispatch,l=n.useRef(null),d=n.useRef(null),f=$(n.useState(o),2),p=f[0],m=f[1],g=$(n.useState(a),2),h=g[0],v=g[1],y=$(n.useState(!h),2),k=y[0],x=y[1];n.useEffect((function(){A(),T()}),[l.current,a]);var b,w,E,C,S=function(){if(""===d.current.value)return d.current.focus(),!1;var e=s.schema.marks.link,t=s.tr;return u(t.addMark(i.from,i.to,e.create(de(de({},i&&i.attrs||{}),{},{href:O(h)})))),x(!1),c.focus(),!0},A=function(){i&&""!==i.attrs.href?v(i.attrs.href):(v(""),d.current&&d.current.focus())},T=function(){var e=s.selection,n=e.$from,r=e.$to,i=s.schema.marks.link,a=t.DocumentHelpers.findMark(s,i);m(a),""===p.attrs.href&&(n.pos<p.from||r.pos>p.to)&&u(s.tr.setMeta("addToHistory",!1).removeMark(p.from,p.to,i))},O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=window.decodeURIComponent(e);return t=t.trim().replace(/\s/g,""),/^(:\/\/)/.test(t)?"http".concat(t):/^(f|ht)tps?:\/\//i.test(t)?t:"http://".concat(t)},M=function(){return d.current&&""===d.current.value&&""===p.attrs.href?(u(s.tr.setMeta("addToHistory",!1).removeMark(i.from,i.to,s.schema.marks.link)),c.focus(),!1):(v(p.attrs.href),x(!k),!1)};return b=s.selection,w=b.from,E=b.to,(C=t.DocumentHelpers.findMark(s,c.state.schema.marks.link,!0)).length>=1&&(w<C[0].from||E>C[0].to)||!i?null:r.createElement(Pa,null,r.createElement(Wa,{ref:l},k&&r.createElement(Na,{onChange:function(){var e=d.current.value;v(e)},onKeyPress:function(e){"Enter"!==e.key&&13!==e.which||S()},ref:d,value:h}),!k&&r.createElement("a",{href:O(h),rel:"noreferrer",target:"_blank"},O(h))),r.createElement(Ia,null,k&&r.createElement(r.Fragment,null,r.createElement(Ha,{onClick:S,type:"button"},"Apply"),r.createElement(Ra,{onClick:M,type:"button"},"Cancel")),!k&&r.createElement(r.Fragment,null,r.createElement(Ha,{onClick:M,type:"button"},"Edit"),r.createElement(Ra,{onClick:function(){var e=s.tr;u(e.removeMark(i.from,i.to,s.schema.marks.link)),c.focus()},type:"button"},"Remove"))))},Va={attrs:{href:{default:null},rel:{default:""},target:{default:"blank"},title:{default:null}},excludes:"link",inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(e,t){var n=e.dom.getAttribute("href"),r=n&&0===n.indexOf("#")?"":"blank";Object.assign(e,{href:e.dom.getAttribute("href"),title:e.dom.getAttribute("title"),target:r}),t()}}],toDOM:function(e,t){e.value=["a",e.node.attrs,0],t()}},La=o.injectable()(Aa=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).title="Add or remove link",e.icon="link",e.name="LinkTool",e.select=function(e){return t.Commands.isOnSameTextBlock(e)},e}return J(r,[{key:"run",get:function(){return function(e,n){if(t.Commands.markActive(e.config.schema.marks.link)(e))return m.toggleMark(e.config.schema.marks.link)(e,n),!0;t.Commands.createLink(e,n)}}},{key:"enable",get:function(){return function(e){return t.Commands.isOnSameTextBlock(e)}}},{key:"active",get:function(){return function(e){return t.Commands.markActive(e.config.schema.marks.link)(e)}}}]),r}())||Aa,Ga=function(e,t,n){return new E.InputRule(e,(function(e,r,i,a){var o=e.doc.resolve(i),c=n instanceof Function?n(r):n;if(!o.parent.type.allowsMarkType(t))return null;var s=r[0].substring(0,r[0].length-1),u="email"===c.type?{href:"mailto:".concat(s)}:{href:s,target:"_blank"},l=t.create(u);return e.tr.addMark(i,a,l).insertText(" ",i+s.length)}))},Ja=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="LinkService",e}return J(r,[{key:"boot",value:function(){var e,t=this.container.get("CreateOverlay"),n=this.container.get("CreateRule"),r=this.app.schema.schema;t(za,{},{nodeType:"",markType:"link",followCursor:!1,selection:!1}),n([(e=r.marks.link,Ga(/(?:(?:(https|http|ftp)+):\/\/)?(?:\S+(?::\S*)?(@))?(?:(?:([a-z0-9][a-z0-9\-]*)?[a-z0-9]+)(?:\.(?:[a-z0-9\-])*[a-z0-9]+)*(?:\.(?:[a-z]{2,})(:\d{1,5})?))(?:\/[^\s]*)?\s$/i,e,(function(e){return{type:"@"===e[2]?"email":"uri"}})))])}},{key:"register",value:function(){this.container.bind("Link").to(La),this.container.get("CreateMark")({link:Va},{toWaxSchema:!0})}}]),r}(),Fa={author:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.author",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){console.log(e),e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},title:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"h1",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},subtitle:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.cst",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},epigraphProse:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.epigraph-prose",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},epigraphPoetry:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.epigraph-poetry",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},paragraphCont:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.paragraph-cont",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},extractProse:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.extract-prose",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},extractPoetry:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.extract-poetry",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},orderedlist:{group:"block",content:"list_item+",attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"ol",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},sourceNote:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"p.source-note",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},heading2:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"h2",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},heading3:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"h3",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},heading4:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"h4",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},heading5:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"h5",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},heading6:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:"h6",getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}},customTagBlock:{content:"inline*",group:"block",priority:0,defining:!0,attrs:{id:{default:""},track:{default:[]},group:{default:""},viewid:{default:""}},parseDOM:[{tag:'p[data-type="block"]',getAttrs:function(e,n){Object.assign(e,{id:e.dom.dataset.id,track:t.SchemaHelpers.parseTracks(e.dom.dataset.track),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.node.attrs.track&&e.node.attrs.track.length&&Object.assign(e.value[1],{"data-id":e.node.attrs.id,"data-track":JSON.stringify(e.node.attrs.track),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}),t()}}},qa={format_change:{attrs:{class:{default:"format-change"},id:{default:""},user:{default:0},username:{default:""},date:{default:0},before:{default:[]},after:{default:[]},group:{default:""},viewid:{default:""}},inclusive:!1,group:"track",parseDOM:[{tag:"span.format-change",getAttrs:function(e,n){Object.assign(e,{class:e.dom.getAttribute("class"),id:e.dom.dataset.id,user:e.dom.dataset.user,username:e.dom.dataset.username,date:parseInt(e.dom.dataset.date),before:t.SchemaHelpers.parseFormatList(e.dom.dataset.before),after:t.SchemaHelpers.parseFormatList(e.dom.dataset.after),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),n()}}],toDOM:function(e,t){e.value=["span",{class:e.node.attrs.class,"data-id":e.node.attrs.id,"data-user":e.node.attrs.user,"data-username":e.node.attrs.username,"data-date":e.node.attrs.date,"data-before":JSON.stringify(e.node.attrs.before),"data-after":JSON.stringify(e.node.attrs.after),"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid}],t()}},insertion:{attrs:{class:{default:"insertion"},id:{default:""},user:{default:0},username:{default:""},date:{default:0},group:{default:""},viewid:{default:""},style:{default:null}},inclusive:!1,group:"track",parseDOM:[{tag:"span.insertion",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class"),style:e.dom.getAttribute("style"),id:e.dom.dataset.id,user:e.dom.dataset.user,username:e.dom.dataset.username,date:parseInt(e.dom.dataset.date),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid}),t()}}],toDOM:function(e,t){e.value=["span",{class:e.node.attrs.class,"data-id":e.node.attrs.id,"data-user":e.node.attrs.user,"data-username":e.node.attrs.username,"data-date":e.node.attrs.date,"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid,style:e.node.attrs.style}],t()}},deletion:{attrs:{class:{default:"deletion"},id:{default:""},user:{default:0},username:{default:""},date:{default:0},group:{default:""},viewid:{default:""},style:{default:null}},inclusive:!1,group:"track",parseDOM:[{tag:"span.deletion",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class"),style:e.dom.getAttribute("style"),id:e.dom.dataset.id,user:e.dom.dataset.user,username:e.dom.dataset.username,date:parseInt(e.dom.dataset.date),group:e.dom.dataset.group,viewid:e.dom.dataset.viewid,color:e.dom.dataset.color}),t()}}],toDOM:function(e,t){e.value=["span",{class:e.node.attrs.class,"data-id":e.node.attrs.id,"data-user":e.node.attrs.user,"data-username":e.node.attrs.username,"data-date":e.node.attrs.date,"data-group":e.node.attrs.group,"data-viewid":e.node.attrs.viewid,style:e.node.attrs.style}],t()}}},Qa=new u.PluginKey("track"),Ya=function(e){return new u.Plugin({key:Qa,state:{init:function(e,t){return{decos:l.DecorationSet.empty}},apply:function(e,n,r,i){var a=e.getMeta(Qa);if(a)return a;var o,c=i.selection,s=c.from,u=c.to,d=this.getState(r).decos;if(d=l.DecorationSet.empty,e.selectionSet){var f=function(e){var n,r,i,a,o,c,s=e.selection,u={insertion:!1,deletion:!1,formatChange:!1},l=!1,d=!1,f=!1;if(s.empty){var p=e.doc.resolve(s.from).marks();p&&((n=p.find((function(e){return"insertion"===e.type.name&&!e.attrs.approved})))&&(l=s.from),(r=p.find((function(e){return"deletion"===e.type.name})))&&(d=s.from),(i=p.find((function(e){return"format_change"===e.type.name})))&&(f=s.from)),e.doc.nodesBetween(s.from,s.to,(function(e,t){return n||(n=e.attrs.track?e.attrs.track.find((function(e){return"insertion"===e.type})):e.marks.find((function(e){return"insertion"===e.type.name&&!e.attrs.approved})))&&(l=t,e.isInline||(a=e.nodeSize)),r||(r=e.attrs.track?e.attrs.track.find((function(e){return"deletion"===e.type})):e.marks.find((function(e){return"deletion"===e.type.name})))&&(d=t,e.isInline||(o=e.nodeSize)),i||(i=e.marks.find((function(e){return"format_change"===e.type.name})))&&(f=t,e.isInline||(c=e.nodeSize)),!1}))}else e.doc.nodesBetween(s.from,s.to,(function(e,t){return t<s.from||(n||(n=e.attrs.track?e.attrs.track.find((function(e){return"insertion"===e.type})):e.marks.find((function(e){return"insertion"===e.type.name&&!e.attrs.approved})))&&(l=t,e.isInline||(a=e.nodeSize)),r||(r=e.attrs.track?e.attrs.track.find((function(e){return"deletion"===e.type})):e.marks.find((function(e){return"deletion"===e.type.name})))&&(d=t,e.isInline||(o=e.nodeSize)),i||(i=e.marks.find((function(e){return"format_change"===e.type.name})))&&(f=t,e.isInline||(c=e.nodeSize)),!1)}));return n&&(u.insertion=a?{from:l,to:l+a}:t.DocumentHelpers.findMarkPosition(e,l,"insertion")),r&&(u.deletion=o?{from:d,to:d+o}:t.DocumentHelpers.findMarkPosition(e,d,"deletion")),i&&(u.formatChange=c?{from:f,to:f+c}:t.DocumentHelpers.findMarkPosition(e,f,"format_change")),u}(i),p=f.insertion,m=f.deletion,g=f.formatChange,h=e.selection.node?l.Decoration.node:l.Decoration.inline;i.doc.nodesBetween(s,u,(function(t,n){if(t.attrs.track&&t.attrs.track.find((function(e){return"block_change"===e.type||"insertion"===e.type||"deletion"===e.type}))){var r=n;t.descendants((function(e,t){r+=e.nodeSize})),t.attrs.track[0].id=t.attrs.id,o={from:n,to:r,attrs:t.attrs.track[0]},d=d.add(e.doc,[h(n,r,{class:"selected-block-change"})])}})),p&&(d=d.add(e.doc,[h(p.from,p.to,{class:"selected-insertion"})])),m&&(d=d.add(e.doc,[h(m.from,m.to,{class:"selected-deletion"})])),g&&(s===u&&(o=g),d=d.add(e.doc,[h(g.from,g.to,{class:"selected-format-change"})]))}else d=d.map(e.mapping,e.doc);return{trackChange:o,decos:d}}},props:{decorations:function(e){return this.getState(e).decos},handleDOMEvents:{focus:function(e,t){}}}})},Ka=new u.PluginKey("hideShowPlugin"),Ua=!1,Za=function(e){return new u.Plugin({key:Ka,state:{init:function(e,t){return l.DecorationSet.empty},apply:function(e,n,r,i){var a,o,c,s=l.DecorationSet.empty,u=(o=i,c=[],t.DocumentHelpers.findInlineNodes(o.doc).map((function(e){e.node.marks.length>0&&e.node.marks.filter((function(t){"insertion"!==t.type.name&&"deletion"!==t.type.name&&"format_change"!==t.type.name||(t.pos=e.pos,c.push(t))}))})),c);return u.length>0&&Ua&&(a=u.map((function(e,n){if("insertion"===e.type.name){var r=t.DocumentHelpers.findMarkPosition(i,e.pos,"insertion");return l.Decoration.inline(r.from,r.to,{class:"show-insertion"})}if("deletion"===e.type.name){var a=t.DocumentHelpers.findMarkPosition(i,e.pos,"deletion");return l.Decoration.inline(a.from,a.to,{class:"hide-deletion"})}})),s=l.DecorationSet.create(i.doc,a)),{createdDecorations:s,allMatches:u}}},props:{decorations:function(e){return(e&&Ka.getState(e)).createdDecorations},setHideShow:function(e){Ua=e}}})},Xa=function(e){var i=e.view,a=void 0===i?{}:i,o=e.item,c=e.enabled,s=$(n.useState(c),2),u=s[0],l=s[1];return n.useMemo((function(){return r.createElement(t.MenuButton,{active:u,disabled:o.enable&&!o.enable(a.state),label:"Track Changes",onMouseDown:function(e){return function(e){e.preventDefault(),l(!u),o.run(a.state,a.dispatch)}(e)},title:o.title})}),[u])},_a=o.injectable()(Ta=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Toggle Track Changes",e.label="Track Changes",e.name="EnableTrackChange",e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Xa,{enabled:this.config.enabled,item:this.toJSON(),key:s.v4(),view:e}):null}},{key:"run",get:function(){var e=this;return function(){return e.config.enabled=!e.config.enabled,!0}}},{key:"enable",get:function(){return function(){return!0}}}]),a}())||Ta,$a=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="EnableTrackChangeService",e}return J(r,[{key:"register",value:function(){var e=this;this.container.bind("EnableTrackChange").toDynamicValue((function(){return new _a(e.config)}))}}]),r}(),eo=function(e,t,n,r){var i=r.map(n),a=u.Selection.findFrom(e.doc.resolve(i),-1).$anchor.pos,o=i+1,c=y.replaceStep(e.doc,a,o);e.step(c);var s=c.getMap();r.appendMap(s)},to=function(e,t,n){return!(e.attrs.username===t.username&&!n.own.accept)&&!(e.attrs.username!==t.username&&!n.others.accept)},no=o.injectable()(Oa=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Accept Changes",e.label="Accept in selection",e.icon="acceptTrack",e.name="AcceptTrackChange",e.select=function(e,t,n){var r=n.state.selection;return r.from!==r.to||"main"===t},e}return J(r,[{key:"run",get:function(){var e=this;return function(t,n,r){var i=t.tr,a=t.selection,o=a.from,c=a.to;i.setMeta("AcceptReject",!0);var s=new y.Mapping;t.doc.nodesBetween(o,c,(function(t,n){if(t.attrs.track&&t.attrs.track.find((function(e){return"deletion"===e.type}))&&eo(i,0,n,s),t.marks&&t.marks.find((function(e){return"deletion"===e.type.name}))){var a=t.marks.find((function(e){return"deletion"===e.type.name}));if(!to(a,r,e.config))return;var u=new y.ReplaceStep(s.map(Math.max(n,o)),s.map(Math.min(n+t.nodeSize,c)),h.Slice.empty);i.step(u),s.appendMap(u.getMap())}else if(t.attrs.track&&t.attrs.track.find((function(e){return"insertion"===e.type}))){var l=t.attrs.track.filter((function(e){return"insertion"!==e.type}));i.setNodeMarkup(s.map(n),null,Object.assign(t.attrs.track,{track:l}),t.marks)}else if(t.marks&&t.marks.find((function(e){return"insertion"===e.type.name}))){var d=t.marks.find((function(e){return"insertion"===e.type.name}));if(!to(d,r,e.config))return;i.step(new y.RemoveMarkStep(s.map(Math.max(n,o)),s.map(Math.min(n+t.nodeSize,c)),d))}else if(t.marks&&t.marks.find((function(e){return"format_change"===e.type.name}))){var f=t.marks.find((function(e){return"format_change"===e.type.name}));if(!to(f,r,e.config))return;i.step(new y.RemoveMarkStep(s.map(Math.max(n,o)),s.map(Math.min(n+t.nodeSize,c)),f))}else if(t.attrs.track&&t.attrs.track.find((function(e){return"block_change"===e.type}))){var p=t.attrs.track.find((function(e){return"block_change"===e.type}));t.attrs.track.filter((function(e){return e!==p}));i.setNodeMarkup(s.map(n),null,{class:t.attrs.class,track:[]},t.marks)}})),i.steps.length&&n(i)}}},{key:"active",get:function(){return function(e){}}}]),r}())||Oa,ro=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="AcceptTrackChangeService",e}return J(r,[{key:"register",value:function(){var e=this;this.container.bind("AcceptTrackChange").toDynamicValue((function(){return new no(e.config)}))}}]),r}(),io=function(e,t,n){return!(e.attrs.username===t.username&&!n.own.reject)&&!(e.attrs.username!==t.username&&!n.others.reject)},ao=o.injectable()(Ma=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Reject Changes",e.label="Reject in selection",e.icon="rejectTrack",e.name="RejectTrackChange",e.select=function(e,t,n){var r=n.state.selection;return r.from!==r.to||"main"===t},e}return J(r,[{key:"run",get:function(){var e=this;return function(t,n,r){var i=t.tr,a=t.selection,o=a.from,c=a.to;i.setMeta("AcceptReject",!0);var s=new y.Mapping;t.doc.nodesBetween(o,c,(function(n,a){if(n.marks&&n.marks.find((function(e){return"deletion"===e.type.name}))){var u=n.marks.find((function(e){return"deletion"===e.type.name}));if(!io(u,r,e.config))return;i.step(new y.RemoveMarkStep(s.map(Math.max(a,o)),s.map(Math.min(a+n.nodeSize,c)),u))}else if(n.attrs.track&&n.attrs.track.find((function(e){return"insertion"===e.type})))eo(i,0,a,s);else if(n.marks&&n.marks.find((function(e){return"insertion"===e.type.name}))){var l=n.marks.find((function(e){return"insertion"===e.type.name}));if(!io(l,r,e.config))return;var d=new y.ReplaceStep(s.map(Math.max(a,o)),s.map(Math.min(a+n.nodeSize,c)),h.Slice.empty);i.step(d),s.appendMap(d.getMap())}else if(n.marks&&n.marks.find((function(e){return"format_change"===e.type.name}))){var f=n.marks.find((function(e){return"format_change"===e.type.name}));f.attrs.before.forEach((function(e){i.step(new y.AddMarkStep(s.map(Math.max(a,o)),s.map(Math.min(a+n.nodeSize,c)),t.schema.marks[e].create()))})),f.attrs.after.forEach((function(e){i.step(new y.RemoveMarkStep(s.map(Math.max(a,o)),s.map(Math.min(a+n.nodeSize,c)),n.marks.find((function(t){return t.type.name===e}))))})),i.step(new y.RemoveMarkStep(s.map(Math.max(a,o)),s.map(Math.min(a+n.nodeSize,c)),f))}else if(!n.isInline&&n.attrs.track){var p=n.attrs.track.find((function(e){return"block_change"===e.type}));if(p){var m=n.attrs.track.filter((function(e){return e!==p}));i.setNodeMarkup(s.map(a),t.schema.nodes[p.before.type],Object.assign({},n.attrs,p.before.attrs,{track:m}),n.marks)}}})),i.steps.length&&n(i)}}},{key:"active",get:function(){return function(e){}}}]),r}())||Ma,oo=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="RejectTrackChangeService",e}return J(r,[{key:"register",value:function(){var e=this;this.container.bind("RejectTrackChange").toDynamicValue((function(){return new ao(e.config)}))}}]),r}(),co=o.injectable()(Da=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Show/Hide Changes",e.icon="showTrack",e.label="Show suggestions",e.name="ShowHideTrackChange",e.select=function(e,t,n){return!0},e}return J(r,[{key:"run",get:function(){return function(e,t){}}},{key:"active",get:function(){return function(e){}}}]),r}())||Da,so=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="ShowHideTrackChangeService",e}return J(r,[{key:"register",value:function(){this.container.bind("ShowHideTrackChange").to(co)}}]),r}(),uo=o.injectable()(ja=function(e){I(r,t.ToolGroup);var n=L(r);function r(e,t){var i;return W(this,r),(i=n.call(this)).tools=[],i.tools=[t,e],i}return r=o.inject("FindAndReplace")(r,void 0,1)||r,r=o.inject("EditingSuggesting")(r,void 0,0)||r}())||ja,lo=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("TrackingAndEditing").to(uo)}}]),r}(),fo=o.injectable()(Ba=function(e){I(r,t.ToolGroup);var n=L(r);function r(e,t,i){var a;return W(this,r),(a=n.call(this)).tools=[],a.tools=[e,t,i],a}return r=o.inject("RejectTrackChange")(r,void 0,2)||r,r=o.inject("AcceptTrackChange")(r,void 0,1)||r,r=o.inject("ShowHideTrackChange")(r,void 0,0)||r}())||Ba,po=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("TrackOptions").to(fo)}}]),r}();function mo(){var e=ke(["\n  display: flex;\n  flex-direction: column;\n\n  button {\n    padding-top: 6px;\n    text-align: start;\n  }\n\n  svg {\n    margin-top: 3px;\n  }\n"]);return mo=function(){return e},e}function go(){var e=ke(["\n  color: #bdc2ca;\n  text-transform: uppercase;\n"]);return go=function(){return e},e}function ho(){var e=ke(["\n  background: #fff;\n  border-radius: 1.03093% / 8%;\n  box-shadow: rgba(9, 30, 66, 0.25) 0px 4px 8px 0px,\n    rgba(9, 30, 66, 0.31) 0px 0px 1px 0px;\n  font-size: 14px;\n  padding: ",";\n  transform-origin: 50% 50% 0px;\n  width: 200px;\n"]);return ho=function(){return e},e}var vo=p.div(ho(),x.grid(2)),yo=p.div(go()),ko=p.div(mo()),xo=function(e){var a,o,s,u,l=e.groups,d=e.setShowHidden,f=e.showHiddenValue,p=c.useTranslation(),m=p.t,g=p.i18n,h=l[0].items,v=n.useContext(t.WaxContext),y=v.app,k=v.pmViews,x=v.activeView,b=v.activeViewId,w=x.state,E=y.config.get("user"),C=y.PmPlugins.get("hideShowPlugin"),S=(a=k.main,o=t.DocumentHelpers.findInlineNodes(a.state.doc),s=[],o.map((function(e){e.node.marks.length>0&&e.node.marks.filter((function(e){"insertion"!==e.type.name&&"deletion"!==e.type.name&&"format_change"!==e.type.name||s.push(e)}))})),s).length,A=function(e){var n=t.DocumentHelpers.findBlockNodes(e.state.doc),r=[];return n.map((function(e){e.node.attrs.track&&e.node.attrs.track.length>0&&r.push(e)})),r}(k.main).length;return r.createElement(vo,null,r.createElement(yo,null,S+A," ",!i.isEmpty(g)&&g.exists("Wax.TrackChanges.Suggestions")?m("Wax.TrackChanges.Suggestions"):"Suggestions"),r.createElement(ko,null,((u=[]).push(h.map((function(e){var n=!(!e.active(w,b)||!e.select(w,b)),a=!i.isEmpty(g)&&g.exists("Wax.TrackChanges.".concat(e.label))?m("Wax.TrackChanges.".concat(e.label)):e.label;"ShowHideTrackChange"===e.name&&f&&(a=!i.isEmpty(g)&&g.exists("Wax.TrackChanges.Hide suggestions")?m("Wax.TrackChanges.Hide suggestions"):"Hide suggestions");var o=!e.select(w,b,x);return r.createElement(t.MenuButton,{active:n||!1,disabled:o,iconName:e.icon,key:e.name,label:a,onMouseDown:function(t){return t.preventDefault(),"ShowHideTrackChange"===e.name?(d(!f),C.props.setHideShow(f),i.each(k,(function(e){e.dispatch(e.state.tr)})),!1):e.run(x.state,x.dispatch,E)}})}))),r.createElement(r.Fragment,null,u))))};function bo(){var e=ke(["\n  background: white;\n  margin-top: ",";\n  position: absolute;\n  right: -3px;\n  top: 32px;\n"]);return bo=function(){return e},e}function wo(){var e=ke(["\n  font-size: 0;\n  position: relative;\n  z-index: 2;\n"]);return wo=function(){return e},e}var Eo,Co=p.div(wo()),So=p.div(bo(),x.grid(1)),Ao=function(e){e.view,e.item;var i=e.groups,a=$(n.useState(!1),2),o=a[0],c=a[1],s=$(n.useState(!0),2),u=s[0],l=s[1],d=n.useRef(),f=function(e){l(e)};return n.useMemo((function(){return r.createElement(Co,{ref:d},r.createElement(t.MenuButton,{active:o,disabled:!1,iconName:"more",onMouseDown:function(){c(!o)}}),o&&r.createElement(So,null,r.createElement(xo,{close:function(){c(!1)},groups:i,setShowHidden:f,showHiddenValue:u})))}),[o,u])},To=o.injectable()(Eo=function(e){I(c,t.ToolGroup);var a=L(c);function c(e){var t;return W(this,c),(t=a.call(this)).tools=[],t.toolGroups=[],t.toolGroups=[{groups:[e]}],t}return J(c=o.inject("TrackOptions")(c,void 0,0)||c,[{key:"renderTools",value:function(e){var t=this;return i.isEmpty(e)?null:n.useMemo((function(){return r.createElement(Ao,{groups:t._toolGroups[0].groups.map((function(e){return{items:e._tools}})),key:s.v4(),view:e})}),[])}}]),c}())||Eo,Oo=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("TrackCommentOptions").to(To)}}]),r}(),Mo=[new $a,new ro,new oo,new so,new lo,new po,new Oo],Do=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=Mo,e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("trackChangePlugin",Ya()),this.app.PmPlugins.add("hideShowPlugin",Za())}},{key:"register",value:function(){var e=this.container.get("CreateMark"),t=this.container.get("CreateNode");Object.keys(qa).forEach((function(t){e(ue({},t,qa[t]),{toWaxSchema:!0})})),Object.keys(Fa).forEach((function(e){t(ue({},e,Fa[e]),{toWaxSchema:!0})}))}}]),r}(),jo={group:"inline math",content:"text*",inline:!0,atom:!0,toDOM:function(){return["math-inline",{class:"math-node"},0]},parseDOM:[{tag:"math-inline"}]},Bo={group:"block math",content:"text*",atom:!0,code:!0,toDOM:function(){return["math-display",{class:"math-node"},0]},parseDOM:[{tag:"math-display"}]},Po={toDOM:function(){return["math-select",0]},parseDOM:[{tag:"math-select"}]};function Wo(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return function(i,a){var o=e.state,c=o.selection,s=c.to,l=c.from,d=i.selection,f=d.to,p=d.from;if(r&&f!==p)return!1;var m=t>0?f:p;if(n){var g=i.doc.nodeSize-2;if(t>0&&m<g)return!1;if(t<0&&m>0)return!1}if(a){var h=t>0?s:l;e.dispatch(o.tr.setSelection(u.TextSelection.create(o.doc,h))),e.focus()}return!0}}var No=M.AllPackages.sort().join(", "),Io=T.liteAdaptor(),Ho=(O.RegisterHTMLHandler(Io),new S.TeX({packages:No.split(/\s*,\s*/)})),Ro=new A.SVG({fontCache:"none"}),zo=C.mathjax.document("",{InputJax:Ho,OutputJax:Ro}),Vo=function(){function e(t,n,r){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0;W(this,e),this._node=t,this._outerView=n,this._getPos=r,this._onDestroy=c&&c.bind(this),this._mathPluginKey=o,this.cursorSide="start",this._isEditing=!1,this._katexOptions=Object.assign({globalGroup:!0,throwOnError:!1},a.katexOptions),this._tagName=a.tagName||this._node.type.name.replace("_","-"),this.dom=document.createElement(this._tagName),this.dom.classList.add("math-node"),this._mathRenderElt=document.createElement("span"),this._mathRenderElt.textContent="",this._mathRenderElt.classList.add("math-render"),this.dom.appendChild(this._mathRenderElt),this._mathSrcElt=document.createElement("span"),this._mathSrcElt.classList.add("math-src"),this.dom.appendChild(this._mathSrcElt),this.dom.addEventListener("click",(function(){return i.ensureFocus()})),this.renderMath()}return J(e,[{key:"destroy",value:function(){this.closeEditor(!1),this._mathRenderElt&&(this._mathRenderElt.remove(),delete this._mathRenderElt),this._mathSrcElt&&(this._mathSrcElt.remove(),delete this._mathSrcElt),this.dom.remove()}},{key:"ensureFocus",value:function(){this._innerView&&this._outerView.hasFocus()&&this._innerView.focus()}},{key:"update",value:function(e,t){if(!e.sameMarkup(this._node))return!1;if(this._node=e,this._innerView){var n=this._innerView.state,r=e.content.findDiffStart(n.doc.content);if(null!=r){var i=e.content.findDiffEnd(n.doc.content);if(i){var a=i.a,o=i.b,c=r-Math.min(a,o);c>0&&(a+=c,o+=c),this._innerView.dispatch(n.tr.replace(r,o,e.slice(r,a)).setMeta("fromOutside",!0))}}}return this._isEditing||this.renderMath(),!0}},{key:"updateCursorPos",value:function(e){var t=this._getPos(),n=this._node.nodeSize;e.selection.from<t+n&&t<e.selection.to||(this.cursorSide=t<e.selection.from?"end":"start")}},{key:"selectNode",value:function(){this.dom.classList.add("ProseMirror-selectednode"),this._isEditing||this.openEditor()}},{key:"deselectNode",value:function(){this.dom.classList.remove("ProseMirror-selectednode"),this._isEditing&&this.closeEditor()}},{key:"stopEvent",value:function(e){return void 0!==this._innerView&&void 0!==e.target&&this._innerView.dom.contains(e.target)}},{key:"ignoreMutation",value:function(){return!0}},{key:"renderMath",value:function(){if(this._mathRenderElt){var e=this._node.content.content,t="";if(e.length>0&&null!==e[0].textContent&&(t=e[0].textContent.trim()),t.length<1)for(this.dom.classList.add("empty-math");this._mathRenderElt.firstChild;)this._mathRenderElt.firstChild.remove();else{this.dom.classList.remove("empty-math");var n=zo.convert(t||"",{em:16,ex:8,containerWidth:700});this._mathRenderElt.innerHTML=Io.innerHTML(n)}}}},{key:"dispatchInner",value:function(e){if(this._innerView){var t=this._innerView.state.applyTransaction(e),n=t.state,r=t.transactions;if(this._innerView.updateState(n),!e.getMeta("fromOutside")){for(var i=this._outerView.state.tr,a=y.StepMap.offset(this._getPos()+1),o=0;o<r.length;o++)for(var c=r[o].steps,s=0;s<c.length;s++){var u=c[s].map(a);if(!u)throw Error("step discarded!");i.step(u)}i.docChanged&&this._outerView.dispatch(i)}}}},{key:"openEditor",value:function(){var e,t=this;if(this._innerView)throw Error("inner view should not exist!");this._innerView=new l.EditorView(this._mathSrcElt,{state:u.EditorState.create({doc:this._node,plugins:[k.keymap({Tab:function(e,t){return t&&t(e.tr.insertText("\t")),!0},Backspace:m.chainCommands(m.deleteSelection,(function(e,n,r){return!!e.selection.empty&&(!(t._node.textContent.length>0)&&(t._outerView.dispatch(t._outerView.state.tr.insertText("")),t._outerView.focus(),!0))})),"Ctrl-Backspace":function(e,n,r){return t._outerView.dispatch(t._outerView.state.tr.insertText("")),t._outerView.focus(),!0},Enter:m.chainCommands(m.newlineInCode,Wo(this._outerView,1,!1)),"Ctrl-Enter":Wo(this._outerView,1,!1),ArrowLeft:Wo(this._outerView,-1,!0),ArrowRight:Wo(this._outerView,1,!0),ArrowUp:Wo(this._outerView,-1,!0),ArrowDown:Wo(this._outerView,1,!0)})]}),dispatchTransaction:this.dispatchInner.bind(this)});var n=this._innerView.state;this._innerView.focus();var r=null===(e=this._mathPluginKey.getState(this._outerView.state))||void 0===e?void 0:e.prevCursorPos;null==r&&console.error("[prosemirror-math] Error:  Unable to fetch math plugin state from key.");var i=(null!=r?r:0)<=this._getPos()?0:this._node.nodeSize-2;this._innerView.dispatch(n.tr.setSelection(u.TextSelection.create(n.doc,i))),this._isEditing=!0}},{key:"closeEditor",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._innerView&&(this._innerView.destroy(),this._innerView=void 0),e&&this.renderMath(),this._isEditing=!1}}]),e}(),Lo=new u.PluginKey("prosemirror-math");function Go(e){return function(t,n,r){var i=Lo.getState(n.state);if(!i)throw new Error("no math plugin!");var a=i.activeNodeViews,o=new Vo(t,n,r,{katexOptions:{displayMode:e,macros:i.macros}},Lo,(function(){a.splice(a.indexOf(o))}));return a.push(o),o}}var Jo={key:Lo,state:{init:function(e,t){return{macros:{},activeNodeViews:[],prevCursorPos:0}},apply:function(e,t,n,r){return{activeNodeViews:t.activeNodeViews,macros:t.macros,prevCursorPos:n.selection.from}}},props:{nodeViews:{math_inline:Go(!1),math_display:Go(!0)}}},Fo=new u.Plugin(Jo),qo=new u.PluginKey("mathSelect"),Qo=function(e){var t=e.selection,n=t.from,r=(t.to,e.selection.content().content),i=[];return r.descendants((function(e,t,r){return"text"!=e.type.name&&(!e.type.name.startsWith("math_")||(i.push({start:Math.max(n+t-1,0),end:n+t+e.nodeSize-1}),!1))})),l.DecorationSet.create(e.doc,i.map((function(e){var t=e.start,n=e.end;return l.Decoration.node(t,n,{class:"math-select"})})))},Yo=new u.Plugin({key:qo,state:{init:function(e,t){return Qo(t)},apply:function(e,t){return e.selection&&e.selectionSet?Qo(e):t}},props:{decorations:function(e){return Yo.getState(e)}}}),Ko=function(e,t,n){return new E.InputRule(e,(function(e,r,i,a){var o=e.doc.resolve(i),c=o.index(),s=e.doc.resolve(a),u=n instanceof Function?n(r):n;return o.parent.canReplaceWith(c,s.index(),t)?e.tr.replaceRangeWith(i,a,t.create(u,t.schema.text(r[1]))):null}))},Uo=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="MathService",e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("mathplugin",Fo),this.app.PmPlugins.add("mathselectplugin",Yo);var e,t,n,r=this.container.get("CreateRule"),i=this.app.schema.schema;r([(e=/^\$\$\s+$/,t=i.nodes.math_display,new E.InputRule(e,(function(e,r,i,a){var o=e.doc.resolve(i),c=n instanceof Function?n(r):n;if(!o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),t))return null;var s=e.tr.delete(i,a).setBlockType(i,i,t,c);return s.setSelection(u.NodeSelection.create(s.doc,s.mapping.map(o.pos-1)))}))),Ko(/(?!\\)\$(.+)(?!\\)\$/,i.nodes.math_inline)])}},{key:"register",value:function(){var e=this.container.get("CreateNode"),t=this.container.get("CreateMark");e({math_display:Bo}),e({math_inline:jo}),t({math_select:Po})}}]),r}(),Zo=new u.PluginKey("findAndReplacePlugin"),Xo="",_o=!1,$o=function(e){var n=[],r=[];return i.each(e.state.schema.nodes,(function(e){e.groups.includes("notes")&&r.push(e)})),r.length>0&&r.forEach((function(r){t.DocumentHelpers.findChildrenByType(e.state.doc,e.state.schema.nodes[r.name],!0).forEach((function(e){n.push(e.node.attrs.id)}))})),n},ec=function(e,n,r){var a=0;return i.each(e,(function(e){var i=t.DocumentHelpers.findMatches(e.state.doc,n,r);a+=i.length})),a},tc=function(e,n,r){var a={};return i.each(e,(function(e,i){a[i]||(a[i]=t.DocumentHelpers.findMatches(e.state.doc,n,r))})),a},nc=$o,rc=function(e){var t={};return i.each(e,(function(e,n){e.forEach((function(e){t[n]?t[n].push(e.from):t[n]=[e.from]}))})),t},ic=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return t.reduce((function(t,r){var i=n?t>r:t<r,a=Math.abs(t-e),o=Math.abs(r-e);return a===o?i?t:r:o<a?r:t}))},ac=function(e,t,n,r){var i=new u.TextSelection(e[t].state.doc.resolve(n[t][r].from)),a=new u.TextSelection(e[t].state.doc.resolve(n[t][r].to));e[t].dispatch(e[t].state.tr.setSelection(u.TextSelection.between(i.$anchor,a.$head))),e[t].dispatch(e[t].state.tr.scrollIntoView())},oc=function(e,t){e[t].dispatch(e[t].state.tr.setSelection(u.TextSelection.create(e[t].state.doc,0)))},cc=function(e,t,n){var r=$o(t.main);if("main"===n)for(var i=0;i<r.length;i+=1)if(e[r[i]].length>0)return r[i];if(r.indexOf(n)<r.length-1){for(var a=0;a<r.length;a+=1)if(e[r[a]].length>0)return r[a]}else{if(e.main.length>0)return"main";for(var o=0;o<r.length;o+=1)if(e[r[o]].length>0)return r[o]}return!(!r.indexOf(n)||r.indexOf(n)!==r.length-1)&&"main"},sc=function(e,t,n){var r=$o(t.main);if("main"===n)for(var i=r.length-1;i>=0;i-=1)if(e[r[i]].length>0)return r[i];if(0!==r.indexOf(n))for(var a=r.indexOf(n)-1;a>=0;a-=1){if(e[r[a]].length>0)return r[a];if(e.main.length>0)return"main"}else{if(e.main.length>0)return"main";for(var o=r.length-1;o>=0;o-=1)if(e[r[o]].length>0)return r[o]}return!1};function uc(){var e=ke(["\n  background: ",";\n  cursor: pointer;\n  fill: ",";\n  height: 24px;\n  padding: 2px;\n  vertical-align: top;\n  width: 24px;\n"]);return uc=function(){return e},e}function lc(){var e=ke(["\n  cursor: ",";\n  height: 24px;\n  opacity: ",";\n  width: 24px;\n"]);return lc=function(){return e},e}function dc(){var e=ke(["\n  pointer-events: ",";\n"]);return dc=function(){return e},e}function fc(){var e=ke(["\n  &:focus {\n    outline: none;\n  }\n"]);return fc=function(){return e},e}function pc(){var e=ke(["\n  border-left: 1px solid #e0e2e7;\n  margin-left: 1%;\n"]);return pc=function(){return e},e}function mc(){var e=ke(["\n  cursor: pointer;\n  height: 24px;\n  width: 24px;\n"]);return mc=function(){return e},e}function gc(){var e=ke(["\n  font-size: 12px;\n  position: absolute;\n  right: 141px;\n  -webkit-text-fill-color: rgba(27, 43, 75, 0.28);\n  top: 13px;\n  z-index: 1;\n"]);return gc=function(){return e},e}function hc(){var e=ke(["\n  display: flex;\n  margin-left: auto;\n  width: 126px;\n"]);return hc=function(){return e},e}function vc(){var e=ke(["\n  border: none;\n  border-radius: 2px;\n  box-shadow: inset 0 0 0 1px rgba(27, 43, 75, 0.28);\n  font-size: 15px;\n  font-weight: 400;\n  padding: "," "," "," ",";\n  width: 100%;\n\n  ::placeholder {\n    color: #d8dae0;\n  }\n\n  &:focus {\n    outline: none;\n  }\n"]);return vc=function(){return e},e}function yc(){var e=ke(["\n  width: 266px;\n"]);return yc=function(){return e},e}function kc(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n  width: 100%;\n"]);return kc=function(){return e},e}function xc(){var e=ke(["\n  background: #fff;\n  border-radius: 1.03093% / 8%;\n  box-shadow: rgba(9, 30, 66, 0.25) 0px 4px 8px 0px,\n    rgba(9, 30, 66, 0.31) 0px 0px 1px 0px;\n  padding: ",";\n  transform-origin: 50% 50% 0px;\n  width: 400px;\n"]);return xc=function(){return e},e}var bc=p.div(xc(),x.grid(2)),wc=p.div(kc()),Ec=p.div(yc()),Cc=p.input(vc(),x.grid(1),x.grid(10),x.grid(1),x.grid(1)),Sc=p.div(hc()),Ac=p.span(gc()),Tc=p(t.Icon)(mc()),Oc=p.div(pc()),Mc=p.span(fc()),Dc=p.div(dc(),(function(e){return e.isDisabled?"none":""})),jc=p(t.Icon)(lc(),(function(e){return e.isDisabled?"not-allowed":"pointer"}),(function(e){return e.isDisabled?"0.4":"1"})),Bc=p.svg.attrs((function(){return{version:"1.1",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"}}))(uc(),(function(e){return e.active?"#535E76":"white"}),(function(e){return e.active?"white":"#535E76"})),Pc=function(e){var a=e.close,o=e.expand,s=e.setPreviousSearcValue,u=e.setMatchCaseValue,l=e.findNextMatch,d=e.findPreviousMatch,f=n.useContext(t.WaxContext),p=f.app,m=f.pmViews,g=f.activeViewId,h=f.pmViews.main,v=n.useRef(null),y=c.useTranslation(),k=y.t,x=y.i18n,b=h.props.editable((function(e){return e})),w=function(e){var t=e.label;return r.createElement(r.Fragment,null,!i.isEmpty(x)&&x.exists("Wax.FindAndReplace.".concat(t))?k("Wax.FindAndReplace.".concat(t)):t)},E=!i.isEmpty(x)&&x.exists("Wax.FindAndReplace.of")?k("Wax.FindAndReplace.of"):"of",C=$(n.useState(""),2),S=C[0],A=C[1],T=$(n.useState("0 ".concat(E," 0")),2),O=T[0],M=T[1],D=$(n.useState(!1),2),j=D[0],B=D[1],P=p.PmPlugins.get("findAndReplacePlugin"),W=$(n.useState(!0),2),N=W[0],I=W[1],H=[],R=t.useDebounce(S,300);i.each(m,(function(e){H.push(e.state)}));n.useEffect((function(){z(),N&&setTimeout((function(){v.current.focus(),I(!1)}))}),[R,j,JSON.stringify(H)]);var z=function(){P.props.setSearchText(S),P.props.setSearchMatchCase(j),function(e){if(0===e)return M("0 ".concat(E," 0"));M("0 ".concat(E," ").concat(e));var t=m[g].state.selection,n=t.from,r=t.to,i=tc(m,S,j),a=rc(i),o=0;if("main"===g){1===i.main.filter((function(e){return n===e.from&&r===e.to})).length&&M("".concat(a.main.indexOf(n)+1," of ").concat(e))}else{a.main&&(o=a.main.length);for(var c=nc(m.main),s=0;s<c.length;s+=1)if(a[c[s]]&&g!==c[s]&&(o+=a[c[s]].length),a[c[s]]&&g===c[s]){1===i[c[s]].filter((function(e){return n===e.from&&r===e.to})).length&&(o+=a[c[s]].indexOf(n)+1,M("".concat(o," of ").concat(e)));break}}}(ec(m,S,j)),v.current===document.activeElement&&i.eachRight(m,(function(e){e.dispatch(e.state.tr)}))};return r.createElement(bc,null,r.createElement(wc,null,r.createElement(Ec,null,r.createElement(Cc,{onChange:function(){A(v.current.value)},placeholder:!i.isEmpty(x)&&x.exists("Wax.FindAndReplace.Find")?k("Wax.FindAndReplace.Find"):"Find",ref:v,type:"text",value:S}),r.createElement(Ac,null," ",O," ")),r.createElement(Sc,null,r.createElement(Mc,{onClick:function(){B(!j),u(!j),v.current.focus()},role:"button",tabIndex:"0"},r.createElement(Bc,{active:j,fill:"none",viewBox:"0 0 24 24"},r.createElement("title",null," ",r.createElement(w,{label:"Match Case"})," "),r.createElement("path",{d:"M2.5,4v3h5v12h3V7h5V4H2.5z M21.5,9h-9v3h3v7h3v-7h3V9z"}))),r.createElement(Mc,{onClick:function(){return d(S,j)},role:"button",tabIndex:"0"},r.createElement(Tc,{name:"navigatePrevious"})),r.createElement(Mc,{onClick:function(){return l(S,j)},role:"button",tabIndex:"0"},r.createElement(Tc,{name:"navigateNext"})),r.createElement(Dc,{isDisabled:!b,onClick:function(){o(),s(S)}},r.createElement(jc,{isDisabled:!b,name:"more"})),r.createElement(Oc,{onClick:function(){P.props.setSearchText(""),i.each(m,(function(e){e.dispatch(e.state.tr)})),a()}},r.createElement(Tc,{name:"close"})))))};function Wc(){var e=ke(["\n  color: #4b5871;\n  font-size: 15px;\n  margin-left: 30px;\n  position: relative;\n  top: 2px;\n  width: 200px;\n"]);return Wc=function(){return e},e}function Nc(){var e=ke(["\n  background-color: transparent;\n  border: 2px solid #4b5871;\n  border-radius: 5px;\n  height: 20px;\n  left: 0px;\n  position: absolute;\n  top: 0px;\n  transition: all 0.3s ease-out;\n  width: 20px;\n  -webkit-transition: all 0.3s ease-out;\n  -moz-transition: all 0.3s ease-out;\n  -ms-transition: all 0.3s ease-out;\n  -o-transition: all 0.3s ease-out;\n\n  &:after {\n    border: solid ",";\n    border-radius: 5px;\n    border-width: 0 3px 3px 0;\n    content: '';\n    height: 0px;\n    left: 12px;\n    opacity: 1;\n    position: absolute;\n    top: 12px;\n    width: 0px;\n    -webkit-transform: rotate(0deg) scale(0);\n    -ms-transform: rotate(0deg) scale(0);\n    transform: rotate(0deg) scale(0);\n    transition: all 0.3s ease-out;\n    -webkit-transition: all 0.3s ease-out;\n    -moz-transition: all 0.3s ease-out;\n    -ms-transition: all 0.3s ease-out;\n    -o-transition: all 0.3s ease-out;\n  }\n"]);return Nc=function(){return e},e}function Ic(){var e=ke(["\n  clear: both;\n  cursor: pointer;\n  display: block;\n  font-size: 18px;\n  height: 20px;\n  line-height: 20px;\n  margin-right: 10px;\n  position: relative;\n  width: 20px;\n\n  input {\n    cursor: pointer;\n    opacity: 0;\n    position: absolute;\n  }\n\n  input:checked ~ span {\n    background-color: #ffffff;\n    border: 2px solid #4b5871;\n    border-radius: 5px;\n    opacity: 1;\n    -webkit-transform: rotate(0deg) scale(1);\n    -ms-transform: rotate(0deg) scale(1);\n    transform: rotate(0deg) scale(1);\n  }\n\n  input:checked ~ span::after {\n    background-color: transparent;\n    border: solid ",";\n    border-radius: 0;\n    border-width: 0 2px 2px 0;\n    height: 12px;\n    left: 4px;\n    opacity: 1;\n    top: -1px;\n    -webkit-transform: rotate(45deg) scale(1);\n    -ms-transform: rotate(45deg) scale(1);\n    transform: rotate(45deg) scale(1);\n    width: 6px;\n  }\n"]);return Ic=function(){return e},e}function Hc(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n"]);return Hc=function(){return e},e}var Rc=p.div(Hc()),zc=p.label(Ic(),x.th("colorPrimary")),Vc=p.span(Nc(),x.th("colorPrimary")),Lc=p.div(Wc()),Gc=function(e){var t=e.checked,n=e.name,i=e.label,a=e.onChange;return r.createElement(Rc,null,r.createElement(zc,null,r.createElement("input",{defaultChecked:t,id:n,name:n,onChange:a,type:"checkbox"}),r.createElement(Vc,null),r.createElement(Lc,null,i)))};function Jc(){var e=ke(["\n  &:focus {\n    outline: none;\n  }\n"]);return Jc=function(){return e},e}function Fc(){var e=ke(["\n  margin: 3px 0 0 auto;\n\n  svg {\n    box-sizing: unset !important;\n    padding: ",";\n\n    &:hover {\n      background: #f1f5ff;\n    }\n  }\n\n  svg:first-child {\n    margin-right: 20px;\n  }\n"]);return Fc=function(){return e},e}function qc(){var e=ke(["\n  background: white;\n  border: 1px solid ",";\n  color: ",";\n  cursor: pointer;\n  height: 42px;\n  margin-right: 10px;\n  width: 100px;\n"]);return qc=function(){return e},e}function Qc(){var e=ke(["\n  background: ",";\n  border: 1px solid ",";\n  color: white;\n  cursor: pointer;\n  height: 42px;\n  margin-right: 20px;\n  width: 100px;\n"]);return Qc=function(){return e},e}function Yc(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n  margin-top: 62px;\n"]);return Yc=function(){return e},e}function Kc(){var e=ke(["\n  margin-top: 20px;\n"]);return Kc=function(){return e},e}function Uc(){var e=ke(["\n  margin-left: auto;\n"]);return Uc=function(){return e},e}function Zc(){var e=ke(["\n  cursor: pointer;\n  height: 24px;\n  width: 24px;\n"]);return Zc=function(){return e},e}function Xc(){var e=ke(["\n  font-size: 12px;\n  position: absolute;\n  right: 19px;\n  -webkit-text-fill-color: rgba(27, 43, 75, 0.28);\n  top: 69px;\n  z-index: 1;\n"]);return Xc=function(){return e},e}function _c(){var e=ke(["\n  border: none;\n  box-shadow: inset 0 0 0 1px rgba(27, 43, 75, 0.28);\n  display: flex;\n  flex-grow: 1;\n  font-size: 15px;\n  font-weight: 400;\n  padding: ",";\n\n  ::placeholder {\n    color: #d8dae0;\n  }\n\n  &:focus {\n    outline: none;\n  }\n"]);return _c=function(){return e},e}function $c(){var e=ke(["\n  display: flex;\n\n  #search-input {\n    padding: "," "," "," ",";\n  }\n"]);return $c=function(){return e},e}function es(){var e=ke(["\n  color: #4b5871;\n  font-size: 16px;\n  padding: "," "," "," ",";\n"]);return es=function(){return e},e}function ts(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n"]);return ts=function(){return e},e}function ns(){var e=ke(["\n  color: #4b5871;\n  font-size: 16px;\n"]);return ns=function(){return e},e}function rs(){var e=ke(["\n  background: #fff;\n  box-shadow: rgba(9, 30, 66, 0.25) 0px 4px 8px 0px,\n    rgba(9, 30, 66, 0.31) 0px 0px 1px 0px;\n  font-family: ",";\n  font-size: 15px;\n  height: 300px;\n  padding: ",";\n  transform-origin: 50% 50% 0px;\n  width: 400px;\n"]);return rs=function(){return e},e}Gc.defaultProps={checked:!1,label:null};var is,as,os=p.div(rs(),x.th("fontTools"),x.grid(2)),cs=p.span(ns()),ss=p.div(ts()),us=p.div(es(),x.grid(2),x.grid(0),x.grid(2),x.grid(0)),ls=p.div($c(),x.grid(1),x.grid(11),x.grid(1),x.grid(1)),ds=p.input(_c(),x.grid(1)),fs=p.span(Xc()),ps=p(t.Icon)(Zc()),ms=p.div(Uc()),gs=p.div(Kc()),hs=p.div(Yc()),vs=p.button(Qc(),x.th("colorPrimary"),x.th("colorPrimary")),ys=p.button(qc(),x.th("colorPrimary"),x.th("colorPrimary")),ks=p.div(Fc(),x.grid(2)),xs=p.span(Jc()),bs=function(e){var a=e.close,o=e.findNextMatch,s=e.findPreviousMatch,u=e.matchCaseOption,l=e.nonExpandedText,d=e.setMatchCaseValue,f=c.useTranslation(),p=f.t,m=f.i18n,g=n.useContext(t.WaxContext),h=g.app,v=g.pmViews,y=g.activeViewId,k=n.useRef(null),x=n.useRef(null),b=$(n.useState(l),2),w=b[0],E=b[1],C=$(n.useState(u),2),S=C[0],A=C[1],T=$(n.useState([]),2),O=T[0],M=T[1],D=$(n.useState(""),2),j=D[0],B=D[1],P=!i.isEmpty(m)&&m.exists("Wax.FindAndReplace.of")?p("Wax.FindAndReplace.of"):"of",W=$(n.useState("0 ".concat(P," 0")),2),N=W[0],I=W[1],H=h.PmPlugins.get("findAndReplacePlugin"),R=[];i.each(v,(function(e){R.push(e.state)}));var z=t.useDebounce(w,300);n.useEffect((function(){L();var e;e=ec(v,w,S),V(e)}),[z,S,JSON.stringify(R)]);var V=function(e){if(0===e)return I("0 ".concat(P," 0"));I("0 ".concat(P," ").concat(e));var t=v[y].state.selection,n=t.from,r=t.to,i=tc(v,w,S),a=rc(i),o=0;if("main"===y){var c=i.main.filter((function(e){return n===e.from&&r===e.to}));M(c),1===c.length&&I("".concat(a.main.indexOf(n)+1," of ").concat(e))}else{a.main&&(o=a.main.length);for(var s=nc(v.main),u=0;u<s.length;u+=1)if(a[s[u]]&&y!==s[u]&&(o+=a[s[u]].length),a[s[u]]&&y===s[u]){var l=i[s[u]].filter((function(e){return n===e.from&&r===e.to}));M(l),1===l.length&&(o+=a[s[u]].indexOf(n)+1,I("".concat(o," of ").concat(e)));break}}},L=function(){H.props.setSearchText(w),H.props.setSearchMatchCase(S),k.current===document.activeElement&&i.eachRight(v,(function(e){e.dispatch(e.state.tr)}))},G=function(e){var t=e.label;return r.createElement(r.Fragment,null,!i.isEmpty(m)&&m.exists("Wax.FindAndReplace.".concat(t))?p("Wax.FindAndReplace.".concat(t)):t)};return r.createElement(os,null,r.createElement(ss,null,r.createElement(cs,null," ",r.createElement(G,{label:"Find"}),"& ",r.createElement(G,{label:"Replace"})," "),r.createElement(ms,{onClick:function(){H.props.setSearchText(""),i.each(v,(function(e){e.dispatch(e.state.tr)})),a()}},r.createElement(ps,{name:"close"}))),r.createElement(us,null,r.createElement(G,{label:"Find"})),r.createElement(ls,null,r.createElement(ds,{id:"search-input",onChange:function(){E(k.current.value)},placeholder:!i.isEmpty(m)&&m.exists("Wax.FindAndReplace.Something is this doc")?p("Wax.FindAndReplace.Something is this doc"):"Something is this doc",ref:k,type:"text",value:w}),r.createElement(fs,null," ",N," ")),r.createElement(us,null,r.createElement(G,{label:"Replace with"})),r.createElement(ls,null,r.createElement(ds,{onChange:function(){B(x.current.value)},placeholder:!i.isEmpty(m)&&m.exists("Wax.FindAndReplace.Replace text")?p("Wax.FindAndReplace.Replace text"):"Replace text",ref:x,type:"text"})),r.createElement(gs,null,r.createElement(Gc,{checked:u,label:!i.isEmpty(m)&&m.exists("Wax.FindAndReplace.Case Sensitive")?p("Wax.FindAndReplace.Case Sensitive"):"Case Sensitive",name:"case-sensitive",onChange:function(){A(!u),d(!u),k.current.focus()}})),r.createElement(hs,null,r.createElement(vs,{onClick:function(){if(1===O.length){var e=O[0],t=e.from,n=e.to;v[y].dispatch(v[y].state.tr.insertText(j,t,n)),o(w,u)}}}," ",r.createElement(G,{label:"Replace"})),r.createElement(ys,{onClick:function(){i.each(v,(function(e){var n=t.DocumentHelpers.findMatches(e.state.doc,w,u),r=e.state.tr;i.eachRight(n,(function(e){r.insertText(j,e.from,e.to)})),e.dispatch(r)}))}}," ",r.createElement(G,{label:"Replace"})," ",r.createElement(G,{label:"All"})),r.createElement(ks,null,r.createElement(xs,{onClick:function(){return s(w,u)},role:"button",tabIndex:"0"},r.createElement(ps,{name:"navigatePrevious"})),r.createElement(xs,{onClick:function(){return o(w,u)},role:"button",tabIndex:"0"},r.createElement(ps,{name:"navigateNext"})))))},ws=function(e){var i=e.close,a=n.useContext(t.WaxContext),o=a.pmViews,c=a.activeViewId,s=$(n.useState(!1),2),l=s[0],d=s[1],f=$(n.useState(""),2),p=f[0],m=f[1],g=$(n.useState(!1),2),h=g[0],v=g[1],y=function(e){v(e)};n.useEffect((function(){0!==o[c].state.selection.from&&(as=o[c].state.selection,is=c)}),[]);var k=function(e,t){if(o[c].focused||o[c].focus(),0!==ec(o,e,t)){is=c,as=o[c].state.selection;var n=tc(o,e,t),r=rc(n),i=nc(o.main),a=cc(n,o,is);r[is]||(o[a].dispatch(o[a].state.tr.setSelection(new u.TextSelection(o[a].state.tr.doc.resolve(0)))),o[a].focus(),as=o[is=a].state.selection);var s=ic(as.from,r[is]),l=r[is].indexOf(s);as.from<s&&ac(o,is,n,l),as.from>=s&&l<r[is].length-1&&ac(o,is,n,l+1),(as.from===s&&l===r[is].length-1||as.from>=s&&l===r[is].length-1)&&(i.indexOf(is)===i.length-1&&n.main.length>0?(setTimeout((function(){as=o[is=a].state.selection}),50),ac(o,"main",n,0),oc(o,is)):function(e,t,n){for(var r=0;r<e.length;r+=1)if(t[e[r]].length>0&&e[r]!==is){oc(o,is),ac(o,e[r],t,0),as=o[is=n].state.selection;break}}(i,n,a))}},x=function(e,t){if(o[c].focused||o[c].focus(),0!==ec(o,e,t)){is=c,as=o[c].state.selection;var n=tc(o,e,t),r=rc(n),i=nc(o.main),a=sc(n,o,is);r[is]||(o[a].dispatch(o[a].state.tr.setSelection(new u.TextSelection(o[a].state.tr.doc.resolve(o[a].state.doc.content.size)))),o[a].focus(),as=o[is=a].state.selection);var s=ic(as.from,r[is],!1),l=r[is].indexOf(s);if(as.from>s&&ac(o,is,n,l),as.from<=s&&0!==l&&ac(o,is,n,l-1),as.from===s&&0===l)if("main"===is){for(var d=i.length-1;d>=0;d-=1)if(n[i[d]].length>0&&i[d]!==is){ac(o,i[d],n,n[i[d]].length-1),as=o[c].state.selection,oc(o,is=c);break}}else if(i[i.length-1]===c&&i.length>1)for(var f=i.length-1;f>=0;f-=1){if(n[i[f]].length>0&&i[f]!==is){ac(o,i[f],n,n[i[f]].length-1),as=o[c].state.selection,oc(o,is=c);break}console.log("go to main",is)}}};return l?r.createElement(bs,{close:i,findNextMatch:k,findPreviousMatch:x,matchCaseOption:h,nonExpandedText:p,setMatchCaseValue:y}):r.createElement(Pc,{close:i,expand:function(){d(!0)},findNextMatch:k,findPreviousMatch:x,setMatchCaseValue:y,setPreviousSearcValue:function(e){m(e)}})};function Es(){var e=ke(["\n  background: white;\n  margin-top: ",";\n  position: absolute;\n  top: 32px;\n  ","\n"]);return Es=function(){return e},e}function Cs(){var e=ke(["\n  font-size: 0;\n  position: relative;\n  z-index: 2;\n"]);return Cs=function(){return e},e}var Ss,As,Ts,Os,Ms=p.div(Cs()),Ds=p.div(Es(),x.grid(1),x.override("Wax.FindReplaceWrapper")),js=function(e){var a=e.item,o=c.useTranslation(),s=o.t,u=o.i18n,l=n.useContext(t.WaxContext),d=l.activeView,f=l.pmViews.main,p=a.icon,m=a.title,g=n.useRef(),h=$(n.useState(!1),2),v=h[0],y=h[1],k={right:"-190px"},x=$(n.useState(k),2),b=x[0],w=x[1],E=f.props.editable((function(e){return e})),C=function(e){return 70!==e.key&&70!==e.keyCode||!e.metaKey&&!e.ctrlKey||(e.preventDefault(),y(!0),!1)};return n.useEffect((function(){return document.addEventListener("keydown",C),function(){return document.removeEventListener("keydown",C)}}),[]),n.useLayoutEffect((function(){if(w(k),g.current){var e=g.current.getBoundingClientRect().right;if(e>window.window.innerWidth){var t=e-window.window.innerWidth-175;k={right:"".concat(t,"px")},w(k)}}}),[v]),n.useMemo((function(){return r.createElement(Ms,null,r.createElement(t.MenuButton,{active:v,disabled:!1,iconName:p,onMouseDown:function(e){e.preventDefault(),y(!v),d.focus()},title:!i.isEmpty(u)&&u.exists("Wax.FindAndReplace.".concat(m))?s("Wax.FindAndReplace.".concat(m)):m}),v&&r.createElement(Ds,{ref:g,style:b},r.createElement(ws,{close:function(){y(!1),d.focus()}})))}),[v,b,E,s("Wax.FindAndReplace.".concat(m))])},Bs=o.injectable()(Ss=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Find And Replace",e.icon="findAndReplace",e.name="find",e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(js,{item:this.toJSON(),key:s.v4(),view:e}):null}},{key:"enable",get:function(){return function(){return!0}}}]),a}())||Ss,Ps=o.injectable()(As=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("FindAndReplace")(r,void 0,0)||r}())||As,Ws=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("FindAndReplaceTool").to(Ps)}}]),r}(),Ns=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="FindAndReplaceService",e.dependencies=[new Ws],e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("findAndReplacePlugin",new u.Plugin({key:Zo,state:{init:function(){return l.DecorationSet.empty},apply:function(e,n,r,i){var a,o=l.DecorationSet.empty,c=[];return""!==Xo&&(c=t.DocumentHelpers.findMatches(i.doc,Xo,_o)),c.length>0&&(a=c.map((function(e){return l.Decoration.inline(e.from,e.to,{class:"search-result"})})),o=l.DecorationSet.create(i.doc,a)),{createdDecorations:o,allMatches:c}}},props:{decorations:function(e){return(e&&Zo.getState(e)).createdDecorations},setSearchText:function(e){Xo=e},setSearchMatchCase:function(e){_o=e}},view:function(){return{update:function(){}}}}))}},{key:"register",value:function(){this.container.bind("FindAndReplace").to(Bs)}}]),r}(),Is=function(e){var a=e.view,o=void 0===a?{}:a,s=e.item,l=c.useTranslation(),d=l.t,f=l.i18n,p=s.active,m=s.icon,g=s.label,h=s.select,v=s.title,y=n.useContext(t.WaxContext),k=y.activeViewId,x=y.activeView,b=y.options,w=o.state,E=b.fullScreen?"fullScreenExit":m,C=b.fullScreen?"Exit full screen":v,S=p(w,k)&&h(w,k),A=!h(w,k,x);return n.useMemo((function(){return r.createElement(t.MenuButton,{active:!1,disabled:!1,iconName:E,label:g,onMouseDown:function(e){return function(e){e.preventDefault(),Object.assign(b,{fullScreen:!b.fullScreen}),x.dispatch(x.state.tr.setSelection(u.TextSelection.between(x.state.selection.$anchor,x.state.selection.$head))),x.focus()}(e)},title:!i.isEmpty(f)&&f.exists("Wax.Various.".concat(C))?d("Wax.Various.".concat(C)):C})}),[S,A,E,d("Wax.Various.".concat(v))])},Hs=o.injectable()(Ts=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Full screen",e.icon="fullScreen",e.name="FullScreen",e.select=function(){return!0},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Is,{item:this.toJSON(),key:"FullScreen",view:e}):null}},{key:"run",get:function(){return function(){return!0}}},{key:"enable",get:function(){return function(){return!0}}}]),a}())||Ts,Rs=o.injectable()(Os=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("FullScreenTool")(r,void 0,0)||r}())||Os,zs=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("FullScreen").to(Rs)}}]),r}(),Vs=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="FullScreenService",e.dependencies=[new zs],e}return J(r,[{key:"register",value:function(){this.container.bind("FullScreenTool").to(Hs)}}]),r}();function Ls(){var e=ke(["\n  margin: ",";\n  min-width: 25px;\n  height: 25px;\n  display: inline-grid;\n  background: white;\n  cursor: pointer;\n  border: 1px solid ",";\n  border-radius: 50%;\n  &:hover {\n    background: ",";\n  }\n  span {\n    font-size: 16px;\n    text-align: center;\n    padding-top: 3px;\n    color: ",";\n\n    &:hover {\n      color: #fff;\n    }\n  }\n  ","\n"]);return Ls=function(){return e},e}function Gs(){var e=ke(["\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n\n  ","\n"]);return Gs=function(){return e},e}function Js(){var e=ke(["\n  font-size: 17px;\n  color: ",";\n  padding: 0 "," "," ",";\n\n  ","\n"]);return Js=function(){return e},e}function Fs(){var e=ke(["\n  display: flex;\n  flex-direction: column;\n  padding-top: ",";\n\n  ","\n"]);return Fs=function(){return e},e}function qs(){var e=ke(["\n  height: 200px;\n  display: flex;\n  flex-direction: column;\n  overflow-y: scroll;\n  overflow-x: hidden;\n  padding-top: ",";\n\n  ","\n"]);return qs=function(){return e},e}function Qs(){var e=ke(["\n  font-size: 15px;\n  font-weight: 400;\n  border-radius: 2px;\n  border: none;\n  padding: "," "," "," ",";\n  width: 88%;\n  box-shadow: inset 0 0 0 1px rgba(27, 43, 75, 0.28);\n  ::placeholder {\n    color: #d8dae0;\n  }\n  &:focus {\n    outline: none;\n  }\n"]);return Qs=function(){return e},e}function Ys(){var e=ke(["\n  padding: "," "," "," ",";\n"]);return Ys=function(){return e},e}function Ks(){var e=ke(["\n  width: 400px;\n  height: 250px;\n  overflow: hidden;\n  background: #fff;\n  display: flex;\n  flex-direction: column;\n  font-size: 14px;\n  box-shadow: rgba(9, 30, 66, 0.25) 0px 4px 8px 0px,\n    rgba(9, 30, 66, 0.31) 0px 0px 1px 0px;\n  transform-origin: 50% 50% 0px;\n  padding-bottom: ",";\n"]);return Ks=function(){return e},e}var Us=p.div(Ks(),x.grid(2)),Zs=p.div(Ys(),x.grid(2),x.grid(2),x.grid(2),x.grid(2)),Xs=p.input(Qs(),x.grid(1),x.grid(10),x.grid(1),x.grid(1)),_s=p.div(qs(),x.grid(2),x.override("Wax.CharactersListComponent")),$s=p.div(Fs(),x.grid(2),x.override("Wax.SpecialCharactersGroup")),eu=p.div(Js(),x.th("colorPrimary"),x.grid(2),x.grid(2),x.grid(2),x.override("Wax.GroupTitle")),tu=p.div(Gs(),x.override("Wax.GroupCharacters")),nu=p.div(Ls(),x.grid(1),x.th("colorPrimary"),x.th("colorPrimary"),x.th("colorPrimary"),x.override("Wax.SpecialCharacterButton")),ru=function(){var e=c.useTranslation(),a=e.t,o=e.i18n,u=n.useRef(null),l=n.useContext(t.WaxContext),d=l.activeView,f=l.app,p=$(n.useState(""),2),m=p[0],g=p[1],h=$(n.useState(!0),2),v=h[0],y=h[1],k=f.config.get("config.SpecialCharactersService"),x=$(n.useState(k),2),b=x[0],w=x[1],E=n.useCallback(i.debounce((function(){return C()}),300),[m]),C=function(){var e=i.filter(k,(function(e){return!!e.name.toLowerCase().includes(m.toLowerCase())&&e.name}));w(e)};n.useEffect((function(){E(),v&&setTimeout((function(){u.current.focus(),y(!1)}))}),[m,E]);var S;return r.createElement(Us,null,r.createElement(Zs,null,r.createElement(Xs,{onChange:function(){g(u.current.value)},placeholder:!i.isEmpty(o)&&o.exists("Wax.SpecialCharacters.Search")?a("Wax.SpecialCharacters.Search"):"Search",ref:u,type:"text",value:m})),r.createElement(_s,null,(S=[],Object.keys(i.groupBy(b,"group")).forEach((function(e){S.push(r.createElement($s,{key:e},r.createElement(eu,null," ",e," "),r.createElement(tu,null,i.groupBy(b,"group")[e].map((function(e){return r.createElement(nu,{key:s.v4(),onMouseDown:function(){return function(e){var t=d.state,n=d.dispatch,r=t.selection,i=r.from,a=r.to;n(t.tr.insertText(e.unicode,i,a)),setTimeout((function(){d.focus()}))}(e)},title:e.name},r.createElement("span",null,e.unicode))})))))})),r.createElement("div",null,S))))};function iu(){var e=ke(["\n  background: white;\n  margin-top: ",";\n  position: absolute;\n  top: 32px;\n\n  ","\n"]);return iu=function(){return e},e}function au(){var e=ke(["\n  font-size: 0;\n  position: relative;\n  z-index: 2;\n"]);return au=function(){return e},e}var ou,cu,su=p.div(au()),uu=p.div(iu(),x.grid(1),x.override("Wax.SpecialCharacterToolWrapper")),lu=function(e){var a=e.item,o=c.useTranslation(),s=o.t,u=o.i18n,l=n.useContext(t.WaxContext),d=l.activeView,f=l.pmViews.main,p=a.icon,m=a.title,g=$(n.useState(!1),2),h=g[0],v=g[1],y=n.useRef();t.useOnClickOutside(y,(function(){return v(!1)}));var k=!1;return f.props.editable((function(e){return e}))||(k=!0),n.useMemo((function(){return r.createElement(su,{ref:y},r.createElement(t.MenuButton,{active:h,disabled:k,iconName:p,onMouseDown:function(e){e.preventDefault(),v(!h),d.focus()},title:!i.isEmpty(u)&&u.exists("Wax.SpecialCharacters.".concat(m))?s("Wax.SpecialCharacters.".concat(m)):m}),h&&r.createElement(uu,null,r.createElement(ru,{close:function(){v(!1)}})))}),[h,k,s("Wax.SpecialCharacters.".concat(m))])},du=o.injectable()(ou=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Special Characters",e.icon="specialCharacters",e.name="specialCharacters",e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(lu,{item:this.toJSON(),key:s.v4(),view:e}):null}},{key:"enable",get:function(){return function(){return!0}}}]),a}())||ou,fu=o.injectable()(cu=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("SpecialCharactersTool")(r,void 0,0)||r}())||cu,pu=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("SpecialCharacters").to(fu)}}]),r}(),mu=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="SpecialCharactersService",e.dependencies=[new pu],e}return J(r,[{key:"register",value:function(){this.container.bind("SpecialCharactersTool").to(du)}}]),r}(),gu={attrs:{style:{default:null},class:{default:"highlight"}},inclusive:!1,parseDOM:[{tag:"span.highlight",getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class"),style:e.dom.getAttribute("style")}),t()}}],toDOM:function(e,t){e.value=["span",e.node.attrs,0],t()}};function hu(){var e=ke(["\n  border: 1px solid gray;\n  cursor: pointer;\n  display: inline-grid;\n  height: 25px;\n  margin: 5px;\n  min-width: 25px;\n"]);return hu=function(){return e},e}function vu(){var e=ke(["\n  background: white;\n  border: 1px solid gray;\n  display: flex;\n  flex-direction: column;\n"]);return vu=function(){return e},e}function yu(){var e=ke(["\n  background: white;\n  margin-top: ",";\n  position: absolute;\n  top: 32px;\n  width: max-content;\n\n  ","\n"]);return yu=function(){return e},e}function ku(){var e=ke(["\n  font-size: 0;\n  position: relative;\n  z-index: 2;\n"]);return ku=function(){return e},e}var xu,bu,wu=p.div(ku()),Eu=p.div(yu(),x.grid(1),x.override("Wax.HighlightToolWrapper")),Cu=p.div(vu()),Su=p.div(hu()),Au=function(e){var a=e.view,o=a.dispatch,u=a.state,l=e.item,d=l.icon,f=l.title,p=l.select,m=$(n.useState(!1),2),g=m[0],h=m[1],v=c.useTranslation(),y=v.t,k=v.i18n,x=[{name:"yellow",value:"#F3E95C"},{name:"blue",value:"#7DE5DB"},{name:"green",value:"#C0EB96"},{name:"pink",value:"#F2C4D1"},{name:"orange",value:"#FFB56B"},{name:"red",value:"#FF8080"},{name:"remove highlight",value:"transparent"}],b=n.useRef(),w=n.useContext(t.WaxContext),E=w.activeViewId,C=w.activeView,S=w.pmViews.main.props.editable((function(e){return e}));t.useOnClickOutside(b,(function(){return h(!1)}));var A=function(e,t){e.preventDefault(),l.run(C.state,C.dispatch,t),"transparent"!==t&&localStorage.setItem("lastBgColor",t),h(!1)},T=function(){var e=localStorage.getItem("lastBgColor")?localStorage.getItem("lastBgColor"):x[0].value;l.run(u,o,e)},O=!p(u,E,C);S||(O=!0);var M=document.getElementById("trait");return M&&(M.style.fill=null!==localStorage.getItem("lastBgColor")?localStorage.getItem("lastBgColor"):x[0].name),n.useMemo((function(){return r.createElement(wu,{onDoubleClick:T,ref:b},r.createElement("div",{disabled:O},r.createElement(t.MenuButton,{active:g,disabled:O,iconName:d,onMouseDown:function(){h(!g)},title:!i.isEmpty(k)&&k.exists("Wax.Various.".concat(f))?y("Wax.Various.".concat(f)):f})),g&&r.createElement(Eu,null,r.createElement(Cu,{close:function(){h(!1)},item:l,key:s.v4(),view:u},(e=[],Object.keys(x).forEach((function(t){e.push(r.createElement(Su,{"data-style":x[t].value,key:s.v4(),onMouseDown:function(e){return A(e,x[t].value)},style:{backgroundColor:x[t].value},title:x[t].name}))})),r.createElement("div",null,e)))));var e}),[g,O,y("Wax.Various.".concat(f))])},Tu=o.injectable()(xu=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Text Highlighter",e.icon="highlight",e.name="TextHighlightTool",e.select=function(){return 0!==window.getSelection().toString().trim().length},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Au,{item:this.toJSON(),key:s.v4(),view:e}):null}},{key:"run",get:function(){return function(e,t,n){var r=e.selection,i=r.$from,a=r.$to,o="background: linear-gradient(\n                    to bottom,\n                    transparent 0,\n                    transparent 20%,\n                    ".concat(n," 21%,\n                    ").concat(n," 60%,\n                    transparent 61%,\n                    transparent 100%\n                  )");t("transparent"===n?e.tr.removeMark(i.pos,a.pos,e.schema.marks.highlight):e.tr.addMark(i.pos,a.pos,e.schema.marks.highlight.create({style:o})))}}}]),a}())||xu,Ou=o.injectable()(bu=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("TextHighlightTool")(r,void 0,0)||r}())||bu,Mu=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("HighlightToolGroup").to(Ou)}}]),r}(),Du=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=[new Mu],e}return J(r,[{key:"register",value:function(){this.container.bind("TextHighlightTool").to(Tu),this.container.get("CreateMark")({highlight:gu},{toWaxSchema:!0})}}]),r}();function ju(){var e=ke(["\n  color: black;\n  display: block;\n  font-size: 14px;\n  height: 25px;\n  margin: 5px;\n  min-width: 150px;\n\n  /* stylelint-disable-next-line order/properties-alphabetical-order */\n  ","\n"]);return ju=function(){return e},e}function Bu(){var e=ke(["\n  background: #fff;\n  border-radius: 1.03093% / 8%;\n  bottom: 45px;\n  box-shadow: rgb(9 30 66 / 25%) 0px 4px 8px 0px,\n    rgb(9 30 66 / 31%) 0px 0px 1px 0px;\n  display: flex;\n  flex-direction: column;\n  font-size: 14px;\n  padding: calc(4px * 2);\n  position: fixed;\n  right: 31px;\n  transform-origin: 50% 50% 0px;\n\n  /* stylelint-disable-next-line order/properties-alphabetical-order */\n  ","\n"]);return Bu=function(){return e},e}function Pu(){var e=ke(["\n  background: white;\n  margin-top: ",";\n  position: absolute;\n  top: 32px;\n  width: max-content;\n\n  /* stylelint-disable-next-line order/properties-alphabetical-order */\n  ","\n"]);return Pu=function(){return e},e}function Wu(){var e=ke(["\n  font-size: 0;\n  position: relative;\n  z-index: 2;\n\n  button {\n    background: ",";\n    border: ",";\n\n    &:hover {\n      background: ",";\n    }\n    box-shadow: 0px -2px 6px 1px rgba(204, 204, 204, 0.41);\n  }\n\n  &:before {\n    border-bottom: ",";\n\n    border-left: 8px solid transparent;\n    border-right: 8px solid transparent;\n    bottom: 26px;\n    content: '';\n    height: 0;\n    left: 48%;\n    position: relative;\n    width: 0;\n  }\n\n  /* stylelint-disable-next-line order/properties-alphabetical-order */\n  ","\n"]);return Wu=function(){return e},e}var Nu,Iu=p.div(Wu(),(function(e){return e.active?"#535E76":"#fff"}),(function(e){return e.active?"1px solid #535E76":"1px solid #D8DAE0"}),(function(e){return e.active?"#535E76":"#D8DAE0"}),(function(e){return e.active?"8px solid #535E76":"8px solid #D8DAE0"}),x.override("Wax.CounterWrapper")),Hu=p.div(Pu(),x.grid(1),x.override("Wax.CounterDropWrapper")),Ru=p.div(Bu(),x.override("Wax.CounterInfoComponent")),zu=p.div(ju(),x.override("Wax.Counters")),Vu=function(e){var a=e.view.state,o=e.item,s=n.useContext(t.WaxContext),u=s.activeView,l=s.pmViews.main,d=c.useTranslation(),f=d.t,p=d.i18n,m=n.useRef(),g=$(n.useState(0),2),h=g[0],v=g[1],y=$(n.useState(!1),2),k=y[0],x=y[1];t.useOnClickOutside(m,(function(){return x(!1)})),n.useEffect((function(){var e=u.state.selection,t=e.from,n=e.to,r=u.state.doc.textBetween(t,n);v(r.split(" ").filter((function(e){return""!==e})).length)}),[u.state.selection]);return n.useMemo((function(){return r.createElement(Iu,{active:k,ref:m},r.createElement(t.MenuButton,{active:k,disabled:!1,label:"".concat(h," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Word")?f("Wax.Counters.Word"):"Word").concat(h>1?"s":"","\n"),onMouseDown:function(e){e.preventDefault(),x(!k)},title:o.title}),k&&r.createElement(Hu,null,r.createElement(Ru,{close:function(){return x(!1)},item:o,view:a},(e=l.state.doc.textBetween(0,l.state.doc.content.size,void 0," "),n=e.split(""),c=e.split(" ").filter((function(e){return""!==e})).length,s=n.length,u=n.filter((function(e){return" "!==e})).length,d=0,g=0,v=0,y=0,a.doc.descendants((function(e){"paragraph"===e.type.name&&(d+=1),"image"===e.type.name&&(g+=1),e.type.groups.includes("notes")&&(v+=1),"table"===e.type.name&&(y+=1)})),[{name:"".concat(c," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Words")?f("Wax.Counters.Words"):"Words")},{name:"".concat(s," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Characters")?f("Wax.Counters.Characters"):"Characters")},{name:"".concat(u," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Characters Without Space")?f("Wax.Counters.Characters Without Space"):"Characters Without Space")},{name:"".concat(d," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Paragraph")?f("Wax.Counters.Paragraph"):"Paragraph")},{name:"".concat(g," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Images")?f("Wax.Counters.Images"):"Images")},{name:"".concat(y," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Tables")?f("Wax.Counters.Tables"):"Tables")},{name:"".concat(v," ").concat(!i.isEmpty(p)&&p.exists("Wax.Counters.Footnotes")?f("Wax.Counters.Footnotes"):"Footnotes")}]).map((function(e){return r.createElement(zu,{key:e.name,title:e.name},r.createElement("span",null,e.name))})))));var e,n,c,s,u,d,g,v,y}),[h,k])},Lu=o.injectable()(Nu=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Counter Info",e.name="CounterInfo",e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Vu,{item:this.toJSON(),key:"CounterInfo",view:e}):null}},{key:"run",get:function(){return function(){return!0}}},{key:"enable",get:function(){return function(){return!0}}}]),a}())||Nu,Gu=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("CounterInfoTool").to(Lu)}}]),r}();function Ju(){var e=ke(["\n  list-style-type: none;\n  margin: 0;\n  padding: 0;\n\n  li {\n    padding-bottom: 6px;\n\n    span {\n      color: #535e76;\n    }\n  }\n"]);return Ju=function(){return e},e}function Fu(){var e=ke(["\n  font-size: 14px;\n  height: 240px;\n  padding: 4px;\n  width: 250px;\n"]);return Fu=function(){return e},e}function qu(){var e=ke(["\n  background: #fff;\n  border-radius: 1.03093% / 8%;\n  bottom: 45px;\n  box-shadow: rgb(9 30 66 / 25%) 0px 4px 8px 0px,\n    rgb(9 30 66 / 31%) 0px 0px 1px 0px;\n  display: flex;\n  flex-direction: column;\n  font-size: 14px;\n  padding: calc(4px * 2);\n  position: fixed;\n  right: 136px;\n  transform-origin: 50% 50% 0px;\n  width: 260px;\n"]);return qu=function(){return e},e}function Qu(){var e=ke(["\n  background: white;\n  margin-top: ",";\n  position: absolute;\n  top: 32px;\n  width: max-content;\n"]);return Qu=function(){return e},e}function Yu(){var e=ke(["\n  font-size: 0;\n  position: relative;\n  z-index: 2;\n\n  button {\n    background: ",";\n    border: ",";\n\n    &:hover {\n      background: ",";\n    }\n    box-shadow: 0px -2px 6px 1px rgba(204, 204, 204, 0.41);\n  }\n\n  &:before {\n    border-bottom: ",";\n\n    border-left: 8px solid transparent;\n    border-right: 8px solid transparent;\n    bottom: 26px;\n    content: '';\n    height: 0;\n    left: 48%;\n    position: relative;\n    width: 0;\n  }\n"]);return Yu=function(){return e},e}var Ku,Uu,Zu=p.div(Yu(),(function(e){return e.active?"#535E76":"#fff"}),(function(e){return e.active?"1px solid #535E76":"1px solid #D8DAE0"}),(function(e){return e.active?"#535E76":"#D8DAE0"}),(function(e){return e.active?"8px solid #535E76":"8px solid #D8DAE0"})),Xu=p.div(Qu(),x.grid(1)),_u=p.div(qu()),$u=p.div(Fu()),el=p.ul(Ju()),tl=function(e){var a=e.view.state,o=e.item,u=c.useTranslation(),l=u.t,d=u.i18n,f=o.title,p=$(n.useState(!1),2),m=p[0],g=p[1],h=n.useRef();t.useOnClickOutside(h,(function(){return g(!1)}));var v=function(e){var t=e.label,n=e.defaultTrans;return r.createElement(r.Fragment,null,!i.isEmpty(d)&&d.exists(t)?l(t):n)};return n.useMemo((function(){return r.createElement(Zu,{active:m,ref:h},r.createElement(t.MenuButton,{active:m,disabled:!1,label:!i.isEmpty(d)&&d.exists("Wax.ShortCuts.short cuts")?l("Wax.ShortCuts.short cuts"):"short cuts",onMouseDown:function(){g(!m)},title:f}),m&&r.createElement(Xu,null,r.createElement(_u,{close:function(){g(!1)},item:o,key:s.v4(),view:a},r.createElement($u,null,r.createElement(el,null,r.createElement("li",null,r.createElement("span",null,"Ctrl + s ")," :",r.createElement(v,{defaultTrans:"Save changes",label:"Wax.Base.Save changes"})),r.createElement("li",null,r.createElement("span",null,"Ctrl + z ")," :"," ",r.createElement(v,{defaultTrans:"Undo",label:"Wax.Base.Undo"})),r.createElement("li",null,r.createElement("span",null,"Ctrl + Shift + z ")," :"," ",r.createElement(v,{defaultTrans:"Redo",label:"Wax.Base.Redo"})),r.createElement("li",null,r.createElement("span",null,"Shift+Ctrl+8 ")," :"," ",r.createElement(v,{defaultTrans:"Wrap in bullet list",label:"Wax.Annotations.Wrap in bullet list"})," "),r.createElement("li",null,r.createElement("span",null,"Shift+Ctrl+9 ")," :"," ",r.createElement(v,{defaultTrans:"Wrap in ordered list",label:"Wax.Annotations.Wrap in ordered list"})," "),r.createElement("li",null,r.createElement("span",null,"Ctrl-] ")," :"," ",r.createElement(v,{defaultTrans:"Indent list item",label:"Wax.ShortCuts.Indent list item"})," "),r.createElement("li",null,r.createElement("span",null,"Ctrl-[ ")," :"," ",r.createElement(v,{defaultTrans:"Lift list item",label:"Wax.ShortCuts.Lift list item"})," "),r.createElement("li",null,r.createElement("span",null,"Ctrl or Shift + Enter ")," :"," ",r.createElement(v,{defaultTrans:"Soft break",label:"Wax.ShortCuts.Soft break"})," "),r.createElement("li",null,r.createElement("span",null,"Ctrl + f ")," :"," ",r.createElement(v,{defaultTrans:"Find And Replace",label:"Wax.FindAndReplace.Find And Replace"})," "),r.createElement("li",null,r.createElement("span",null,"Shift + Enter ")," :"," ",r.createElement(v,{defaultTrans:"Exit code block",label:"Wax.ShortCuts.Exit code block"})," "))))))}),[m,l("Wax.ShortCuts.short cuts")])},nl=o.injectable()(Ku=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="ShortCuts Info",e.name="ShortCutsInfo",e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(tl,{item:this.toJSON(),key:"ShortCutsInfo",view:e}):null}},{key:"run",get:function(){return function(){return!0}}},{key:"enable",get:function(){return function(){return!0}}}]),a}())||Ku,rl=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("ShortCutsInfoTool").to(nl)}}]),r}(),il=o.injectable()(Uu=function(e){I(r,t.ToolGroup);var n=L(r);function r(e,t){var i;return W(this,r),(i=n.call(this)).tools=[],i.tools=[t,e],i}return r=o.inject("ShortCutsInfoTool")(r,void 0,1)||r,r=o.inject("CounterInfoTool")(r,void 0,0)||r}())||Uu,al=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="EditorInfoToolGroupService",e}return J(r,[{key:"register",value:function(){this.container.bind("InfoToolGroup").to(il)}}]),r}(),ol=[new Gu,new rl,new al],cl=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=ol,e}return r}();function sl(){var e=ke(["\n  height: 24px;\n  width: 24px;\n"]);return sl=function(){return e},e}function ul(){var e=ke(["\n  cursor: pointer;\n  display: inline-grid;\n  height: 25px;\n  margin: 5px 10px;\n  min-width: 25px;\n"]);return ul=function(){return e},e}function ll(){var e=ke(["\n  background: white;\n  border: 1px solid gray;\n  display: flex;\n  flex-direction: column;\n"]);return ll=function(){return e},e}function dl(){var e=ke(["\n  background: white;\n  margin-top: ",";\n  position: absolute;\n  top: 32px;\n  width: max-content;\n\n  ","\n"]);return dl=function(){return e},e}function fl(){var e=ke(["\n  font-size: 0;\n  position: relative;\n  z-index: 2;\n"]);return fl=function(){return e},e}var pl,ml=p.div(fl()),gl=p.div(dl(),x.grid(1),x.override("Wax.TransformToolWrapper")),hl=p.div(ll()),vl=p.div(ul()),yl=p(t.Icon)(sl()),kl=function(e){var a=e.view.state,o=e.item,u=o.icon,l=o.title,d=o.select,f=$(n.useState(!1),2),p=f[0],m=f[1],g=n.useRef(),h=n.useContext(t.WaxContext),v=h.activeViewId,y=h.activeView,k=h.pmViews.main.props.editable((function(e){return e})),x=!d(a,v,y);k||(x=!0),t.useOnClickOutside(g,(function(){return m(!1)}));var b=c.useTranslation(),w=b.t,E=b.i18n,C=function(e,t){return!i.isEmpty(E)&&E.exists(e)?w(e):t},S=[{id:1,name:C("Wax.TransformCase.Upper Case","Upper Case"),iconName:"transformCase"},{id:2,name:C("Wax.TransformCase.Lower Case","Lower Case"),iconName:"lowerCaseTransform"},{id:3,name:C("Wax.TransformCase.Sentence Case","Sentence Case"),iconName:"transformCase"}],A=function(){return r.createElement("div",null,S.map((function(e){return r.createElement(vl,{key:s.v4(),onClick:function(t){return function(e,t){switch(t){case 1:o.run(y.state,y.dispatch,"upperCase");break;case 2:o.run(y.state,y.dispatch,"lowerCase");break;case 3:o.run(y.state,y.dispatch,"sentenceCase")}m(!1)}(0,e.id)},title:e.name},r.createElement(yl,{name:e.iconName}))})))};return n.useMemo((function(){return r.createElement(ml,{ref:g},r.createElement(t.MenuButton,{active:p,disabled:x,iconName:u,onMouseDown:function(){m(!p)},title:!i.isEmpty(E)&&E.exists("Wax.TransformCase.".concat(l))?w("Wax.TransformCase.".concat(l)):l}),p&&r.createElement(gl,null,r.createElement(hl,{close:function(){m(!1)},item:o,key:s.v4(),view:a},A())))}),[p,x,w("Wax.TransformCase.".concat(l))])},xl=function(e,n,r){var i=e.tr,a=i.selection,o=[];e.doc.nodesBetween(a.from,a.to,(function(n,c){if(n.marks.length>0&&n.marks.forEach((function(n){o.push({name:n.type.name,type:n.type,pos:t.DocumentHelpers.findMark(e,n.type,!0),attrs:n.attrs})})),n.isTextblock&&a.from!==a.to){var s=Math.max(c+1,a.from),u=Math.min(c+n.nodeSize,a.to),l=Math.max(0,a.from-c-1),d=Math.max(0,a.to-c-1),f=n.textBetween(l,d),p="upperCase"===r?e.schema.text(f.toUpperCase()):e.schema.text(f.toLocaleLowerCase());i=i.replaceWith(s,u,p)}})),o.forEach((function(e){e.pos.forEach((function(t){i.addMark(t.from,t.to,e.type.create(e.attrs))}))})),n(i.scrollIntoView())},bl=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Transform",e.icon="transformCase",e.name="TransformTool",e.select=function(e,t,n){return!n.state.selection.empty},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(kl,{item:this.toJSON(),key:s.v4(),view:e}):null}},{key:"run",get:function(){return function(e,n,r){var i=e.selection,a=i.$from,o=i.$to,c=e.tr,s=e.tr.selection,u=[];switch(r){case"upperCase":xl(e,n,"upperCase");break;case"lowerCase":xl(e,n,"lowerCase");break;case"sentenceCase":e.doc.nodesBetween(a.pos,o.pos,(function(n,r){if(n.marks.length>0&&n.marks.forEach((function(n){u.push({name:n.type.name,type:n.type,pos:t.DocumentHelpers.findMark(e,n.type,!0),attrs:n.attrs})})),"code_block"!==n.type.name){if(!n.isTextblock||a.pos===o.pos)return;var i=Math.max(r+1,a.pos),l=Math.min(r+n.nodeSize,s.to),d=Math.max(0,a.pos-r-1),f=Math.max(0,s.to-r-1),p=n.textBetween(d,f);if(p.length>0){var m=e.schema.text(p.replace(/(^\w{1}|\.\s*\w{1})/gi,(function(e){return e.toUpperCase()})));c.replaceWith(i,l,m)}}})),u.forEach((function(e){e.pos.forEach((function(t){c.addMark(t.from,t.to,e.type.create(e.attrs))}))})),n(c)}}}}]),a}(),wl=o.injectable()(pl=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("TransformTool")(r,void 0,0)||r}())||pl,El=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("TransformToolGroup").to(wl)}}]),r}(),Cl=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=[new El],e}return J(r,[{key:"register",value:function(){this.container.bind("TransformTool").to(bl)}}]),r}();function Sl(){var e=ke(["\n  height: 16px;\n  margin-right: 5px;\n  width: 16px;\n"]);return Sl=function(){return e},e}function Al(){var e=ke(["\n  display: inline-flex;\n  opacity: ",";\n\n  .Dropdown-control {\n    border: none;\n    cursor: ",";\n    pointer-events: ",";\n\n    &:hover {\n      box-shadow: none;\n    }\n  }\n\n  .Dropdown-arrow {\n    right: 25px;\n    top: 14px;\n  }\n\n  .Dropdown-menu {\n    align-items: flex-start;\n    display: flex;\n    flex-direction: column;\n    width: 120%;\n\n    .Dropdown-option {\n      width: 100%;\n    }\n  }\n"]);return Al=function(){return e},e}function Tl(){var e=ke(["\n  ",";\n"]);return Tl=function(){return e},e}var Ol,Ml=p.span(Tl(),t.ReactDropDownStyles),Dl=p(D)(Al(),(function(e){return e.select?1:.4}),(function(e){return e.select?"pointer":"not-allowed"}),(function(e){return e.select?"default":"none"})),jl=p(t.Icon)(Sl()),Bl=function(e){var a=e.view,o=(a.dispatch,a.state,e.item,n.useContext(t.WaxContext)),s=o.app,u=o.activeView,l=o.pmViews,d=c.useTranslation(),f=d.t,p=d.i18n,m=s.config.get("config.EnableTrackChangeService")?s.config.get("config.EnableTrackChangeService"):{toggle:!1},g=m.toggle,h=l.main.props.editable((function(e){return e})),v=function(){return r.createElement("span",null,r.createElement(jl,{name:"editing"}),!i.isEmpty(p)&&p.exists("Wax.TrackChanges.Editing")?f("Wax.TrackChanges.Editing"):"Editing")},y=function(){return r.createElement("span",null,r.createElement(jl,{name:"suggesting"}),!i.isEmpty(p)&&p.exists("Wax.TrackChanges.Suggesting")?f("Wax.TrackChanges.Suggesting"):"Suggesting")},k=function(){return r.createElement("span",null,r.createElement(jl,{name:"viewing"}),!i.isEmpty(p)&&p.exists("Wax.TrackChanges.Viewing")?f("Wax.TrackChanges.Viewing"):"Viewing")},x=[{label:r.createElement(v,null),value:"editing"},{label:r.createElement(y,null),value:"suggesting"}],b=n.useMemo((function(){return r.createElement(Ml,null,r.createElement(Dl,{onChange:function(e){return m.enabled=!m.enabled,m.updateTrackStatus&&m.updateTrackStatus(m.enabled),void setTimeout((function(){u.focus()}),100)},options:x,select:g,value:m.enabled?x[1]:x[0]}))}),[f("Wax.TrackChanges.Editing")]);return h?b:r.createElement(k,null)},Pl=o.injectable()(Ol=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="",e.label="",e.name="EditingSuggesting",e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:this.isDisplayed()?r.createElement(Bl,{enabled:this.config.enabled,item:this.toJSON(),key:s.v4(),view:e}):null}},{key:"run",get:function(){return function(){return!0}}},{key:"enable",get:function(){return function(){return!0}}}]),a}())||Ol,Wl=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="EditingSuggestingService",e}return J(r,[{key:"register",value:function(){this.container.bind("EditingSuggesting").to(Pl)}}]),r}();function Nl(){var e=ke(["\n  cursor: pointer;\n  width: 100%;\n"]);return Nl=function(){return e},e}function Il(){var e=ke(["\n  color: #006f19;\n  width: 90%;\n"]);return Il=function(){return e},e}function Hl(){var e=ke(["\n  display: flex;\n  justify-content: space-between;\n"]);return Hl=function(){return e},e}function Rl(){var e=ke(["\n  margin: 5px 7px 7px 0px;\n  padding: 2px 3px;\n"]);return Rl=function(){return e},e}function zl(){var e=ke(["\n  background: ",";\n  color: #fff;\n  cursor: pointer;\n  margin-right: 10px;\n"]);return zl=function(){return e},e}function Vl(){var e=ke(["\n  display: inline-block;\n"]);return Vl=function(){return e},e}function Ll(){var e=ke(["\n  outline: none;\n  width: calc(100% - 8px);\n\n  :focus {\n    outline: none;\n  }\n"]);return Ll=function(){return e},e}function Gl(){var e=ke(["\n  color: #4b5871;\n  display: block;\n  font-size: 16px;\n"]);return Gl=function(){return e},e}function Jl(){var e=ke(["\n  display: inline-block;\n  margin-right: 12px;\n  width: 200px;\n"]);return Jl=function(){return e},e}function Fl(){var e=ke(["\n  background: #fff;\n  border-radius: 1.03093% / 8%;\n  box-shadow: rgba(9, 30, 66, 0.25) 0px 4px 8px 0px,\n    rgba(9, 30, 66, 0.31) 0px 0px 1px 0px;\n  padding: "," "," "," ",";\n  transform-origin: 50% 50% 0px;\n"]);return Fl=function(){return e},e}function ql(){var e=ke(["\n  cursor: pointer;\n  height: 10px;\n  width: 10px;\n"]);return ql=function(){return e},e}var Ql=p(t.Icon)(ql()),Yl=p.div(Fl(),x.grid(2),x.grid(1),x.grid(2),x.grid(2)),Kl=p.div(Jl()),Ul=p.div(Gl()),Zl=p.input(Ll()),Xl=p.div(Vl()),_l=p.button(zl(),x.th("colorPrimary")),$l=p.div(Rl()),ed=p.div(Hl()),td=p.div(Il()),nd=p.div(Nl()),rd=[],id=function(e){var i=e.mark,a=n.useRef(null),o=$(n.useState(""),2),c=o[0],u=o[1],l=$(n.useState(JSON.parse(localStorage.getItem("isInline"))),2),d=l[0],f=l[1],p=n.useContext(t.WaxContext),m=p.app,g=p.pmViews.main,h=g.state,v=g.dispatch,y=h.selection,k=y.$from,x=y.$to,b=m.config.get("config.CustomTagService"),w=b&&b.tags?b.tags:rd,E=b&&b.updateTags?b.updateTags:function(){return!0},C=$(n.useState(w),2),S=C[0],A=C[1],T=!1;h.doc.nodesBetween(k.pos,x.pos,(function(e){"image"===e.type.name&&(T=!0)}));var O=function(){""!==c.trim()&&(w.push({label:c,tagType:"inline"}),A(w),E({label:c,tagType:"inline"}),u(""),a.current&&a.current.focus(),u(""))};n.useEffect((function(){f(JSON.parse(localStorage.getItem("isInline")))}),[]);var M=S.filter((function(e){return"inline"===e.tagType})),D=k.pos===x.pos?{cursor:"default",opacity:"0.4",pointerEvents:"none"}:{};return!0!==d||T?null:r.createElement(Yl,null,r.createElement(Ul,null,"Custom Inline"),M.map((function(e){return r.createElement($l,{key:s.v4()},r.createElement(ed,null,i&&i.attrs.tags.includes(e.label)?r.createElement(td,null,e.label):r.createElement(nd,{onMouseDown:function(){return function(e){var t=i?i.attrs.tags:[];t.push(e),v(h.tr.addMark(k.pos,x.pos,h.schema.marks.customTagInline.create(de(de({},i&&i.attrs||{}),{},{tags:t,class:t.toString().replace(/ /g,"-").toLowerCase()}))))}(e.label)},style:D},e.label),i&&i.attrs.tags.map((function(t){return r.createElement(n.Fragment,{key:s.v4()},t===e.label?r.createElement("span",{"aria-hidden":"true",onClick:function(){return function(e){var t=i.attrs.tags;if(1===t.length)v(h.tr.removeMark(i.from,i.to,h.schema.marks.customTagInline));else{var n=t.indexOf(e);n>-1&&(t.splice(n,1),v(h.tr.addMark(i.from,i.to,h.schema.marks.customTagInline.create(de(de({},i&&i.attrs||{}),{},{tags:t,class:t.toString().replace(/ /g,"-").toLowerCase()})))))}}(e.label)},role:"button"},r.createElement(Ql,{name:"removeTag"})):null)}))))})),r.createElement(Kl,null,r.createElement(Zl,{onChange:function(){u(a.current.value)},onKeyPress:function(e){"Enter"!==e.key&&13!==e.which||O()},ref:a,type:"text",value:c})),r.createElement(Xl,null,r.createElement(_l,{onClick:O,type:"button"},"Add")))},ad={attrs:{class:{default:null},tags:[],type:{default:"inline"}},inclusive:!1,parseDOM:[{tag:'span[data-type="inline"]',getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class"),tags:JSON.parse(e.dom.dataset.tags),type:e.dom.dataset.type}),t()}}],toDOM:function(e,t){e.value=["span",{class:e.node.attrs.class,"data-type":e.node.attrs.type,"data-tags":JSON.stringify(e.node.attrs.tags)}],t()}};function od(){var e=ke(["\n  svg {\n    height: 15px;\n    width: 17px;\n  }\n"]);return od=function(){return e},e}var cd,sd,ud,ld,dd,fd,pd,md,gd,hd,vd=p(t.MenuButton)(od()),yd=function(e){var i=e.item,a=i.icon,o=i.title,c=JSON.parse(localStorage.getItem("isInline")),s=$(n.useState(!(null===c||!1===c)),2),u=s[0],l=s[1],d=n.useContext(t.WaxContext).pmViews.main,f=!1;d.props.editable((function(e){return e}))||(f=!0);var p=function(){l(!0!==u),localStorage.setItem("isInline",!0!==u)};return n.useMemo((function(){return r.createElement(vd,{active:u,disabled:f,iconName:a,onMouseDown:p,title:o})}),[u,f])},kd=function(e){I(i,t.Tools);var n=L(i);function i(){var e;W(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=n.call.apply(n,[this].concat(r))).title="Custom Tag Inline",e.icon="cutomInline",e.name="CustomTagInline",e}return J(i,[{key:"renderTool",value:function(e){return r.createElement(yd,{item:this.toJSON(),key:s.v4(),view:e})}}]),i}(),xd=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"boot",value:function(){this.container.get("CreateOverlay")(id,{},{nodeType:"",markType:"customTagInline",followCursor:!1,selection:!0})}},{key:"register",value:function(){this.container.bind("CustomTagInlineTool").to(kd),this.container.get("CreateMark")({customTagInline:ad},{toWaxSchema:!0})}}]),r}(),bd={content:"inline*",group:"block",priority:0,defining:!0,attrs:{class:{default:""},type:{default:"block"}},parseDOM:[{tag:'p[data-type="block"]',getAttrs:function(e,t){Object.assign(e,{class:e.dom.getAttribute("class"),type:e.dom.dataset.type}),t()}}],toDOM:function(e,t){var n={class:e.node.attrs.class,"data-type":e.node.attrs.type};e.value=["p",n,0],t()}},wd=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="Custom Tag Block",e.name="CustomTagBlock",e.select=function(e,t){return"main"===t},e}return J(r,[{key:"run",get:function(){return function(e,n,r){t.Commands.setBlockType(e.config.schema.nodes.customTagBlock,{class:r.replace(/ /g,"-").toLowerCase()})(e,n)}}},{key:"active",get:function(){return function(e,n,r,i){var a=t.Commands.customTagBlockActive(e.config.schema.nodes.customTagBlock,{class:r})(e),o=i.filter((function(e){return"block"===e.tagType})),c={};return o.forEach((function(e){a&&r===e.label.replace(/ /g,"-").toLowerCase()?c[e.label]=!0:c[e.label]=!1})),c}}}]),r}(),Ed=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("CustomTagBlockTool").to(wd),this.container.get("CreateNode")({customTagBlock:bd},{toWaxSchema:!0})}}]),r}(),Cd=o.injectable()(cd=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.title="Custom Block",t.tools=[e],t}return r=o.inject("CustomTagBlockTool")(r,void 0,0)||r}())||cd,Sd=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("CustomTagBlockToolGroup").to(Cd)}}]),r}(),Ad=o.injectable()(sd=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("CustomTagInlineTool")(r,void 0,0)||r}())||sd,Td=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("CustomTagInline").to(Ad)}}]),r}(),Od=[new Ed,new xd,new Sd,new Td],Md=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=Od,e}return r}(),Dd=new u.PluginKey("getContentOnEnterPlugin"),jd=function(e){return new u.Plugin({key:Dd,state:{init:function(){},apply:function(){}},props:{handleKeyDown:function(t,n){var r=!1;if("Enter"===n.key&&!n.shiftKey){if(t.state.doc.content.size<=2)return!0;var i=t.state,a=i.selection,o=a.from,c=a.to,s=i.config,l=s.schema,d=s.plugins,f=i.doc.content;if(t.state.doc.nodesBetween(o,c,(function(e){"list_item"===e.type.name&&(r=!0)})),!r){var p=function(e){var t=h.DOMSerializer.fromSchema(e);return function(e){var n=document.createElement("article");return n.appendChild(t.serializeFragment(e)),n.innerHTML}}(l);e.getContentOnEnter(p(f));var m={doc:function(e){var t=h.DOMParser.fromSchema(e);return function(e){var n=document.createElement("article");return n.innerHTML=e,t.parse(n)}}(l)(""),schema:l,plugins:d};return t.updateState(u.EditorState.create(m)),t.dispatch&&t.dispatch(t.state.tr.setMeta("addToHistory",!1)),!0}}return!1}}})},Bd=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="EnterService",e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("getContentOnEnterPlugin",jd(this.config))}}]),r}(),Pd={oen_container:{content:"block+",group:"block",attrs:{id:{default:""},class:{default:""},type:{default:"content_structure_element"}},defining:!0,parseDOM:[{tag:'div[data-type="content_structure_element"]',getAttrs:function(e){return{id:e.getAttribute("id"),class:e.getAttribute("class"),type:e.dataset.type}}}],toDOM:function(e){return["div",{id:e.attrs.id,class:e.attrs.class,"data-type":e.attrs.type},0]}},oen_section:{content:"block+",group:"block",attrs:{id:{default:""},class:{default:"section"}},defining:!0,parseDOM:[{tag:"section",getAttrs:function(e){return{id:e.getAttribute("id"),class:e.getAttribute("class"),type:e.dataset.group}}}],toDOM:function(e){return["section",e.attrs,0]}},oen_aside:{content:"block+",group:"block",attrs:{id:{default:""},class:{default:""}},defining:!0,parseDOM:[{tag:"aside",getAttrs:function(e){return{id:e.getAttribute("id"),class:e.getAttribute("class")}}}],toDOM:function(e){return["aside",{id:e.attrs.id,class:e.attrs.class},0]}}},Wd=o.injectable()(ud=function(e){I(r,t.Tools);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).title="",e.icon="",e.name="OENContainersTool",e.select=function(e,t){return"main"===t},e}return J(r,[{key:"run",get:function(){return function(e,t,n){}}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e,t){var n=e.selection,r=n.from,i=n.to,a={};return e.doc.nodesBetween(r,i,(function(e,n){"oen_container"!==e.type.name&&"oen_section"!==e.type.name||t.forEach((function(t){t.items.forEach((function(t){t.className===e.attrs.class&&(a[t.className]=!0)}))}))})),a}}}]),r}())||ud,Nd=function(e){var i=e.view,a=void 0===i?{}:i,o=e.item,c=e.type,u=o.active,l=o.icon,d=o.label,f=o.select,p=o.title,g=n.useContext(t.WaxContext),h=g.pmViews.main,v=g.activeViewId,k=g.activeView,x=a.state,b=!!u(x,v),w=!f(x,v,k);return h.props.editable((function(e){return e}))||(w=!0),n.useMemo((function(){return r.createElement(t.MenuButton,{active:b||!1,disabled:w,iconName:l,label:d,onMouseDown:function(e){return function(e){e.preventDefault();var t=h.state.selection,n=t.from,r=t.to,i=!1;if(h.state.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&(i=!0)})),i){var a=h.state.selection.$from.blockRange(h.state.selection.$to),o=a&&y.liftTarget(a);if(null==o)return!1;h.dispatch(h.state.tr.lift(a,o))}return m.wrapIn(h.state.config.schema.nodes.oen_aside,{class:c,id:s.v4()})(h.state,h.dispatch),setTimeout((function(){h.focus()})),!0}(e)},title:p})}),[b,w])},Id=o.injectable()(ld=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="long",e.label="Case Study",e.name="OENAsideLongToolCaseStudy",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:r.createElement(Nd,{item:this.toJSON(),key:s.v4(),type:"long case-study",view:e})}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.from,r=t.to,i=!1;return e.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&e.attrs.class.includes("case-study")&&(i=!0)})),i}}}]),a}())||ld,Hd=o.injectable()(dd=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="long",e.label="Biography",e.name="OENAsideLongToolBiography",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:r.createElement(Nd,{item:this.toJSON(),key:s.v4(),type:"long biography",view:e})}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.from,r=t.to,i=!1;return e.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&e.attrs.class.includes("biography")&&(i=!0)})),i}}}]),a}())||dd,Rd=o.injectable()(fd=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="long",e.label="Worked Example",e.name="OENAsideLongToolWorkedExample",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:r.createElement(Nd,{item:this.toJSON(),key:s.v4(),type:"long worked-example",view:e})}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.from,r=t.to,i=!1;return e.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&e.attrs.class.includes("worked-example")&&(i=!0)})),i}}}]),a}())||fd,zd=o.injectable()(pd=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Note",e.label="Note",e.name="OENAsideShortToolNote",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:r.createElement(Nd,{item:this.toJSON(),key:s.v4(),type:"short note",view:e})}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.from,r=t.to,i=!1;return e.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&e.attrs.class.includes("note")&&(i=!0)})),i}}}]),a}())||pd,Vd=o.injectable()(md=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Tip",e.label="Tip",e.name="OENAsideShortToolTip",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:r.createElement(Nd,{item:this.toJSON(),key:s.v4(),type:"short tip",view:e})}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.from,r=t.to,i=!1;return e.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&e.attrs.class.includes("tip")&&(i=!0)})),i}}}]),a}())||md,Ld=o.injectable()(gd=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Warning",e.label="Warning",e.name="OENAsideShortToolWarning",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:r.createElement(Nd,{item:this.toJSON(),key:s.v4(),type:"short warning",view:e})}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.from,r=t.to,i=!1;return e.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&e.attrs.class.includes("warning")&&(i=!0)})),i}}}]),a}())||gd,Gd=o.injectable()(hd=function(e){I(a,t.Tools);var n=L(a);function a(){var e;W(this,a);for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return(e=n.call.apply(n,[this].concat(r))).title="Reminder",e.label="Reminder",e.name="OENAsideShortToolReminder",e.select=function(e,t){return"main"===t},e}return J(a,[{key:"renderTool",value:function(e){return i.isEmpty(e)?null:r.createElement(Nd,{item:this.toJSON(),key:s.v4(),type:"short reminder",view:e})}},{key:"enable",get:function(){return function(e){return!0}}},{key:"active",get:function(){return function(e){var t=e.selection,n=t.from,r=t.to,i=!1;return e.doc.nodesBetween(n,r,(function(e){"oen_aside"===e.type.name&&e.attrs.class.includes("reminder")&&(i=!0)})),i}}}]),a}())||hd;function Jd(){var e=ke(["\n  cursor: pointer;\n  position: relative;\n  height: 23px;\n  width: 23px;\n  bottom: 5px;\n"]);return Jd=function(){return e},e}function Fd(){var e=ke(["\n  cursor: pointer;\n"]);return Fd=function(){return e},e}var qd,Qd=p.span(Fd()),Yd=p(t.Icon)(Jd()),Kd=function(e){var i=e.setPosition,a=e.position,o=n.useContext(t.WaxContext),c=o.activeView,s=o.pmViews.main,l=!s.props.editable((function(e){return e}));n.useLayoutEffect((function(){var e=document.getElementsByClassName("outline")[0].getBoundingClientRect(),t=c.dom.getBoundingClientRect(),n=e.width,r=e.top-t.top+18;i(de(de({},a),{},{left:n,top:r}))}),[a.left]);if(!l)return r.createElement(Qd,{onClick:function(){var e,t,n=s.state,r=n.tr,i=n.selection,a=i.from,o=i.to,c=n.doc,l=[],d={};c.descendants((function(e){"oen_section"===e.type.name&&l.push(e)})),l.forEach((function(e,t){e.content.content.forEach((function(e){"heading2"===e.type.name?d[t]=e.textContent:d[t]||(d[t]="untitled")}))}));var f="<ul>";Object.keys(d).forEach((function(e){f+="<li>".concat(d[e],"</li>")})),f+="</ul>",s.state.doc.nodesBetween(a,o,(function(n,r){"oen_container"===n.type.name&&(e=n,t=r)}));var p,m=h.DOMParser.fromSchema(s.state.config.schema).parse((p="<body>".concat(f,"</body>"),(new window.DOMParser).parseFromString(p,"text/html").body));r.replaceWith(t+1,t+e.content.size,m),function(e,t,n){var r=e.steps.length-1;if(!(r<t)){var i=e.steps[r];if(i instanceof y.ReplaceStep||i instanceof y.ReplaceAroundStep){var a=e.mapping.maps[r],o=0;a.forEach((function(e,t,n,r){0===o&&(o=r)})),e.setSelection(u.Selection.near(e.doc.resolve(o),n))}}}(r,r.steps.length-1,-1),s.dispatch(r)},type:"button"},r.createElement(Yd,{name:"refresh"}))};function Ud(){var e=ke(["\n  background: khaki;\n  height: 100%;\n"]);return Ud=function(){return e},e}var Zd,Xd,_d,$d,ef,tf=p.div(Ud()),nf=o.injectable()(qd=function(e){I(c,t.ToolGroup);var a=L(c);function c(e,t,n,r,i,o){var s;return W(this,c),(s=a.call(this)).tools=[],s.toolGroups=[],s.toolGroups=[{name:"TabA",groups:[e,t,n,r,i,o]}],s}return c=o.inject("CustomTagBlockToolGroup")(c,void 0,5)||c,c=o.inject("Text")(c,void 0,4)||c,c=o.inject("Display")(c,void 0,3)||c,c=o.inject("OENAsideLongToolGroup")(c,void 0,2)||c,c=o.inject("OENAsideShortToolGroup")(c,void 0,1)||c,J(c=o.inject("OENContainersToolGroup")(c,void 0,0)||c,[{key:"renderTools",value:function(e){if(i.isEmpty(e))return null;var a=[{id:"1",title:"block level tools",icon:"title",disabled:!1,component:r.createElement(t.BlockLevelTools,{groups:this._toolGroups[0].groups.map((function(e){return{groupName:"Custom Block"===e.title||"OEN Containers"===e.title?e.title:e.title.props.title,items:e._tools}})),view:e})},{id:"2",disabled:!0,title:"chapter list",icon:"chapterList",component:r.createElement(tf,null)}];return n.useMemo((function(){return r.createElement(t.Tabs,{key:s.v4(),tabList:a})}),[])}}]),c}())||qd,rf=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("OENTools").to(nf)}}]),r}(),af=o.injectable()(Zd=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.title="OEN Containers",t.tools=[e],t}return r=o.inject("OENContainersTool")(r,void 0,0)||r}())||Zd,of=o.injectable()(Xd=function(e){I(i,t.ToolGroup);var n=L(i);function i(e,a,o,c){var s;return W(this,i),(s=n.call(this)).tools=[],s.title=r.createElement(t.LeftMenuTitle,{title:"Short Boxes"}),s.tools=[e,a,o,c],s}return i=o.inject("OENAsideShortToolReminder")(i,void 0,3)||i,i=o.inject("OENAsideShortToolWarning")(i,void 0,2)||i,i=o.inject("OENAsideShortToolTip")(i,void 0,1)||i,i=o.inject("OENAsideShortToolNote")(i,void 0,0)||i}())||Xd,cf=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("OENAsideShortToolGroup").to(of)}}]),r}(),sf=o.injectable()(_d=function(e){I(i,t.ToolGroup);var n=L(i);function i(e,a,o){var c;return W(this,i),(c=n.call(this)).tools=[],c.title=r.createElement(t.LeftMenuTitle,{title:"Long Boxes"}),c.tools=[e,a,o],c}return i=o.inject("OENAsideLongToolWorkedExample")(i,void 0,2)||i,i=o.inject("OENAsideLongToolBiography")(i,void 0,1)||i,i=o.inject("OENAsideLongToolCaseStudy")(i,void 0,0)||i}())||_d,uf=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("OENAsideLongToolGroup").to(sf)}}]),r}(),lf=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).dependencies=[new cf,new uf],e}return J(r,[{key:"register",value:function(){this.container.bind("OENContainersToolGroup").to(af)}}]),r}(),df=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="OENContainersService",e.dependencies=[new rf,new lf],e}return J(r,[{key:"register",value:function(){this.container.bind("OENContainersTool").to(Wd),this.container.bind("OENAsideLongToolCaseStudy").to(Id),this.container.bind("OENAsideLongToolBiography").to(Hd),this.container.bind("OENAsideLongToolWorkedExample").to(Rd),this.container.bind("OENAsideShortToolNote").to(zd),this.container.bind("OENAsideShortToolTip").to(Vd),this.container.bind("OENAsideShortToolWarning").to(Ld),this.container.bind("OENAsideShortToolReminder").to(Gd);var e=this.container.get("CreateNode");Object.keys(Pd).forEach((function(t){e(ue({},t,Pd[t]))})),this.container.get("CreateOverlay")(Kd,{},{nodeType:"oen_container",findInParent:!0,markType:"",followCursor:!1,selection:!1})}}]),r}(),ff=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="YjsService",e}return J(r,[{key:"boot",value:function(){var e=this.config,t=e.connectionUrl,n=e.docIdentifier,r=e.cursorBuilder,i=e.provider,a=e.ydoc,o=i?i():null,c=a?a():null;i&&a||(c=new P.Doc,o=new B.WebsocketProvider(t,n,c)),o.on("sync",(function(e){console.log({sync:e})})),o.on("status",(function(e){console.log({status:e})})),o.on("connection-close",(function(e){console.log({connectioClose:e})})),o.on("connection-error",(function(e){console.log({connectioError:e})}));var s=c.getXmlFragment("prosemirror");this.app.PmPlugins.add("ySyncPlugin",j.ySyncPlugin(s)),r?this.app.PmPlugins.add("yCursorPlugin",j.yCursorPlugin(o.awareness,{cursorBuilder:r})):this.app.PmPlugins.add("yCursorPlugin",j.yCursorPlugin(o.awareness)),this.app.PmPlugins.add("yUndoPlugin",j.yUndoPlugin())}}]),r}(),pf=function(e,t,n,r){return function(i){var a=e.state,o={},c=a.tr;c.selection.empty||c.deleteSelection(),c.setMeta(n,{add:{id:o,pos:c.selection.from}}),e.dispatch(c),t(i).then((function(t){var i=function(e,t,n){var r=n.getState(e).find(null,null,(function(e){return e.id===t}));return r.length?r[0].from:null}(e.state,o,n);if(null!=i){var a,c,s=h.DOMParser.fromSchema(r.pmViews.main.state.config.schema),l=t.includes("<ul>")||t.includes("ol")?{}:{preserveWhitespace:"full"},d=s.parse((a=t.replace(/^\s+|\s+$/g,""),c="<body>".concat(a,"</body>"),(new window.DOMParser).parseFromString(c,"text/html").body),l),f=r.pmViews.main.state.tr;f.replaceWith(i-1,i-1,d).setMeta(n,{remove:{id:o}}),function(e,t,n){var r=e.steps.length-1;if(!(r<t)){var i=e.steps[r];if(i instanceof y.ReplaceStep||i instanceof y.ReplaceAroundStep){var a=e.mapping.maps[r],o=0;a.forEach((function(e,t,n,r){0===o&&(o=r)})),e.setSelection(u.Selection.near(e.doc.resolve(o),n))}}}(f,f.steps.length-1,1),r.pmViews.main.dispatch(f)}}),(function(){e.dispatch(c.setMeta(n,{remove:{id:o}}))}))}},mf=function(e){var i=e.view,a=void 0===i?{}:i,o=e.item,c=e.ExternalAPIContent,s=o.active,l=o.icon,d=o.label,f=(o.run,o.select),p=o.title,m=n.useContext(t.WaxContext),g=(m.app,m.pmViews.main),h=m.activeViewId,v=m.activeView,y=a.state;n.useEffect((function(){}),[]);var k=!!s(y,h),x=!f(y,h,v);return g.props.editable((function(e){return e}))||(x=!0),n.useMemo((function(){return r.createElement(t.MenuButton,{active:k||!1,disabled:x,iconName:l,label:d,onMouseDown:function(e){return function(e,t){e.preventDefault();var n=t.selection,r=n.$from,i=n.$to,a=new u.TextSelection(r,i).content();c(a.content.content[0].textContent)}(e,a.state,a.dispatch)},title:p})}),[k,x])},gf=function(e){var a=e.view,o=e.displayed,c=e.config,u=e.pmplugins,l=e.item,d=n.useContext(t.WaxContext);if(i.isEmpty(a))return null;var f=pf(a,c.get("config.ExternalAPIContentService").ExternalAPIContentTransformation,u.get("ExternalAPIContentPlaceHolder"),d);return o?r.createElement(mf,{ExternalAPIContent:f,item:l.toJSON(),key:s.v4(),view:a}):null},hf=o.injectable()($d=function(e){I(i,t.Tools);var n=L(i);function i(){var e;W(this,i);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).title="ChatGPT",e.name="ChatGPT",e.label="ChatGPT",e.select=function(e){return t.Commands.isOnSameTextBlock(e)},e}return J(i,[{key:"renderTool",value:function(e){return r.createElement(gf,{config:this.config,displayed:this.isDisplayed(),item:this,key:s.v4(),pmplugins:this.pmplugins,view:e})}},{key:"run",get:function(){return!0}},{key:"enable",get:function(){return function(e){return t.Commands.isOnSameTextBlock(e)}}}]),i}())||$d,vf=o.injectable()(ef=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("ExternalAPIContentTool")(r,void 0,0)||r}())||ef,yf=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("ExternalAPIContent").to(vf)}}]),r}(),kf=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="ExternalAPIContentService",e.dependencies=[new yf],e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("ExternalAPIContentPlaceHolder",function(e){return new u.Plugin({key:new u.PluginKey(e),state:{init:function(){return l.DecorationSet.empty},apply:function(e,t){t=t.map(e.mapping,e.doc);var n=e.getMeta(this);if(n&&n.add){var r=document.createElement("placeholder-external-api"),i=l.Decoration.widget(n.add.pos,r,{id:n.add.id});t=t.add(e.doc,[i])}else n&&n.remove&&(t=t.remove(t.find(null,null,(function(e){return e.id===n.remove.id}))));return t}},props:{decorations:function(e){return this.getState(e)}}})}("ExternalAPIContentPlaceHolder"))}},{key:"register",value:function(){this.container.bind("ExternalAPIContentTool").to(hf)}}]),r}(),xf=function(e){var t="<body>".concat(e,"</body>");return(new window.DOMParser).parseFromString(t,"text/html").body},bf=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.state,i=r,a=i.tr,o=a.selection,c=o.from,s=o.to,l=[],d=h.DOMParser.fromSchema(r.config.schema);if(!(c>r.doc.content.size||s>r.doc.content.size)){var f=r.schema.text(t);(t.includes("<ul>")||t.includes("ol"))&&(f=d.parse(xf(t.replace(/^\s+|\s+$/g,"")),{})),t.includes("\n")&&t.split("\n\n").forEach((function(e){var t="";/^\d+\..*\n/.test(e)?(t="<ol>",e.split("\n").forEach((function(e){t+="<li>".concat(e.replace(/^(\d+\.\s)/g,"").trim(),"</li>")})),t+="</ol>"):/^-.*\n/.test(e)?(t="<ul>",e.split("\n").forEach((function(e){t+="<li>".concat(e.replace(/[-\s]/g,""),"</li>")})),t+="</ul>"):t=e.replace(/\n/g,"<br />"),l.push(d.parse(xf(t)))}));var p=0!==l.length?l:f;n?(c!==s&&(a=a.delete(c,s)),a=a.replaceWith(c,c,p)):a=a.insert(s,p),e.dispatch(a),r=e.state;var m=n?c:s,g=m+t.length,v=0!==l.length?g+2:g,y=u.TextSelection.create(r.doc,v,v);a=r.tr.setSelection(y),e.dispatch(a),e.focus()}};function wf(){var e=ke(["\n  background: none;\n  border: none;\n  cursor: pointer;\n  outline: none;\n  padding: 0 8px; /* Adjust padding as needed */\n"]);return wf=function(){return e},e}function Ef(){var e=ke(["\n  color: black;\n  flex: 1 1 0;\n  font-family: Roboto, sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 19px;\n  white-space: pre-line;\n  word-wrap: break-word;\n"]);return Ef=function(){return e},e}function Cf(){var e=ke(["\n  align-items: center;\n  background: white;\n  border: 0.5px #dcdcdc solid;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.08);\n  display: inline-flex;\n  flex-direction: column;\n  gap: 10px;\n  justify-content: flex-start;\n  max-height: 200px;\n  overflow-y: auto;\n  padding: 8px 12px;\n  width: 458px;\n"]);return Cf=function(){return e},e}function Sf(){var e=ke(["\n  background: transparent;\n  border: none;\n  color: #000;\n  font-family: 'Helvetica Neue', sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 22px;\n  outline: none;\n  width: 100%;\n"]);return Sf=function(){return e},e}function Af(){var e=ke(["\n  color: ",";\n  font-family: 'Helvetica Neue', sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 22px;\n  word-wrap: break-word;\n"]);return Af=function(){return e},e}function Tf(){var e=ke(["\n  align-items: flex-start;\n  box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.04);\n  display: flex;\n  flex-direction: column;\n  justify-content: flex-start;\n  width: 250px;\n"]);return Tf=function(){return e},e}function Of(){var e=ke(["\n  align-items: center;\n  align-self: stretch;\n  background: white;\n  border: 0.5px #f0f0f0 solid;\n  cursor: pointer;\n  display: inline-flex;\n  gap: 8px;\n  justify-content: flex-start;\n  padding: 8px 12px;\n"]);return Of=function(){return e},e}function Mf(){var e=ke(["\n  background: #fafafa;\n  border: 0.5px #dcdcdc solid;\n  border-top-left-radius: 4px;\n  border-top-right-radius: 4px;\n  box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.08);\n  display: inline-flex;\n  justify-content: space-between;\n  padding: 8px 12px;\n  width: 458px;\n"]);return Mf=function(){return e},e}function Df(){var e=ke(["\n  display: flex;\n  flex-direction: column;\n"]);return Df=function(){return e},e}var jf,Bf=p.div(Df()),Pf=p.div(Mf()),Wf=p.button(Of()),Nf=p.div(Tf()),If=p.div(Af(),(function(e){return e.color||"#434343"})),Hf=p.input(Sf()),Rf=p.div(Cf()),zf=p.div(Ef()),Vf=p.button(wf()),Lf=function(e){var a=e.setPosition,o=e.position,s=e.config,u=c.useTranslation(),l=u.t,f=u.i18n,p=n.useContext(t.WaxContext),m=p.pmViews.main,g=p.options,h=$(n.useState(""),2),v=h[0],y=h[1],k=$(n.useState(!1),2),x=k[0],b=k[1],w=$(n.useState(!1),2),E=w[0],C=w[1],S=s.AskAiContentTransformation,A=n.useRef(null);n.useLayoutEffect((function(){var e=m.dom.getBoundingClientRect(),t=m.state.selection.to,n=m.coordsAtPos(t-1),r=document.getElementById("ai-overlay");if(r){var i=r.getBoundingClientRect(),c=n.top-e.top+20,s=n.left-e.left-i.width/2;n.left-i.width/2<e.left&&(s+=e.left-(n.left-i.width/2)),n.left+i.width/2>e.right&&(s-=n.left+i.width/2-e.right),a(de(de({},o),{},{left:s,top:c}))}}),[o.left,g.AiOn]);var T=function(){var e=ye(d.mark((function e(){var t,n,r,i,a,o,c;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(""!==(t=A.current.value)){e.next=4;break}return A.current.focus(),e.abrupt("return");case 4:return b(!1),C(!0),n=m.state.selection,r=n.from,i=n.to,a=m.state.doc.textBetween(r,i),o="".concat(t,"\n\n").concat(a),e.prev=9,e.next=12,S(o);case 12:c=e.sent,y(c),b(!0),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(9),y(e.t0),b(!0);case 21:return e.prev=21,C(!1),e.finish(21);case 24:case"end":return e.stop()}}),e,null,[[9,17,21,24]])})));return function(){return e.apply(this,arguments)}}();return(null==g?void 0:g.AiOn)?r.createElement(Bf,{id:"ai-overlay"},r.createElement(Pf,null,r.createElement(Hf,{id:"askAiInput",onKeyPress:function(e){"Enter"===e.key&&T()},placeholder:!i.isEmpty(f)&&f.exists("Wax.AI.Placeholder")?l("Wax.AI.Placeholder"):"How can I help you? Type your prompt here.",ref:A,type:"text"}),r.createElement(Vf,{onClick:T},E?r.createElement(t.icons.loaderIco,null):r.createElement(t.icons.submitIco,null))),x&&r.createElement(r.Fragment,null,r.createElement(Rf,null,r.createElement(zf,{dangerouslySetInnerHTML:{__html:v}})),r.createElement(Nf,null,r.createElement(Wf,{onClick:function(){bf(m,v,!0)}},r.createElement(If,null,r.createElement(t.icons.replaceIco,null)," ",!i.isEmpty(f)&&f.exists("Wax.AI.Replace selected text")?l("Wax.AI.Replace selected text"):"Replace selected text")),r.createElement(Wf,{onClick:function(){bf(m,v)}},r.createElement(If,null,r.createElement(t.icons.insertIco,null)," ",!i.isEmpty(f)&&f.exists("Wax.AI.Insert")?l("Wax.AI.Insert"):"Insert")),r.createElement(Wf,{onClick:function(){b(!1),y(""),T(new Event("submit"))}},r.createElement(If,null,r.createElement(t.icons.tryAgain,null)," ",!i.isEmpty(f)&&f.exists("Wax.AI.Try again")?l("Wax.AI. Try again"):"Try again")),r.createElement(Wf,{onClick:function(){A.current.value="",y(""),b(!1)}},r.createElement(If,{color:"#FF4E4E"},r.createElement(t.icons.deleteIco,null)," ",!i.isEmpty(f)&&f.exists("Wax.AI.Discard")?l("Wax.AI.Discard"):"Discard"))))):null},Gf=new u.PluginKey("askAiSelectionPlugin"),Jf=o.injectable()(jf=function(e){I(r,t.ToolGroup);var n=L(r);function r(e){var t;return W(this,r),(t=n.call(this)).tools=[],t.tools=[e],t}return r=o.inject("ToggleAiTool")(r,void 0,0)||r}())||jf,Ff=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("ToggleAi").to(Jf)}}]),r}(),qf=function(e){var i=e.item,a=$(n.useState(!1),2),o=a[0],c=a[1],s=n.useContext(t.WaxContext),u=s.app,l=s.pmViews.main,d=u.config.get("config.AskAiContentService"),f=!1,p=l.props.editable((function(e){return e}));p||(f=!0);var m=function(){s.setOption({AiOn:!o}),c(!o),l.dispatch(l.state.tr.setMeta("addToHistory",!1)),l.focus()};return n.useEffect((function(){c(!1),s.setOption({AiOn:!1}),l.dispatch(l.state.tr.setMeta("addToHistory",!1))}),[o&&l.state.selection.from===l.state.selection.to]),n.useMemo((function(){return d.AiOn?r.createElement(t.MenuButton,{active:o,disabled:!p,iconName:i.icon,onMouseDown:m,title:i.title}):null}),[o,f,d.AiOn])};qf.defaultProps={item:{icon:"",title:""}};var Qf,Yf=function(e){I(i,t.Tools);var n=L(i);function i(){var e;W(this,i);for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return(e=n.call.apply(n,[this].concat(r))).title="Toggle Ai",e.icon="ai",e.name="ToggleAi",e}return J(i,[{key:"renderTool",value:function(e){return r.createElement(qf,{item:this.toJSON(),key:s.v4(),view:e})}}]),i}(),Kf=function(e){I(r,t.Service);var n=L(r);function r(){var e;W(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return(e=n.call.apply(n,[this].concat(i))).name="AskAiContentService",e.dependencies=[new Ff],e}return J(r,[{key:"boot",value:function(){this.app.PmPlugins.add("askAiSelectionPlugin",new u.Plugin({key:Gf,state:{init:function(){return{}},apply:function(e,t,n,r){var i;if(document.getElementById("askAiInput")){var a=e.getMeta(Gf),o=a?a.from:r.selection.from,c=a?a.to:r.selection.to;i=l.DecorationSet.create(r.doc,[l.Decoration.inline(o,c,{class:"ask-ai-selection"})])}return{createDecoration:i}}},props:{decorations:function(e){return(e&&Gf.getState(e)).createDecoration},handleDOMEvents:{blur:function(e){document.getElementById("askAiInput")&&e.dispatch(e.state.tr.setMeta(Gf,e.state.selection))}}}}));var e=this.container.get("CreateOverlay"),t=this.config;e(Lf,{config:t},{nodeType:"",markType:"",followCursor:!1,selection:!0})}},{key:"register",value:function(){this.container.bind("ToggleAiTool").to(Yf)}}]),r}();function Uf(){var e=ke(["\n  background: khaki;\n  height: 100%;\n"]);return Uf=function(){return e},e}var Zf=p.div(Uf()),Xf=o.injectable()(Qf=function(e){I(c,t.ToolGroup);var a=L(c);function c(e,t,n){var r;return W(this,c),(r=a.call(this)).tools=[],r.toolGroups=[],r.toolGroups=[{name:"TabA",groups:[e,t,n]}],r}return c=o.inject("CustomTagBlockToolGroup")(c,void 0,2)||c,c=o.inject("Text")(c,void 0,1)||c,J(c=o.inject("Display")(c,void 0,0)||c,[{key:"renderTools",value:function(e){if(i.isEmpty(e))return null;var a=[{id:"1",title:"block level tools",icon:"title",disabled:!1,component:r.createElement(t.BlockLevelTools,{groups:this._toolGroups[0].groups.map((function(e){return{groupName:"Custom Block"===e.title?e.title:e.title.props.title,items:e._tools}})),view:e})},{id:"2",disabled:!0,title:"chapter list",icon:"chapterList",component:r.createElement(Zf,null)}];return n.useMemo((function(){return r.createElement(t.Tabs,{key:s.v4(),tabList:a})}),[])}}]),c}())||Qf,_f=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("DisplayText").to(Xf)}}]),r}();function $f(){var e=ke(["\n  height: 18px;\n  width: 18px;\n  margin-left: auto;\n"]);return $f=function(){return e},e}function ep(){var e=ke(["\n  visibility: ",";\n  background: #fff;\n  display: flex;\n  flex-direction: column;\n  border: 1px solid #ddd;\n  border-radius: 0.25rem;\n  box-shadow: 0 0.2rem 0.4rem rgb(0 0 0 / 10%);\n  margin: 32px auto auto;\n  position: absolute;\n  width: 160px;\n  max-height: 180px;\n  overflow-y: auto;\n  z-index: 2;\n\n  option {\n    cursor: pointer;\n    padding: 8px 10px;\n  }\n\n  option:focus,\n  option:hover {\n    background: #f2f9fc;\n    outline: 2px solid #f2f9fc;\n  }\n  option:disabled {\n    opacity: 0.3;\n    cursor: not-allowed;\n  }\n"]);return ep=function(){return e},e}function tp(){var e=ke(["\n  background: #fff;\n  border: none;\n  color: #000;\n  cursor: ",";\n  display: flex;\n  width: 160px;\n\n  span {\n    position: relative;\n    top: 2px;\n  }\n"]);return tp=function(){return e},e}function np(){var e=ke(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]);return np=function(){return e},e}function rp(){var e=ke(["\n  opacity: ",";\n  display: flex;\n"]);return rp=function(){return e},e}var ip,ap=p.div(rp(),(function(e){return e.disabled?"0.4":"1"})),op=p.div(np()),cp=p.button(tp(),(function(e){return e.disabled?"not-allowed":"pointer"})),sp=p.div(ep(),(function(e){return e.isOpen?"visible":"hidden"})),up=p(t.Icon)($f()),lp=function(e){var a=e.view,o=e.tools,s=c.useTranslation(),u=s.t,l=s.i18n,d=function(e,t){return!i.isEmpty(l)&&l.exists(e)?u(e):t},f=[{label:d("Wax.BlockLevel.Title (H1)","Title"),value:"0",item:o[0]},{label:d("Wax.BlockLevel.Heading 2","Heading 2"),value:"5",item:o[5]},{label:d("Wax.BlockLevel.Heading 3","Heading 3"),value:"6",item:o[6]},{label:d("Wax.BlockLevel.Paragraph","Paragraph"),value:"8",item:o[8]},{label:d("Wax.BlockLevel.Block Quote","Block Quote"),value:"13",item:o[13]}],p=n.useContext(t.WaxContext),m=p.app,g=p.activeView,h=p.activeViewId,v=p.pmViews.main,y=$(n.useState(null),2),k=y[0],x=y[1],b=(a.dispatch,a.state),w=t.DocumentHelpers.findChildrenByType(b.doc,b.config.schema.nodes.title,!0),E=m.config.get("config.TitleService"),C="";w[0]&&(C=w[0].node.textContent),n.useEffect((function(){E&&(w[0]?E.updateTitle(w[0].node.textContent):E.updateTitle(""))}),[C]);var S=n.useRef([]),A=n.useRef(),T=$(n.useState(!1),2),O=T[0],M=T[1],D=!v.props.editable((function(e){return e}));t.useOnClickOutside(A,(function(){return M(!1)})),n.useEffect((function(){D&&M(!1)}),[D]),n.useEffect((function(){x(d("Wax.BlockLevel.Block Level","Styles")),f.forEach((function(e){e.item.active(v.state,h)&&setTimeout((function(){x(d("Wax.BlockLevel.".concat(e.item.label),e.item.label))}))}))}),[v.state.selection.$from.parent.type.name,u("Wax.BlockLevel.Paragraph")]);var j=function(){D||M(!O),O&&setTimeout((function(){g.focus()}))};return n.useMemo((function(){return r.createElement(ap,{disabled:D,ref:A},r.createElement(op,null,r.createElement(cp,{"aria-controls":"block-level-options","aria-expanded":O,"aria-haspopup":!0,disabled:D,onKeyDown:function(e){40===e.keyCode&&S.current[0].current.focus(),27===e.keyCode&&M(!1),13!==e.keyCode&&32!==e.keyCode||M(!0)},onMouseDown:j,type:"button"},r.createElement("span",null,k),r.createElement(up,{name:"expand"}))),r.createElement(sp,{"aria-label":"Choose a block level action",id:"block-level-options",isOpen:O,role:"menu"},f.map((function(e,t){return S.current[t]=S.current[t]||n.createRef(),r.createElement("option",{disabled:!o[e.value].select(v.state,h,g),key:e.value,onClick:function(){o[e.value].run(v.state,v.dispatch),j()},onKeyDown:function(e){return function(e,t){e.preventDefault(),40===e.keyCode&&(t===S.current.length-1?S.current[0].current.focus():S.current[t+1].current.focus()),38===e.keyCode&&(0===t?S.current[S.current.length-1].current.focus():S.current[t-1].current.focus()),13===e.keyCode&&S.current[t].current.click(),27===e.keyCode&&M(!1)}(e,t)},ref:S.current[t],role:"menuitem",tabIndex:"-1"},e.label)}))))}),[D,O,k,u("Wax.BlockLevel.Paragraph")])},dp=o.injectable()(ip=function(e){I(c,t.ToolGroup);var a=L(c);function c(e,t,n,r,i,o,s,u,l,d,f,p,m,g){var h;return W(this,c),(h=a.call(this)).tools=[],h.tools=[e,t,n,r,i,o,s,u,l,d,f,p,m,g],h}return c=o.inject("BlockQuote")(c,void 0,13)||c,c=o.inject("SourceNote")(c,void 0,12)||c,c=o.inject("ExtractPoetry")(c,void 0,11)||c,c=o.inject("ExtractProse")(c,void 0,10)||c,c=o.inject("ParagraphContinued")(c,void 0,9)||c,c=o.inject("Paragraph")(c,void 0,8)||c,c=o.inject("Heading4")(c,void 0,7)||c,c=o.inject("Heading3")(c,void 0,6)||c,c=o.inject("Heading2")(c,void 0,5)||c,c=o.inject("EpigraphPoetry")(c,void 0,4)||c,c=o.inject("EpigraphProse")(c,void 0,3)||c,c=o.inject("SubTitle")(c,void 0,2)||c,c=o.inject("Author")(c,void 0,1)||c,J(c=o.inject("Title")(c,void 0,0)||c,[{key:"renderTools",value:function(e){var t=this;return i.isEmpty(e)?null:n.useMemo((function(){return r.createElement(lp,{key:s.v4(),tools:t._tools,view:e})}),[])}}]),c}())||ip,fp=function(e){I(r,t.Service);var n=L(r);function r(){return W(this,r),n.apply(this,arguments)}return J(r,[{key:"register",value:function(){this.container.bind("BlockDropDown").to(dp)}}]),r}(),pp=new u.PluginKey("disallowPasteImagesPlugin");exports.AskAiContentService=Kf,exports.BaseService=se,exports.BlockDropDownToolGroupService=fp,exports.BottomInfoService=cl,exports.CodeBlockService=ka,exports.CommentsService=pa,exports.CounterInfoService=Gu,exports.CustomTagBlockService=Ed,exports.CustomTagInlineService=xd,exports.CustomTagService=Md,exports.DisplayBlockLevelService=_n,exports.DisplayTextToolGroupService=_f,exports.EditingSuggestingService=Wl,exports.EnterService=Bd,exports.ExternalAPIContentService=kf,exports.FindAndReplaceService=Ns,exports.FullScreenService=Vs,exports.HighlightService=Du,exports.ImageService=pt,exports.InlineAnnotationsService=Lt,exports.LinkService=Ja,exports.ListsService=rn,exports.MathService=Uo,exports.NoteService=br,exports.OENContainersService=df,exports.ShortCutsInfoService=rl,exports.SpecialCharactersService=mu,exports.TextBlockLevelService=Sn,exports.TrackChangeService=Do,exports.TransformService=Cl,exports.YjsService=ff,exports.disallowPasteImagesPlugin=function(e){return new u.Plugin({key:pp,props:{transformPasted:function(t){var n=t.content.content,r=!1;return n.forEach((function(e){"image"===e.type.name&&(e.attrs.id=s.v4(),e.attrs.src="",e.attrs.alt="",r=!0),"figure"===e.type.name&&(e.firstChild&&"image"===e.firstChild.type.name?(e.firstChild.attrs.id=s.v4(),e.firstChild.attrs.src="",e.firstChild.attrs.alt="",r=!0):e.lastChild&&"image"===e.lastChild.type.name&&(e.lastChild.attrs.id=s.v4(),e.lastChild.attrs.src="",e.lastChild.attrs.alt="",r=!0))})),r&&e(),t}}})};
